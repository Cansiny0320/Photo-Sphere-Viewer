{"version":3,"file":"photo-sphere-viewer.js","sources":["../src/data/constants.js","../src/utils/browser.js","../src/utils/math.js","../src/utils/misc.js","../src/PSVError.js","../src/utils/psv.js","../src/utils/index.js","../src/Animation.js","../src/components/AbstractComponent.js","../src/buttons/AbstractButton.js","../src/buttons/AutorotateButton.js","../src/buttons/CustomButton.js","../src/buttons/DownloadButton.js","../src/buttons/FullscreenButton.js","../src/buttons/MenuButton.js","../src/data/system.js","../src/utils/PressHandler.js","../src/buttons/AbstractMoveButton.js","../src/buttons/MoveDownButton.js","../src/buttons/MoveLeftButton.js","../src/buttons/MoveRightButton.js","../src/buttons/MoveUpButton.js","../src/buttons/AbstractZoomButton.js","../src/buttons/ZoomInButton.js","../src/buttons/ZoomOutButton.js","../src/buttons/ZoomRangeButton.js","../src/adapters/AbstractAdapter.js","../src/adapters/equirectangular/index.js","../src/plugins/AbstractPlugin.js","../src/data/config.js","../src/buttons/CaptionButton.js","../src/components/NavbarCaption.js","../src/components/Navbar.js","../src/components/Loader.js","../src/components/Notification.js","../src/components/Overlay.js","../src/components/Panel.js","../src/services/AbstractService.js","../src/services/DataHelper.js","../src/services/EventsHandler.js","../src/services/Renderer.js","../src/services/TextureLoader.js","../src/components/Tooltip.js","../src/services/TooltipRenderer.js","../src/utils/Dynamic.js","../src/utils/MultiDynamic.js","../src/Viewer.js"],"sourcesContent":["/**\n * @namespace PSV.constants\n */\n\n/**\n * @summary Default duration of the transition between panoramas\n * @memberOf PSV.constants\n * @type {number}\n * @constant\n */\nexport const DEFAULT_TRANSITION = 1500;\n\n/**\n * @summary Number of pixels bellow which a mouse move will be considered as a click\n * @memberOf PSV.constants\n * @type {number}\n * @constant\n */\nexport const MOVE_THRESHOLD = 4;\n\n/**\n * @summary Delay in milliseconds between two clicks to consider a double click\n * @memberOf PSV.constants\n * @type {number}\n * @constant\n */\nexport const DBLCLICK_DELAY = 300;\n\n/**\n * @summary Delay in milliseconds to emulate a long touch\n * @memberOf PSV.constants\n * @type {number}\n * @constant\n */\nexport const LONGTOUCH_DELAY = 500;\n\n/**\n * @summary Delay in milliseconds to for the two fingers overlay to appear\n * @memberOf PSV.constants\n * @type {number}\n * @constant\n */\nexport const TWOFINGERSOVERLAY_DELAY = 100;\n\n/**\n * @summary Duration in milliseconds of the \"ctrl zoom\" overlay\n * @memberOf PSV.constants\n * @type {number}\n * @constant\n */\nexport const CTRLZOOM_TIMEOUT = 2000;\n\n/**\n * @summary Time size of the mouse position history used to compute inertia\n * @memberOf PSV.constants\n * @type {number}\n * @constant\n */\nexport const INERTIA_WINDOW = 300;\n\n/**\n * @summary Radius of the THREE.SphereGeometry, Half-length of the THREE.BoxGeometry\n * @memberOf PSV.constants\n * @type {number}\n * @constant\n */\nexport const SPHERE_RADIUS = 10;\n\n/**\n * @summary Property name added to viewer element\n * @memberOf PSV.constants\n * @type {string}\n * @constant\n */\nexport const VIEWER_DATA = 'photoSphereViewer';\n\n/**\n * @summary Property added the the main Mesh object\n * @memberOf PSV.constants\n * @type {string}\n * @constant\n */\nexport const MESH_USER_DATA = 'psvSphere';\n\n/**\n * @summary Available actions\n * @memberOf PSV.constants\n * @enum {string}\n * @constant\n */\nexport const ACTIONS = {\n  ROTATE_LAT_UP    : 'rotateLatitudeUp',\n  ROTATE_LAT_DOWN  : 'rotateLatitudeDown',\n  ROTATE_LONG_RIGHT: 'rotateLongitudeRight',\n  ROTATE_LONG_LEFT : 'rotateLongitudeLeft',\n  ZOOM_IN          : 'zoomIn',\n  ZOOM_OUT         : 'zoomOut',\n  TOGGLE_AUTOROTATE: 'toggleAutorotate',\n};\n\n/**\n * @summary Available events names\n * @memberOf PSV.constants\n * @enum {string}\n * @constant\n */\nexport const EVENTS = {\n  /**\n   * @event autorotate\n   * @memberof PSV\n   * @summary Triggered when the automatic rotation is enabled/disabled\n   * @param {boolean} enabled\n   */\n  AUTOROTATE        : 'autorotate',\n  /**\n   * @event before-render\n   * @memberof PSV\n   * @summary Triggered before a render, used to modify the view\n   * @param {number} timestamp - time provided by requestAnimationFrame\n   * @param {number} elapsed - time elapsed from the previous frame\n   */\n  BEFORE_RENDER     : 'before-render',\n  /**\n   * @event before-rotate\n   * @memberOf PSV\n   * @summary Triggered before a rotate operation, can be cancelled\n   * @param {PSV.ExtendedPosition}\n   */\n  BEFORE_ROTATE     : 'before-rotate',\n  /**\n   * @event click\n   * @memberof PSV\n   * @summary Triggered when the user clicks on the viewer (everywhere excluding the navbar and the side panel)\n   * @param {PSV.ClickData} data\n   */\n  CLICK             : 'click',\n  /**\n   * @event close-panel\n   * @memberof PSV\n   * @summary Triggered when the panel is closed\n   * @param {string} [id]\n   */\n  CLOSE_PANEL       : 'close-panel',\n  /**\n   * @event config-changed\n   * @memberOf PSV\n   * @summary Triggered after a call to setOption/setOptions\n   * @param {string[]} name of changed options\n   */\n  CONFIG_CHANGED    : 'config-changed',\n  /**\n   * @event dblclick\n   * @memberof PSV\n   * @summary Triggered when the user double clicks on the viewer. The simple `click` event is always fired before `dblclick`\n   * @param {PSV.ClickData} data\n   */\n  DOUBLE_CLICK      : 'dblclick',\n  /**\n   * @event fullscreen-updated\n   * @memberof PSV\n   * @summary Triggered when the fullscreen mode is enabled/disabled\n   * @param {boolean} enabled\n   */\n  FULLSCREEN_UPDATED: 'fullscreen-updated',\n  /**\n   * @event hide-notification\n   * @memberof PSV\n   * @summary Triggered when the notification is hidden\n   */\n  HIDE_NOTIFICATION : 'hide-notification',\n  /**\n   * @event hide-overlay\n   * @memberof PSV\n   * @summary Triggered when the overlay is hidden\n   * @param {string} [id]\n   */\n  HIDE_OVERLAY      : 'hide-overlay',\n  /**\n   * @event hide-tooltip\n   * @memberof PSV\n   * @summary Triggered when the tooltip is hidden\n   * @param {*} Data associated to this tooltip\n   */\n  HIDE_TOOLTIP      : 'hide-tooltip',\n  /**\n   * @event load-progress\n   * @memberof PSV\n   * @summary Triggered when the loader value changes\n   * @param {number} value from 0 to 100\n   */\n  LOAD_PROGRESS     : 'load-progress',\n  /**\n   * @event open-panel\n   * @memberof PSV\n   * @summary Triggered when the panel is opened\n   * @param {string} [id]\n   */\n  OPEN_PANEL        : 'open-panel',\n  /**\n   * @event panorama-loaded\n   * @memberof PSV\n   * @summary Triggered when a panorama image has been loaded\n   */\n  PANORAMA_LOADED   : 'panorama-loaded',\n  /**\n   * @event position-updated\n   * @memberof PSV\n   * @summary Triggered when the view longitude and/or latitude changes\n   * @param {PSV.Position} position\n   */\n  POSITION_UPDATED  : 'position-updated',\n  /**\n   * @event ready\n   * @memberof PSV\n   * @summary Triggered when the panorama image has been loaded and the viewer is ready to perform the first render\n   */\n  READY             : 'ready',\n  /**\n   * @event render\n   * @memberof PSV\n   * @summary Triggered on each viewer render, **this event is triggered very often**\n   */\n  RENDER            : 'render',\n  /**\n   * @event show-notification\n   * @memberof PSV\n   * @summary Triggered when the notification is shown\n   */\n  SHOW_NOTIFICATION : 'show-notification',\n  /**\n   * @event show-overlay\n   * @memberof PSV\n   * @summary Triggered when the overlay is shown\n   * @param {string} [id]\n   */\n  SHOW_OVERLAY      : 'show-overlay',\n  /**\n   * @event show-tooltip\n   * @memberof PSV\n   * @summary Triggered when the tooltip is shown\n   * @param {*} Data associated to this tooltip\n   * @param {PSV.components.Tooltip} Instance of the tooltip\n   */\n  SHOW_TOOLTIP      : 'show-tooltip',\n  /**\n   * @event size-updated\n   * @memberof PSV\n   * @summary Triggered when the viewer size changes\n   * @param {PSV.Size} size\n   */\n  SIZE_UPDATED      : 'size-updated',\n  /**\n   * @event stop-all\n   * @memberof PSV\n   * @summary Triggered when all current animations are stopped\n   */\n  STOP_ALL          : 'stop-all',\n  /**\n   * @event zoom-updated\n   * @memberof PSV\n   * @summary Triggered when the zoom level changes\n   * @param {number} zoomLevel\n   */\n  ZOOM_UPDATED      : 'zoom-updated',\n};\n\n/**\n * @summary Available change events names\n * @memberOf PSV.constants\n * @enum {string}\n * @constant\n */\nexport const CHANGE_EVENTS = {\n  /**\n   * @event get-animate-position\n   * @memberof PSV\n   * @param {Position} position\n   * @returns {Position}\n   * @summary Called to alter the target position of an animation\n   */\n  GET_ANIMATE_POSITION: 'get-animate-position',\n  /**\n   * @event get-rotate-position\n   * @memberof PSV\n   * @param {Position} position\n   * @returns {Position}\n   * @summary Called to alter the target position of a rotation\n   */\n  GET_ROTATE_POSITION : 'get-rotate-position',\n};\n\n/**\n * @summary Special events emitted to listener using {@link Viewer#observeObjects}\n * @memberOf PSV.constants\n * @constant\n * @package\n */\nexport const OBJECT_EVENTS = {\n  ENTER_OBJECT: 'enter-object',\n  HOVER_OBJECT: 'hover-object',\n  LEAVE_OBJECT: 'leave-object',\n};\n\n/**\n * @summary Internal identifiers for various stuff\n * @memberOf PSV.constants\n * @enum {string}\n * @constant\n */\nexport const IDS = {\n  MENU       : 'menu',\n  TWO_FINGERS: 'twoFingers',\n  CTRL_ZOOM  : 'ctrlZoom',\n  ERROR      : 'error',\n};\n\n/* eslint-disable */\n// @formatter:off\n/**\n * @summary Collection of easing functions\n * @memberOf PSV.constants\n * @see {@link https://gist.github.com/frederickk/6165768}\n * @type {Object<string, Function>}\n * @constant\n */\nexport const EASINGS = {\n  linear    : (t) => t,\n\n  inQuad    : (t) => t*t,\n  outQuad   : (t) => t*(2-t),\n  inOutQuad : (t) => t<.5 ? 2*t*t : -1+(4-2*t)*t,\n\n  inCubic   : (t) => t*t*t,\n  outCubic  : (t) => (--t)*t*t+1,\n  inOutCubic: (t) => t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1,\n\n  inQuart   : (t) => t*t*t*t,\n  outQuart  : (t) => 1-(--t)*t*t*t,\n  inOutQuart: (t) => t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t,\n\n  inQuint   : (t) => t*t*t*t*t,\n  outQuint  : (t) => 1+(--t)*t*t*t*t,\n  inOutQuint: (t) => t<.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t,\n\n  inSine    : (t) => 1-Math.cos(t*(Math.PI/2)),\n  outSine   : (t) => Math.sin(t*(Math.PI/2)),\n  inOutSine : (t) => .5-.5*Math.cos(Math.PI*t),\n\n  inExpo    : (t) => Math.pow(2, 10*(t-1)),\n  outExpo   : (t) => 1-Math.pow(2, -10*t),\n  inOutExpo : (t) => (t=t*2-1)<0 ? .5*Math.pow(2, 10*t) : 1-.5*Math.pow(2, -10*t),\n\n  inCirc    : (t) => 1-Math.sqrt(1-t*t),\n  outCirc   : (t) => Math.sqrt(1-(t-1)*(t-1)),\n  inOutCirc : (t) => (t*=2)<1 ? .5-.5*Math.sqrt(1-t*t) : .5+.5*Math.sqrt(1-(t-=2)*t)\n};\n// @formatter:on\n/* eslint-enable */\n\n/**\n * @summary Subset of key codes\n * @memberOf PSV.constants\n * @type {Object<string, string>}\n * @constant\n */\nexport const KEY_CODES = {\n  Enter     : 'Enter',\n  Control   : 'Control',\n  Escape    : 'Escape',\n  Space     : ' ',\n  PageUp    : 'PageUp',\n  PageDown  : 'PageDown',\n  ArrowLeft : 'ArrowLeft',\n  ArrowUp   : 'ArrowUp',\n  ArrowRight: 'ArrowRight',\n  ArrowDown : 'ArrowDown',\n  Delete    : 'Delete',\n  Plus      : '+',\n  Minus     : '-',\n};\n","/**\n * @summary Toggles a CSS class\n * @memberOf PSV.utils\n * @param {HTMLElement|SVGElement} element\n * @param {string} className\n * @param {boolean} [active] - forced state\n */\nexport function toggleClass(element, className, active) {\n  // manual implementation for IE11 and SVGElement\n  if (!element.classList) {\n    let currentClassName = element.getAttribute('class') || '';\n    const currentActive = currentClassName.indexOf(className) !== -1;\n    const regex = new RegExp('(?:^|\\\\s)' + className + '(?:\\\\s|$)');\n\n    if ((active === undefined || active) && !currentActive) {\n      currentClassName += currentClassName.length > 0 ? ' ' + className : className;\n    }\n    else if (!active) {\n      currentClassName = currentClassName.replace(regex, ' ');\n    }\n\n    element.setAttribute('class', currentClassName);\n  }\n  else if (active === undefined) {\n    element.classList.toggle(className);\n  }\n  else if (active && !element.classList.contains(className)) {\n    element.classList.add(className);\n  }\n  else if (!active) {\n    element.classList.remove(className);\n  }\n}\n\n/**\n * @summary Adds one or several CSS classes to an element\n * @memberOf PSV.utils\n * @param {HTMLElement} element\n * @param {string} className\n */\nexport function addClasses(element, className) {\n  if (className) {\n    className.split(' ').forEach((name) => {\n      toggleClass(element, name, true);\n    });\n  }\n}\n\n/**\n * @summary Removes one or several CSS classes to an element\n * @memberOf PSV.utils\n * @param {HTMLElement} element\n * @param {string} className\n */\nexport function removeClasses(element, className) {\n  if (className) {\n    className.split(' ').forEach((name) => {\n      toggleClass(element, name, false);\n    });\n  }\n}\n\n/**\n * @summary Searches if an element has a particular parent at any level including itself\n * @memberOf PSV.utils\n * @param {HTMLElement} el\n * @param {HTMLElement} parent\n * @returns {boolean}\n */\nexport function hasParent(el, parent) {\n  let test = el;\n\n  do {\n    if (test === parent) {\n      return true;\n    }\n    test = test.parentNode;\n  } while (test);\n\n  return false;\n}\n\n/**\n * @summary Gets the closest parent (can by itself)\n * @memberOf PSV.utils\n * @param {HTMLElement|SVGElement} el\n * @param {string} selector\n * @returns {HTMLElement}\n */\nexport function getClosest(el, selector) {\n  const matches = el.matches || el.msMatchesSelector;\n  let test = el;\n  // When el is document or window, the matches does not exist\n  if (!matches) {\n    return null;\n  }\n\n  do {\n    if (matches.bind(test)(selector)) {\n      return test;\n    }\n    test = test instanceof SVGElement ? test.parentNode : test.parentElement;\n  } while (test);\n\n  return null;\n}\n\n/**\n * @summary Gets the position of an element in the viewer without reflow\n * @description Will gives the same result as getBoundingClientRect() as soon as there are no CSS transforms\n * @memberOf PSV.utils\n * @param {HTMLElement} el\n * @return {{left: number, top: number}}\n */\nexport function getPosition(el) {\n  let left = 0;\n  let top = 0;\n  let test = el;\n\n  while (test) {\n    left += (test.offsetLeft - test.scrollLeft + test.clientLeft);\n    top += (test.offsetTop - test.scrollTop + test.clientTop);\n    test = test.offsetParent;\n  }\n\n  return { left, top };\n}\n\n/**\n * @summary Map between keyboard events `keyCode|which` and `key`\n * @memberOf PSV.utils\n * @type {Object<int, string>}\n * @readonly\n * @private\n */\nconst KEYMAP = {\n  13 : 'Enter',\n  17 : 'Control',\n  27 : 'Escape',\n  32 : ' ',\n  33 : 'PageUp',\n  34 : 'PageDown',\n  37 : 'ArrowLeft',\n  38 : 'ArrowUp',\n  39 : 'ArrowRight',\n  40 : 'ArrowDown',\n  46 : 'Delete',\n  107: '+',\n  109: '-',\n};\n\n/**\n * @summary Map for non standard keyboard events `key` for IE and Edge\n * @see https://github.com/shvaikalesh/shim-keyboard-event-key\n * @type {Object<string, string>}\n * @readonly\n * @private\n */\nconst MS_KEYMAP = {\n  Add     : '+',\n  Del     : 'Delete',\n  Down    : 'ArrowDown',\n  Esc     : 'Escape',\n  Left    : 'ArrowLeft',\n  Right   : 'ArrowRight',\n  Spacebar: ' ',\n  Subtract: '-',\n  Up      : 'ArrowUp',\n};\n\n/**\n * @summary Returns the key name of a KeyboardEvent\n * @memberOf PSV.utils\n * @param {KeyboardEvent} evt\n * @returns {string}\n */\nexport function getEventKey(evt) {\n  let key = evt.key || KEYMAP[evt.keyCode || evt.which];\n\n  if (key && MS_KEYMAP[key]) {\n    key = MS_KEYMAP[key];\n  }\n\n  return key;\n}\n\n/**\n * @summary Detects if fullscreen is enabled\n * @memberOf PSV.utils\n * @param {HTMLElement} elt\n * @returns {boolean}\n */\nexport function isFullscreenEnabled(elt) {\n  /* eslint-disable-next-line max-len */\n  return (document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement) === elt;\n}\n\n/**\n * @summary Enters fullscreen mode\n * @memberOf PSV.utils\n * @param {HTMLElement} elt\n */\nexport function requestFullscreen(elt) {\n  /* eslint-disable-next-line max-len */\n  (elt.requestFullscreen || elt.mozRequestFullScreen || elt.webkitRequestFullscreen || elt.msRequestFullscreen).call(elt);\n}\n\n/**\n * @summary Exits fullscreen mode\n * @memberOf PSV.utils\n */\nexport function exitFullscreen() {\n  /* eslint-disable-next-line max-len */\n  (document.exitFullscreen || document.mozCancelFullScreen || document.webkitExitFullscreen || document.msExitFullscreen).call(document);\n}\n\n/**\n * @summary Gets an element style\n * @memberOf PSV.utils\n * @param {HTMLElement} elt\n * @param {string} prop\n * @returns {*}\n */\nexport function getStyle(elt, prop) {\n  return window.getComputedStyle(elt, null)[prop];\n}\n\n/**\n * @summary Normalize mousewheel values accross browsers\n * @memberOf PSV.utils\n * @description From Facebook's Fixed Data Table\n * {@link https://github.com/facebookarchive/fixed-data-table/blob/master/src/vendor_upstream/dom/normalizeWheel.js}\n * @copyright Facebook\n * @param {WheelEvent} event\n * @returns {{spinX: number, spinY: number, pixelX: number, pixelY: number}}\n */\nexport function normalizeWheel(event) {\n  const PIXEL_STEP = 10;\n  const LINE_HEIGHT = 40;\n  const PAGE_HEIGHT = 800;\n\n  let spinX = 0;\n  let spinY = 0;\n  let pixelX = 0;\n  let pixelY = 0;\n\n  // Legacy\n  if ('detail' in event) {\n    spinY = event.detail;\n  }\n  if ('wheelDelta' in event) {\n    spinY = -event.wheelDelta / 120;\n  }\n  if ('wheelDeltaY' in event) {\n    spinY = -event.wheelDeltaY / 120;\n  }\n  if ('wheelDeltaX' in event) {\n    spinX = -event.wheelDeltaX / 120;\n  }\n\n  // side scrolling on FF with DOMMouseScroll\n  if ('axis' in event && event.axis === event.HORIZONTAL_AXIS) {\n    spinX = spinY;\n    spinY = 0;\n  }\n\n  pixelX = spinX * PIXEL_STEP;\n  pixelY = spinY * PIXEL_STEP;\n\n  if ('deltaY' in event) {\n    pixelY = event.deltaY;\n  }\n  if ('deltaX' in event) {\n    pixelX = event.deltaX;\n  }\n\n  if ((pixelX || pixelY) && event.deltaMode) {\n    // delta in LINE units\n    if (event.deltaMode === 1) {\n      pixelX *= LINE_HEIGHT;\n      pixelY *= LINE_HEIGHT;\n    }\n    // delta in PAGE units\n    else {\n      pixelX *= PAGE_HEIGHT;\n      pixelY *= PAGE_HEIGHT;\n    }\n  }\n\n  // Fall-back if spin cannot be determined\n  if (pixelX && !spinX) {\n    spinX = (pixelX < 1) ? -1 : 1;\n  }\n  if (pixelY && !spinY) {\n    spinY = (pixelY < 1) ? -1 : 1;\n  }\n\n  return { spinX, spinY, pixelX, pixelY };\n}\n","/**\n * @summary Ensures that a number is in a given interval\n * @memberOf PSV.utils\n * @param {number} x\n * @param {number} min\n * @param {number} max\n * @returns {number}\n */\nexport function bound(x, min, max) {\n  return Math.max(min, Math.min(max, x));\n}\n\n/**\n * @summary Checks if a value is an integer\n * @memberOf PSV.utils\n * @param {*} value\n * @returns {boolean}\n */\nexport function isInteger(value) {\n  if (Number.isInteger) {\n    return Number.isInteger(value);\n  }\n  return typeof value === 'number' && Number.isFinite(value) && Math.floor(value) === value;\n}\n\n/**\n * @summary Tests if a number is power of two\n * @memberOf PSV.utils\n * @param {number} x\n * @return {boolean}\n */\nexport function isPowerOfTwo(x) {\n  return (Math.log(x) / Math.log(2)) % 1 === 0;\n}\n\n/**\n * @summary Computes the sum of an array\n * @memberOf PSV.utils\n * @param {number[]} array\n * @returns {number}\n */\nexport function sum(array) {\n  return array.reduce((a, b) => a + b, 0);\n}\n\n/**\n * @summary Computes the distance between two points\n * @memberOf PSV.utils\n * @param {PSV.Point} p1\n * @param {PSV.Point} p2\n * @returns {number}\n */\nexport function distance(p1, p2) {\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\n}\n\n/**\n * @summary Compute the shortest offset between two longitudes\n * @memberOf PSV.utils\n * @param {number} from\n * @param {number} to\n * @returns {number}\n */\nexport function getShortestArc(from, to) {\n  const tCandidates = [\n    0, // direct\n    Math.PI * 2, // clock-wise cross zero\n    -Math.PI * 2, // counter-clock-wise cross zero\n  ];\n\n  return tCandidates.reduce((value, candidate) => {\n    const newCandidate = to - from + candidate;\n    return Math.abs(newCandidate) < Math.abs(value) ? newCandidate : value;\n  }, Infinity);\n}\n\n/**\n * @summary Computes the angle between the current position and a target position\n * @memberOf PSV.utils\n * @param {PSV.Position} position1\n * @param {PSV.Position} position2\n * @returns {number}\n */\nexport function getAngle(position1, position2) {\n  return Math.acos(\n    Math.cos(position1.latitude)\n    * Math.cos(position2.latitude)\n    * Math.cos(position1.longitude - position2.longitude)\n    + Math.sin(position1.latitude)\n    * Math.sin(position2.latitude)\n  );\n}\n\n/**\n * @summary Returns the distance between two points on a sphere of radius one\n * {@link http://www.movable-type.co.uk/scripts/latlong.html}\n * @memberOf PSV.utils\n * @param {number[]} p1\n * @param {number[]} p2\n * @returns {number}\n */\nexport function greatArcDistance(p1, p2) {\n  const [λ1, φ1] = p1;\n  const [λ2, φ2] = p2;\n\n  const x = (λ2 - λ1) * Math.cos((φ1 + φ2) / 2);\n  const y = (φ2 - φ1);\n  return Math.sqrt(x * x + y * y);\n}\n","/**\n * @summary Transforms a string to dash-case {@link https://github.com/shahata/dasherize}\n * @memberOf PSV.utils\n * @param {string} str\n * @returns {string}\n */\nexport function dasherize(str) {\n  return str.replace(/[A-Z](?:(?=[^A-Z])|[A-Z]*(?=[A-Z][^A-Z]|$))/g, (s, i) => {\n    return (i > 0 ? '-' : '') + s.toLowerCase();\n  });\n}\n\n/**\n * @summary Returns a function, that, when invoked, will only be triggered at most once during a given window of time.\n * @memberOf PSV.utils\n * @copyright underscore.js - modified by Clément Prévost {@link http://stackoverflow.com/a/27078401}\n * @param {Function} func\n * @param {number} wait\n * @returns {Function}\n */\nexport function throttle(func, wait) {\n  /* eslint-disable */\n  let self, args, result;\n  let timeout;\n  let previous = 0;\n  const later = function() {\n    previous = Date.now();\n    timeout = undefined;\n    result = func.apply(self, args);\n    if (!timeout) {\n      self = args = null;\n    }\n  };\n  return function() {\n    const now = Date.now();\n    if (!previous) {\n      previous = now;\n    }\n    const remaining = wait - (now - previous);\n    self = this;\n    args = arguments;\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = undefined;\n      }\n      previous = now;\n      result = func.apply(self, args);\n      if (!timeout) {\n        self = args = null;\n      }\n    }\n    else if (!timeout) {\n      timeout = setTimeout(later, remaining);\n    }\n    return result;\n  };\n  /* eslint-enable */\n}\n\n/**\n * @summary Test if an object is a plain object\n * @memberOf PSV.utils\n * @description Test if an object is a plain object, i.e. is constructed\n * by the built-in Object constructor and inherits directly from Object.prototype\n * or null. Some built-in objects pass the test, e.g. Math which is a plain object\n * and some host or exotic objects may pass also.\n * {@link http://stackoverflow.com/a/5878101/1207670}\n * @param {*} obj\n * @returns {boolean}\n */\nexport function isPlainObject(obj) {\n  // Basic check for Type object that's not null\n  if (typeof obj === 'object' && obj !== null) {\n    // If Object.getPrototypeOf supported, use it\n    if (typeof Object.getPrototypeOf === 'function') {\n      const proto = Object.getPrototypeOf(obj);\n      return proto === Object.prototype || proto === null;\n    }\n\n    // Otherwise, use internal class\n    // This should be reliable as if getPrototypeOf not supported, is pre-ES5\n    return Object.prototype.toString.call(obj) === '[object Object]';\n  }\n\n  // Not an object\n  return false;\n}\n\n/**\n * @summary Merges the enumerable attributes of two objects\n * @memberOf PSV.utils\n * @description Replaces arrays and alters the target object.\n * @copyright Nicholas Fisher <nfisher110@gmail.com>\n * @param {Object} target\n * @param {Object} src\n * @returns {Object} target\n */\nexport function deepmerge(target, src) {\n  /* eslint-disable */\n  let first = src;\n\n  return (function merge(target, src) {\n    if (Array.isArray(src)) {\n      if (!target || !Array.isArray(target)) {\n        target = [];\n      }\n      else {\n        target.length = 0;\n      }\n      src.forEach(function(e, i) {\n        target[i] = merge(null, e);\n      });\n    }\n    else if (typeof src === 'object') {\n      if (!target || Array.isArray(target)) {\n        target = {};\n      }\n      Object.keys(src).forEach(function(key) {\n        if (typeof src[key] !== 'object' || !src[key] || !isPlainObject(src[key])) {\n          target[key] = src[key];\n        }\n        else if (src[key] != first) {\n          if (!target[key]) {\n            target[key] = merge(null, src[key]);\n          }\n          else {\n            merge(target[key], src[key]);\n          }\n        }\n      });\n    }\n    else {\n      target = src;\n    }\n\n    return target;\n  }(target, src));\n  /* eslint-enable */\n}\n\n/**\n * @summary Deeply clones an object\n * @memberOf PSV.utils\n * @param {Object} src\n * @returns {Object}\n */\nexport function clone(src) {\n  return deepmerge(null, src);\n}\n\n/**\n * @summery Test of an object is empty\n * @memberOf PSV.utils\n * @param {object} obj\n * @returns {boolean}\n */\nexport function isEmpty(obj) {\n  return !obj || (Object.keys(obj).length === 0 && obj.constructor === Object);\n}\n\n/**\n * @summary Loops over enumerable properties of an object\n * @memberOf PSV.utils\n * @param {Object} object\n * @param {Function} callback\n */\nexport function each(object, callback) {\n  Object.keys(object).forEach((key) => {\n    callback(object[key], key);\n  });\n}\n\n/**\n * @summary Returns if a valu is null or undefined\n * @memberOf PSV.utils\n * @param {*} val\n * @return {boolean}\n */\nexport function isNil(val) {\n  return val === null || val === undefined;\n}\n\n/**\n * @summary Returns the first non null non undefined parameter\n * @memberOf PSV.utils\n * @param {*} values\n * @return {*}\n */\nexport function firstNonNull(...values) {\n  for (const val of values) {\n    if (!isNil(val)) {\n      return val;\n    }\n  }\n\n  return undefined;\n}\n","/**\n * @summary Custom error used in the lib\n * @param {string} message\n * @constructor\n * @memberOf PSV\n */\nfunction PSVError(message) {\n  this.message = message;\n\n  // Use V8's native method if available, otherwise fallback\n  if ('captureStackTrace' in Error) {\n    Error.captureStackTrace(this, PSVError);\n  }\n  else {\n    this.stack = (new Error()).stack;\n  }\n}\n\nPSVError.prototype = Object.create(Error.prototype);\nPSVError.prototype.name = 'PSVError';\nPSVError.prototype.constructor = PSVError;\n\nexport { PSVError };\n","import * as THREE from 'three';\nimport { PSVError } from '../PSVError';\nimport { bound } from './math';\n\n/**\n * @summary Returns the plugin constructor from the imported object\n * For retrocompatibility with previous default exports\n * @memberOf PSV.utils\n * @package\n */\nexport function pluginInterop(plugin, target) {\n  if (plugin) {\n    for (const [, p] of [['_', plugin], ...Object.entries(plugin)]) {\n      if (p.prototype instanceof target) {\n        return p;\n      }\n    }\n  }\n  return null;\n}\n\n/**\n * @summary Builds an Error with name 'AbortError'\n * @memberOf PSV.utils\n * @return {Error}\n */\nexport function getAbortError() {\n  const error = new Error('Loading was aborted.');\n  error.name = 'AbortError';\n  return error;\n}\n\n/**\n * @summary Tests if an Error has name 'AbortError'\n * @memberOf PSV.utils\n * @param {Error} err\n * @return {boolean}\n */\nexport function isAbortError(err) {\n  return err?.name === 'AbortError';\n}\n\n/**\n * @summary Displays a warning in the console\n * @memberOf PSV.utils\n * @param {string} message\n */\nexport function logWarn(message) {\n  console.warn(`PhotoSphereViewer: ${message}`);\n}\n\n/**\n * @summary Checks if an object is a {PSV.ExtendedPosition}, ie has x/y or longitude/latitude\n * @memberOf PSV.utils\n * @param {object} object\n * @returns {boolean}\n */\nexport function isExtendedPosition(object) {\n  return [['x', 'y'], ['longitude', 'latitude']].some(([key1, key2]) => {\n    return object[key1] !== undefined && object[key2] !== undefined;\n  });\n}\n\n/**\n * @summary Returns the value of a given attribute in the panorama metadata\n * @memberOf PSV.utils\n * @param {string} data\n * @param {string} attr\n * @returns (number)\n */\nexport function getXMPValue(data, attr) {\n  // XMP data are stored in children\n  let result = data.match('<GPano:' + attr + '>(.*)</GPano:' + attr + '>');\n  if (result !== null) {\n    const val = parseInt(result[1], 10);\n    return isNaN(val) ? null : val;\n  }\n\n  // XMP data are stored in attributes\n  result = data.match('GPano:' + attr + '=\"(.*?)\"');\n  if (result !== null) {\n    const val = parseInt(result[1], 10);\n    return isNaN(val) ? null : val;\n  }\n\n  return null;\n}\n\n/**\n * @readonly\n * @private\n * @type {{top: string, left: string, bottom: string, center: string, right: string}}\n */\nconst CSS_POSITIONS = {\n  top   : '0%',\n  bottom: '100%',\n  left  : '0%',\n  right : '100%',\n  center: '50%',\n};\n\n/**\n * @summary Translate CSS values like \"top center\" or \"10% 50%\" as top and left positions\n * @memberOf PSV.utils\n * @description The implementation is as close as possible to the \"background-position\" specification\n * {@link https://developer.mozilla.org/en-US/docs/Web/CSS/background-position}\n * @param {string|PSV.Point} value\n * @returns {PSV.Point}\n */\nexport function parsePosition(value) {\n  if (!value) {\n    return { x: 0.5, y: 0.5 };\n  }\n\n  if (typeof value === 'object') {\n    return value;\n  }\n\n  let tokens = value.toLocaleLowerCase().split(' ').slice(0, 2);\n\n  if (tokens.length === 1) {\n    if (CSS_POSITIONS[tokens[0]] !== undefined) {\n      tokens = [tokens[0], 'center'];\n    }\n    else {\n      tokens = [tokens[0], tokens[0]];\n    }\n  }\n\n  const xFirst = tokens[1] !== 'left' && tokens[1] !== 'right' && tokens[0] !== 'top' && tokens[0] !== 'bottom';\n\n  tokens = tokens.map(token => CSS_POSITIONS[token] || token);\n\n  if (!xFirst) {\n    tokens.reverse();\n  }\n\n  const parsed = tokens.join(' ').match(/^([0-9.]+)% ([0-9.]+)%$/);\n\n  if (parsed) {\n    return {\n      x: parseFloat(parsed[1]) / 100,\n      y: parseFloat(parsed[2]) / 100,\n    };\n  }\n  else {\n    return { x: 0.5, y: 0.5 };\n  }\n}\n\n/**\n * @readonly\n * @private\n */\nconst LEFT_MAP = { 0: 'left', 0.5: 'center', 1: 'right' };\n/**\n * @readonly\n * @private\n */\nconst TOP_MAP = { 0: 'top', 0.5: 'center', 1: 'bottom' };\n\n/**\n * @summary Parse a CSS-like position into an array of position keywords among top, bottom, left, right and center\n * @memberOf PSV.utils\n * @param {string | string[]} value\n * @param {string} defaultValue\n * @param {boolean} [allowCenter=true]\n * @return {string[]}\n */\nexport function cleanPosition(value, defaultValue, allowCenter = true) {\n  if (!value) {\n    return defaultValue.split(' ');\n  }\n\n  if (typeof value === 'string') {\n    const tempPos = parsePosition(value);\n\n    if (!(tempPos.x in LEFT_MAP) || !(tempPos.y in TOP_MAP)) {\n      throw new PSVError(`Unable to parse position \"${value}\"`);\n    }\n\n    value = [TOP_MAP[tempPos.y], LEFT_MAP[tempPos.x]];\n  }\n\n  if (!allowCenter && value[0] === 'center' && value[1] === 'center') {\n    throw new PSVError('Unable to parse position \"center center\"');\n  }\n\n  return value;\n}\n\n/**\n * @summary Parses an speed\n * @memberOf PSV.utils\n * @param {string|number} speed - The speed, in radians/degrees/revolutions per second/minute\n * @returns {number} radians per second\n * @throws {PSV.PSVError} when the speed cannot be parsed\n */\nexport function parseSpeed(speed) {\n  let parsed;\n\n  if (typeof speed === 'string') {\n    const speedStr = speed.toString().trim();\n\n    // Speed extraction\n    let speedValue = parseFloat(speedStr.replace(/^(-?[0-9]+(?:\\.[0-9]*)?).*$/, '$1'));\n    const speedUnit = speedStr.replace(/^-?[0-9]+(?:\\.[0-9]*)?(.*)$/, '$1').trim();\n\n    // \"per minute\" -> \"per second\"\n    if (speedUnit.match(/(pm|per minute)$/)) {\n      speedValue /= 60;\n    }\n\n    // Which unit?\n    switch (speedUnit) {\n      // Degrees per minute / second\n      case 'dpm':\n      case 'degrees per minute':\n      case 'dps':\n      case 'degrees per second':\n        parsed = THREE.Math.degToRad(speedValue);\n        break;\n\n      // Radians per minute / second\n      case 'rdpm':\n      case 'radians per minute':\n      case 'rdps':\n      case 'radians per second':\n        parsed = speedValue;\n        break;\n\n      // Revolutions per minute / second\n      case 'rpm':\n      case 'revolutions per minute':\n      case 'rps':\n      case 'revolutions per second':\n        parsed = speedValue * Math.PI * 2;\n        break;\n\n      // Unknown unit\n      default:\n        throw new PSVError('Unknown speed unit \"' + speedUnit + '\"');\n    }\n  }\n  else {\n    parsed = speed;\n  }\n\n  return parsed;\n}\n\n/**\n * @summary Parses an angle value in radians or degrees and returns a normalized value in radians\n * @memberOf PSV.utils\n * @param {string|number} angle - eg: 3.14, 3.14rad, 180deg\n * @param {boolean} [zeroCenter=false] - normalize between -Pi - Pi instead of 0 - 2*Pi\n * @param {boolean} [halfCircle=zeroCenter] - normalize between -Pi/2 - Pi/2 instead of -Pi - Pi\n * @returns {number}\n * @throws {PSV.PSVError} when the angle cannot be parsed\n */\nexport function parseAngle(angle, zeroCenter = false, halfCircle = zeroCenter) {\n  let parsed;\n\n  if (typeof angle === 'string') {\n    const match = angle.toLowerCase().trim().match(/^(-?[0-9]+(?:\\.[0-9]*)?)(.*)$/);\n\n    if (!match) {\n      throw new PSVError('Unknown angle \"' + angle + '\"');\n    }\n\n    const value = parseFloat(match[1]);\n    const unit = match[2];\n\n    if (unit) {\n      switch (unit) {\n        case 'deg':\n        case 'degs':\n          parsed = THREE.Math.degToRad(value);\n          break;\n        case 'rad':\n        case 'rads':\n          parsed = value;\n          break;\n        default:\n          throw new PSVError('Unknown angle unit \"' + unit + '\"');\n      }\n    }\n    else {\n      parsed = value;\n    }\n  }\n  else if (typeof angle === 'number' && !isNaN(angle)) {\n    parsed = angle;\n  }\n  else {\n    throw new PSVError('Unknown angle \"' + angle + '\"');\n  }\n\n  parsed = (zeroCenter ? parsed + Math.PI : parsed) % (Math.PI * 2);\n\n  if (parsed < 0) {\n    parsed += Math.PI * 2;\n  }\n\n  return zeroCenter ? bound(parsed - Math.PI, -Math.PI / (halfCircle ? 2 : 1), Math.PI / (halfCircle ? 2 : 1)) : parsed;\n}\n\n/**\n * @summary Creates a THREE texture from an image\n * @memberOf PSV.utils\n * @param {HTMLImageElement | HTMLCanvasElement} img\n * @return {external:THREE.Texture}\n */\nexport function createTexture(img) {\n  const texture = new THREE.Texture(img);\n  texture.needsUpdate = true;\n  texture.minFilter = THREE.LinearFilter;\n  texture.generateMipmaps = false;\n  return texture;\n}\n\nconst quaternion = new THREE.Quaternion();\n\n/**\n * @summary Applies the inverse of Euler angles to a vector\n * @memberOf PSV.utils\n * @param {external:THREE.Vector3} vector\n * @param {external:THREE.Euler} euler\n */\nexport function applyEulerInverse(vector, euler) {\n  quaternion.setFromEuler(euler).invert();\n  vector.applyQuaternion(quaternion);\n}\n","/**\n * @namespace PSV.utils\n */\n\nexport * from './browser';\nexport * from './math';\nexport * from './misc';\nexport * from './psv';\n","import { EASINGS } from './data/constants';\nimport { each, logWarn } from './utils';\n\n/**\n * @callback OnTick\n * @summary Function called for each animation frame with computed properties\n * @memberOf PSV.Animation\n * @param {Object.<string, number>} properties - current values\n * @param {float} progress - 0 to 1\n */\n\n/**\n * @summary Interpolation helper for animations\n * @memberOf PSV\n * @description\n * Implements the Promise API with an additional \"cancel\" method.\n * The promise is resolved with `true` when the animation is completed and `false` if the animation is cancelled.\n * @example\n * const anim = new Animation({\n *     properties: {\n *         width: {start: 100, end: 200}\n *     },\n *     duration: 5000,\n *     onTick: (properties) => element.style.width = `${properties.width}px`;\n * });\n *\n * anim.then((completed) => ...);\n *\n * anim.cancel()\n */\nexport class Animation {\n\n  /**\n   * @param {Object} options\n   * @param {Object.<string, Object>} options.properties\n   * @param {number} options.properties[].start\n   * @param {number} options.properties[].end\n   * @param {number} options.duration\n   * @param {number} [options.delay=0]\n   * @param {string} [options.easing='linear']\n   * @param {PSV.Animation.OnTick} options.onTick - called on each frame\n   */\n  constructor(options) {\n    this.__callbacks = [];\n\n    if (options) {\n      if (!options.easing || typeof options.easing === 'string') {\n        options.easing = EASINGS[options.easing || 'linear'];\n      }\n\n      this.__start = null;\n      this.options = options;\n\n      if (options.delay) {\n        this.__delayTimeout = setTimeout(() => {\n          this.__delayTimeout = null;\n          this.__animationFrame = window.requestAnimationFrame(t => this.__run(t));\n        }, options.delay);\n      }\n      else {\n        this.__animationFrame = window.requestAnimationFrame(t => this.__run(t));\n      }\n    }\n    else {\n      this.__resolved = true;\n    }\n  }\n\n  /**\n   * @summary Main loop for the animation\n   * @param {number} timestamp\n   * @private\n   */\n  __run(timestamp) {\n    // first iteration\n    if (this.__start === null) {\n      this.__start = timestamp;\n    }\n\n    // compute progress\n    const progress = (timestamp - this.__start) / this.options.duration;\n    const current = {};\n\n    if (progress < 1.0) {\n      // interpolate properties\n      each(this.options.properties, (prop, name) => {\n        if (prop) {\n          current[name] = prop.start + (prop.end - prop.start) * this.options.easing(progress);\n        }\n      });\n      this.options.onTick(current, progress);\n\n      this.__animationFrame = window.requestAnimationFrame(t => this.__run(t));\n    }\n    else {\n      // call onTick one last time with final values\n      each(this.options.properties, (prop, name) => {\n        if (prop) {\n          current[name] = prop.end;\n        }\n      });\n      this.options.onTick(current, 1.0);\n\n      this.__animationFrame = window.requestAnimationFrame(() => {\n        this.__resolved = true;\n        this.__resolve(true);\n      });\n    }\n  }\n\n  /**\n   * @private\n   */\n  __resolve(value) {\n    this.__callbacks.forEach(cb => cb(value));\n    this.__callbacks.length = 0;\n  }\n\n  /**\n   * @summary Promise chaining\n   * @param {Function} [onFulfilled] - Called when the animation is complete (true) or cancelled (false)\n   * @param {Function} [onRejected] - deprecated\n   * @returns {PSV.Promise}\n   */\n  then(onFulfilled = null, onRejected = null) {\n    if (onRejected) {\n      logWarn('Animation#then does not accept a rejection handler anymore');\n    }\n\n    if (this.__resolved || this.__cancelled) {\n      return Promise.resolve(this.__resolved)\n        .then(onFulfilled);\n    }\n\n    return new Promise((resolve) => {\n      this.__callbacks.push(resolve);\n    })\n      .then(onFulfilled);\n  }\n\n  /**\n   * @summary Cancels the animation\n   */\n  cancel() {\n    if (!this.__cancelled && !this.__resolved) {\n      this.__cancelled = true;\n      this.__resolve(false);\n\n      if (this.__delayTimeout) {\n        window.clearTimeout(this.__delayTimeout);\n        this.__delayTimeout = null;\n      }\n      if (this.__animationFrame) {\n        window.cancelAnimationFrame(this.__animationFrame);\n        this.__animationFrame = null;\n      }\n    }\n  }\n\n  /**\n   * @deprecated not supported anymore\n   */\n  catch() {\n    logWarn('Animation#catch is not supported anymore');\n    return this.then();\n  }\n\n  /**\n   * @deprecated not supported anymore\n   */\n  finally(onFinally) {\n    logWarn('Animation#finally is not supported anymore');\n    return this.then(onFinally);\n  }\n\n  /**\n   * @deprecated not supported anymore\n   */\n  static resolve() {\n    logWarn('Animation.resolve is not supported anymore');\n  }\n\n}\n","/**\n * @namespace PSV.components\n */\n\n/**\n * @summary Base component class\n * @memberof PSV.components\n * @abstract\n */\nexport class AbstractComponent {\n\n  /**\n   * @param {PSV.Viewer | PSV.components.AbstractComponent} parent\n   * @param {string} className - CSS class added to the component's container\n   */\n  constructor(parent, className) {\n    /**\n     * @summary Reference to main controller\n     * @type {PSV.Viewer}\n     * @readonly\n     */\n    this.psv = parent.psv || parent;\n\n    /**\n     * @member {PSV.Viewer|PSV.components.AbstractComponent}\n     * @readonly\n     */\n    this.parent = parent;\n    this.parent.children.push(this);\n\n    /**\n     * @summary All child components\n     * @type {PSV.components.AbstractComponent[]}\n     * @readonly\n     * @package\n     */\n    this.children = [];\n\n    /**\n     * @summary Internal properties\n     * @member {Object}\n     * @protected\n     * @property {boolean} visible - Visibility of the component\n     */\n    this.prop = {\n      visible: true,\n    };\n\n    /**\n     * @member {HTMLElement}\n     * @readonly\n     */\n    this.container = document.createElement('div');\n    this.container.className = className;\n    this.parent.container.appendChild(this.container);\n  }\n\n  /**\n   * @summary Destroys the component\n   * @protected\n   */\n  destroy() {\n    this.parent.container.removeChild(this.container);\n\n    const childIdx = this.parent.children.indexOf(this);\n    if (childIdx !== -1) {\n      this.parent.children.splice(childIdx, 1);\n    }\n\n    this.children.slice().forEach(child => child.destroy());\n    this.children.length = 0;\n\n    delete this.container;\n    delete this.parent;\n    delete this.psv;\n    delete this.prop;\n  }\n\n  /**\n   * @summary Refresh UI\n   * @description Must be be a very lightweight operation\n   * @package\n   */\n  refreshUi() {\n    this.children.every((child) => {\n      child.refreshUi();\n      return this.psv.prop.uiRefresh === true;\n    });\n  }\n\n  /**\n   * @summary Displays or hides the component\n   */\n  toggle() {\n    if (this.isVisible()) {\n      this.hide();\n    }\n    else {\n      this.show();\n    }\n  }\n\n  /**\n   * @summary Hides the component\n   */\n  hide() {\n    this.container.style.display = 'none';\n    this.prop.visible = false;\n  }\n\n  /**\n   * @summary Displays the component\n   */\n  show() {\n    this.container.style.display = '';\n    this.prop.visible = true;\n  }\n\n  /**\n   * @summary Checks if the component is visible\n   * @returns {boolean}\n   */\n  isVisible() {\n    return this.prop.visible;\n  }\n\n}\n","import { AbstractComponent } from '../components/AbstractComponent';\nimport { KEY_CODES } from '../data/constants';\nimport { PSVError } from '../PSVError';\nimport { getEventKey, isPlainObject, toggleClass } from '../utils';\n\n/**\n * @namespace PSV.buttons\n */\n\n/**\n * @summary Base navbar button class\n * @extends PSV.components.AbstractComponent\n * @memberof PSV.buttons\n * @abstract\n */\nexport class AbstractButton extends AbstractComponent {\n\n  /**\n   * @summary Unique identifier of the button\n   * @member {string}\n   * @readonly\n   * @static\n   */\n  static id = null;\n\n  /**\n   * @summary SVG icon name injected in the button\n   * @member {string}\n   * @readonly\n   * @static\n   */\n  static icon = null;\n\n  /**\n   * @summary SVG icon name injected in the button when it is active\n   * @member {string}\n   * @readonly\n   * @static\n   */\n  static iconActive = null;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   * @param {string} [className] - Additional CSS classes\n   * @param {boolean} [collapsable=false] - `true` if the button can be moved to menu when the navbar is too small\n   * @param {boolean} [tabbable=true] - `true` if the button is accessible with the keyboard\n   */\n  constructor(navbar, className = '', collapsable = false, tabbable = true) {\n    super(navbar, 'psv-button ' + className);\n\n    /**\n     * @override\n     * @property {string} id - Unique identifier of the button\n     * @property {boolean} enabled\n     * @property {boolean} supported\n     * @property {boolean} collapsed\n     * @property {boolean} active\n     * @property {number} width\n     */\n    this.prop = {\n      ...this.prop,\n      id         : this.constructor.id,\n      collapsable: collapsable,\n      enabled    : true,\n      supported  : true,\n      collapsed  : false,\n      active     : false,\n      width      : this.container.offsetWidth,\n    };\n\n    if (this.constructor.icon) {\n      this.__setIcon(this.constructor.icon);\n    }\n\n    if (this.prop.id && this.psv.config.lang[this.prop.id]) {\n      this.container.title = this.psv.config.lang[this.prop.id];\n    }\n\n    if (tabbable) {\n      this.container.tabIndex = 0;\n    }\n\n    this.container.addEventListener('click', (e) => {\n      if (this.prop.enabled) {\n        this.onClick();\n      }\n      e.stopPropagation();\n    });\n\n    this.container.addEventListener('keydown', (e) => {\n      if (getEventKey(e) === KEY_CODES.Enter && this.prop.enabled) {\n        this.onClick();\n        e.stopPropagation();\n      }\n    });\n  }\n\n  /**\n   * @package\n   */\n  checkSupported() {\n    const supportedOrObject = this.isSupported();\n    if (isPlainObject(supportedOrObject)) {\n      if (supportedOrObject.initial === false) {\n        this.hide();\n        this.prop.supported = false;\n      }\n\n      supportedOrObject.promise.then((supported) => {\n        if (!this.prop) {\n          return; // the component has been destroyed\n        }\n        this.prop.supported = supported;\n        if (!supported && this.prop.visible) {\n          this.hide();\n        }\n        else if (supported && !this.prop.visible) {\n          this.show();\n        }\n      });\n    }\n    else if (!supportedOrObject) {\n      this.hide();\n      this.prop.supported = false;\n    }\n  }\n\n  /**\n   * @summary Checks if the button can be displayed\n   * @returns {boolean|{initial: boolean, promise: Promise<boolean>}}\n   */\n  isSupported() {\n    return true;\n  }\n\n  /**\n   * @summary Changes the active state of the button\n   * @param {boolean} [active] - forced state\n   */\n  toggleActive(active) {\n    this.prop.active = active !== undefined ? active : !this.prop.active;\n    toggleClass(this.container, 'psv-button--active', this.prop.active);\n\n    if (this.constructor.iconActive) {\n      this.__setIcon(this.prop.active ? this.constructor.iconActive : this.constructor.icon);\n    }\n  }\n\n  /**\n   * @override\n   */\n  show(refresh = true) {\n    if (!this.isVisible()) {\n      this.prop.visible = true;\n      if (!this.prop.collapsed) {\n        this.container.style.display = '';\n      }\n      if (refresh) {\n        this.psv.refreshUi(`show button ${this.prop.id}`);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  hide(refresh = true) {\n    if (this.isVisible()) {\n      this.prop.visible = false;\n      this.container.style.display = 'none';\n      if (refresh) {\n        this.psv.refreshUi(`hide button ${this.prop.id}`);\n      }\n    }\n  }\n\n  /**\n   * @summary Disables the button\n   */\n  disable() {\n    this.container.classList.add('psv-button--disabled');\n    this.prop.enabled = false;\n  }\n\n  /**\n   * @summary Enables the button\n   */\n  enable() {\n    this.container.classList.remove('psv-button--disabled');\n    this.prop.enabled = true;\n  }\n\n  /**\n   * @summary Collapses the button in the navbar menu\n   */\n  collapse() {\n    this.prop.collapsed = true;\n    this.container.style.display = 'none';\n  }\n\n  /**\n   * @summary Uncollapses the button from the navbar menu\n   */\n  uncollapse() {\n    this.prop.collapsed = false;\n    if (this.prop.visible) {\n      this.container.style.display = '';\n    }\n  }\n\n  /**\n   * @summary Set the button icon\n   * @param {string} icon SVG\n   * @param {HTMLElement} [container] - default is the main button container\n   * @private\n   */\n  __setIcon(icon, container = this.container) {\n    if (icon) {\n      container.innerHTML = icon;\n      // classList not supported on IE11, className is read-only !!!!\n      container.querySelector('svg').setAttribute('class', 'psv-button-svg');\n    }\n    else {\n      container.innerHTML = '';\n    }\n  }\n\n  /**\n   * @summary Action when the button is clicked\n   * @private\n   * @abstract\n   */\n  onClick() {\n    throw new PSVError(`onClick not implemented for button \"${this.prop.id}\".`);\n  }\n\n}\n","import { EVENTS } from '../data/constants';\nimport playActive from '../icons/play-active.svg';\nimport play from '../icons/play.svg';\nimport { AbstractButton } from './AbstractButton';\n\n/**\n * @summary Navigation bar autorotate button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class AutorotateButton extends AbstractButton {\n\n  static id = 'autorotate';\n  static icon = play;\n  static iconActive = playActive;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-autorotate-button', true);\n\n    this.psv.on(EVENTS.AUTOROTATE, this);\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.off(EVENTS.AUTOROTATE, this);\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case EVENTS.AUTOROTATE: this.toggleActive(e.args[0]); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles autorotate\n   */\n  onClick() {\n    this.psv.toggleAutorotate();\n  }\n\n}\n","import { addClasses } from '../utils';\nimport { AbstractButton } from './AbstractButton';\n\n/**\n * @summary Navigation bar custom button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class CustomButton extends AbstractButton {\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   * @param {PSV.NavbarCustomButton} config\n   */\n  constructor(navbar, config) {\n    super(navbar, 'psv-custom-button', config.collapsable !== false, config.tabbable !== false);\n\n    /**\n     * @member {Object}\n     * @readonly\n     * @private\n     */\n    this.config = config;\n\n    if (this.config.id) {\n      this.prop.id = this.config.id;\n    }\n    else {\n      this.prop.id = 'psvButton-' + Math.random().toString(36).substr(2, 9);\n    }\n\n    if (this.config.className) {\n      addClasses(this.container, this.config.className);\n    }\n\n    if (this.config.title) {\n      this.container.title = this.config.title;\n    }\n\n    if (this.config.content) {\n      this.container.innerHTML = this.config.content;\n    }\n\n    this.prop.width = this.container.offsetWidth;\n\n    if (this.config.enabled === false) {\n      this.disable();\n    }\n\n    if (this.config.visible === false) {\n      this.hide();\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    delete this.config;\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   * @description Calls user method\n   */\n  onClick() {\n    if (this.config.onClick) {\n      this.config.onClick.apply(this.psv);\n    }\n  }\n\n}\n","import { AbstractButton } from './AbstractButton';\nimport download from '../icons/download.svg';\n\n/**\n * @summary Navigation bar download button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class DownloadButton extends AbstractButton {\n\n  static id = 'download';\n  static icon = download;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-download-button', true);\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return this.psv.adapter.constructor.supportsDownload || !!this.psv.config.downloadUrl;\n  }\n\n  /**\n   * @override\n   * @description Asks the browser to download the panorama source file\n   */\n  onClick() {\n    const link = document.createElement('a');\n    link.href = this.psv.config.downloadUrl || this.psv.config.panorama;\n    link.download = link.href.split('/').pop();\n    this.psv.container.appendChild(link);\n    link.click();\n\n    setTimeout(() => {\n      this.psv.container.removeChild(link);\n    }, 100);\n  }\n\n}\n","import { EVENTS } from '../data/constants';\nimport fullscreenIn from '../icons/fullscreen-in.svg';\nimport fullscreenOut from '../icons/fullscreen-out.svg';\nimport { AbstractButton } from './AbstractButton';\n\n/**\n * @summary Navigation bar fullscreen button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class FullscreenButton extends AbstractButton {\n\n  static id = 'fullscreen';\n  static icon = fullscreenIn;\n  static iconActive = fullscreenOut;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-fullscreen-button');\n\n    this.psv.on(EVENTS.FULLSCREEN_UPDATED, this);\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.off(EVENTS.FULLSCREEN_UPDATED, this);\n\n    super.destroy();\n  }\n\n  /**\n   * Handle events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case EVENTS.FULLSCREEN_UPDATED: this.toggleActive(e.args[0]); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles fullscreen\n   */\n  onClick() {\n    this.psv.toggleFullscreen();\n  }\n\n}\n","import { EVENTS, IDS } from '../data/constants';\nimport menuIcon from '../icons/menu.svg';\nimport { dasherize, getClosest } from '../utils';\nimport { AbstractButton } from './AbstractButton';\n\n/**\n * @summary Navigation bar menu button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class MenuButton extends AbstractButton {\n\n  static id = 'menu';\n  static icon = menuIcon;\n\n  /**\n   * @summary Property name added to buttons list\n   * @type {string}\n   * @constant\n   */\n  static BUTTON_DATA = 'psvButton';\n\n  /**\n   * @summary Menu template\n   * @param {AbstractButton[]} buttons\n   * @param {PSV.Viewer} psv\n   * @param {string} dataKey\n   * @returns {string}\n   */\n  static MENU_TEMPLATE = (buttons, psv, dataKey) => `\n<div class=\"psv-panel-menu psv-panel-menu--stripped\">\n  <h1 class=\"psv-panel-menu-title\">${menuIcon} ${psv.config.lang.menu}</h1>\n  <ul class=\"psv-panel-menu-list\">\n    ${buttons.map(button => `\n    <li data-${dataKey}=\"${button.prop.id}\" class=\"psv-panel-menu-item\" tabindex=\"0\">\n      <span class=\"psv-panel-menu-item-icon\">${button.container.innerHTML}</span>\n      <span class=\"psv-panel-menu-item-label\">${button.container.title}</span>\n    </li>\n    `).join('')}\n  </ul>\n</div>\n`;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-menu-button');\n\n    this.psv.on(EVENTS.OPEN_PANEL, this);\n    this.psv.on(EVENTS.CLOSE_PANEL, this);\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.off(EVENTS.OPEN_PANEL, this);\n    this.psv.off(EVENTS.CLOSE_PANEL, this);\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case EVENTS.OPEN_PANEL:  this.toggleActive(e.args[0] === IDS.MENU); break;\n      case EVENTS.CLOSE_PANEL: this.toggleActive(false); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   */\n  hide(refresh) {\n    super.hide(refresh);\n    this.__hideMenu();\n  }\n\n  /**\n   * @override\n   */\n  show(refresh) {\n    super.show(refresh);\n\n    if (this.prop.active) {\n      this.__showMenu();\n    }\n  }\n\n  /**\n   * @override\n   * @description Toggles menu\n   */\n  onClick() {\n    if (this.prop.active) {\n      this.__hideMenu();\n    }\n    else {\n      this.__showMenu();\n    }\n  }\n\n  __showMenu() {\n    this.psv.panel.show({\n      id          : IDS.MENU,\n      content     : MenuButton.MENU_TEMPLATE(this.parent.collapsed, this.psv, dasherize(MenuButton.BUTTON_DATA)),\n      noMargin    : true,\n      clickHandler: (e) => {\n        const li = e.target ? getClosest(e.target, 'li') : undefined;\n        const buttonId = li ? li.dataset[MenuButton.BUTTON_DATA] : undefined;\n\n        if (buttonId) {\n          this.parent.getButton(buttonId).onClick();\n          this.__hideMenu();\n        }\n      },\n    });\n  }\n\n  __hideMenu() {\n    if (this.psv.panel) {\n      this.psv.panel.hide(IDS.MENU);\n    }\n  }\n\n}\n","import { PSVError } from '../PSVError';\n\n/**\n * @summary General information about the system\n * @constant\n * @memberOf PSV\n * @property {boolean} loaded - Indicates if the system data has been loaded\n * @property {Function} load - Loads the system if not already loaded\n * @property {number} pixelRatio\n * @property {boolean} isWebGLSupported\n * @property {number} maxCanvasWidth\n * @property {string} mouseWheelEvent\n * @property {string} fullscreenEvent\n * @property {Function} getMaxCanvasWidth - Returns the max width of a canvas allowed by the browser\n * @property {Promise<boolean>} isTouchEnabled\n */\nexport const SYSTEM = {\n  loaded          : false,\n  pixelRatio      : 1,\n  isWebGLSupported: false,\n  isTouchEnabled  : null,\n  maxTextureWidth : 0,\n  mouseWheelEvent : null,\n  fullscreenEvent : null,\n};\n\n/**\n * @summary Loads the system if not already loaded\n */\nSYSTEM.load = () => {\n  if (!SYSTEM.loaded) {\n    const ctx = getWebGLCtx();\n\n    SYSTEM.loaded = true;\n    SYSTEM.pixelRatio = window.devicePixelRatio || 1;\n    SYSTEM.isWebGLSupported = ctx != null;\n    SYSTEM.isTouchEnabled = isTouchEnabled();\n    SYSTEM.maxTextureWidth = getMaxTextureWidth(ctx);\n    SYSTEM.mouseWheelEvent = getMouseWheelEvent();\n    SYSTEM.fullscreenEvent = getFullscreenEvent();\n  }\n};\n\nlet maxCanvasWidth = null;\nSYSTEM.getMaxCanvasWidth = () => {\n  if (maxCanvasWidth === null) {\n    maxCanvasWidth = getMaxCanvasWidth(SYSTEM.maxTextureWidth);\n  }\n  return maxCanvasWidth;\n};\n\n/**\n * @summary Tries to return a canvas webgl context\n * @returns {WebGLRenderingContext}\n * @private\n */\nfunction getWebGLCtx() {\n  const canvas = document.createElement('canvas');\n  const names = ['webgl', 'experimental-webgl', 'moz-webgl', 'webkit-3d'];\n  let context = null;\n\n  if (!canvas.getContext) {\n    return null;\n  }\n\n  if (names.some((name) => {\n    try {\n      context = canvas.getContext(name);\n      return context !== null;\n    }\n    catch (e) {\n      return false;\n    }\n  })) {\n    return context;\n  }\n  else {\n    return null;\n  }\n}\n\n/**\n * @summary Detects if the user is using a touch screen\n * @returns {Promise<boolean>}\n * @private\n */\nfunction isTouchEnabled() {\n  return new Promise((resolve) => {\n    const listener = (e) => {\n      if (e) {\n        resolve(true);\n      }\n      else {\n        resolve(false);\n      }\n\n      window.removeEventListener('touchstart', listener);\n    };\n\n    window.addEventListener('touchstart', listener, false);\n\n    // after 10 secs auto-reject the promise\n    setTimeout(listener, 10000);\n  });\n}\n\n/**\n * @summary Gets max texture width in WebGL context\n * @returns {number}\n * @private\n */\nfunction getMaxTextureWidth(ctx) {\n  if (ctx !== null) {\n    return ctx.getParameter(ctx.MAX_TEXTURE_SIZE);\n  }\n  else {\n    return 0;\n  }\n}\n\n/**\n * @summary Gets max canvas width supported by the browser.\n * We only test powers of 2 and height = width / 2 because that's what we need to generate WebGL textures\n * @param maxWidth\n * @return {number}\n * @private\n */\nfunction getMaxCanvasWidth(maxWidth) {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  canvas.width = maxWidth;\n  canvas.height = maxWidth / 2;\n\n  while (canvas.width > 1024) {\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, 1, 1);\n\n    try {\n      if (ctx.getImageData(0, 0, 1, 1).data[0] === 255) {\n        return canvas.width;\n      }\n    }\n    catch (e) {\n      // continue\n    }\n\n    canvas.width /= 2;\n    canvas.height /= 2;\n  }\n\n  throw new PSVError('Unable to detect system capabilities');\n}\n\n/**\n * @summary Gets the event name for mouse wheel\n * @returns {string}\n * @private\n */\nfunction getMouseWheelEvent() {\n  if ('onwheel' in document.createElement('div')) { // Modern browsers support \"wheel\"\n    return 'wheel';\n  }\n  else if (document.onmousewheel !== undefined) { // Webkit and IE support at least \"mousewheel\"\n    return 'mousewheel';\n  }\n  else { // let's assume that remaining browsers are older Firefox\n    return 'DOMMouseScroll';\n  }\n}\n\n/**\n * @summary Map between fullsceen method and fullscreen event name\n * @type {Object<string, string>}\n * @readonly\n * @private\n */\nconst FULLSCREEN_EVT_MAP = {\n  exitFullscreen      : 'fullscreenchange',\n  webkitExitFullscreen: 'webkitfullscreenchange',\n  mozCancelFullScreen : 'mozfullscreenchange',\n  msExitFullscreen    : 'MSFullscreenChange',\n};\n\n\n/**\n * @summary  Gets the event name for fullscreen\n * @returns {string}\n * @private\n */\nfunction getFullscreenEvent() {\n  const validExits = Object.keys(FULLSCREEN_EVT_MAP).filter(exit => exit in document);\n\n  if (validExits.length) {\n    return FULLSCREEN_EVT_MAP[validExits[0]];\n  }\n  else {\n    return null;\n  }\n}\n","/**\n * @summary Helper for pressable things (buttons, keyboard)\n * @description When the pressed thing goes up and was not pressed long enough, wait a bit more before execution\n * @package\n * @package\n */\nexport class PressHandler {\n\n  constructor(delay = 200) {\n    this.delay = delay;\n    this.time = 0;\n    this.timeout = null;\n  }\n\n  down() {\n    if (this.timeout) {\n      clearTimeout(this.timeout);\n      this.timeout = null;\n    }\n\n    this.time = new Date().getTime();\n  }\n\n  up(cb) {\n    if (!this.time) {\n      return;\n    }\n\n    const elapsed = new Date().getTime() - this.time;\n    if (elapsed < this.delay) {\n      this.timeout = setTimeout(() => {\n        cb();\n        this.timeout = null;\n        this.time = 0;\n      }, this.delay);\n    }\n    else {\n      cb();\n      this.time = 0;\n    }\n  }\n\n}\n","import { KEY_CODES } from '../data/constants';\nimport { SYSTEM } from '../data/system';\nimport arrow from '../icons/arrow.svg';\nimport { getEventKey } from '../utils';\nimport { PressHandler } from '../utils/PressHandler';\nimport { AbstractButton } from './AbstractButton';\n\nexport function getOrientedArrow(direction) {\n  let angle = 0;\n  switch (direction) {\n    // @formatter:off\n    case 'up': angle = 90; break;\n    case 'right': angle = 180; break;\n    case 'down': angle = -90; break;\n    default: angle = 0; break;\n    // @formatter:on\n  }\n\n  return arrow.replace('rotate(0', `rotate(${angle}`);\n}\n\n/**\n * @summary Navigation bar move button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class AbstractMoveButton extends AbstractButton {\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   * @param {number} value\n   */\n  constructor(navbar, value) {\n    super(navbar, 'psv-button--hover-scale psv-move-button');\n\n    this.container.title = this.psv.config.lang.move;\n\n    /**\n     * @override\n     * @property {{longitude: boolean, latitude: boolean}} value\n     * @property {PressHandler} handler\n     */\n    this.prop = {\n      ...this.prop,\n      value  : value,\n      handler: new PressHandler(),\n    };\n\n    this.container.addEventListener('mousedown', this);\n    this.container.addEventListener('keydown', this);\n    this.container.addEventListener('keyup', this);\n    this.psv.container.addEventListener('mouseup', this);\n    this.psv.container.addEventListener('touchend', this);\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.__onMouseUp();\n\n    this.psv.container.removeEventListener('mouseup', this);\n    this.psv.container.removeEventListener('touchend', this);\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case 'mousedown': this.__onMouseDown(); break;\n      case 'mouseup':   this.__onMouseUp(); break;\n      case 'touchend':  this.__onMouseUp(); break;\n      case 'keydown':   getEventKey(e) === KEY_CODES.Enter && this.__onMouseDown(); break;\n      case 'keyup':     getEventKey(e) === KEY_CODES.Enter && this.__onMouseUp(); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return { initial: true, promise: SYSTEM.isTouchEnabled.then(enabled => !enabled) };\n  }\n\n  /**\n   * @override\n   */\n  onClick() {\n    // nothing\n  }\n\n  /**\n   * @private\n   */\n  __onMouseDown() {\n    if (!this.prop.enabled) {\n      return;\n    }\n\n    this.psv.__stopAll();\n    this.psv.dynamics.position.roll(this.prop.value);\n    this.prop.handler.down();\n  }\n\n  /**\n   * @private\n   */\n  __onMouseUp() {\n    if (!this.prop.enabled) {\n      return;\n    }\n\n    this.prop.handler.up(() => this.psv.dynamics.position.stop());\n  }\n\n}\n","import { AbstractMoveButton, getOrientedArrow } from './AbstractMoveButton';\n\n/**\n * @summary Navigation bar move down button class\n * @extends PSV.buttons.AbstractMoveButton\n * @memberof PSV.buttons\n */\nexport class MoveDownButton extends AbstractMoveButton {\n\n  static id = 'moveDown';\n  static icon = getOrientedArrow('down');\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, { latitude: true });\n  }\n\n}\n","import { AbstractMoveButton, getOrientedArrow } from './AbstractMoveButton';\n\n/**\n * @summary Navigation bar move left button class\n * @extends PSV.buttons.AbstractMoveButton\n * @memberof PSV.buttons\n */\nexport class MoveLeftButton extends AbstractMoveButton {\n\n  static id = 'moveLeft';\n  static icon = getOrientedArrow('left');\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, { longitude: true });\n  }\n\n}\n","import { AbstractMoveButton, getOrientedArrow } from './AbstractMoveButton';\n\n/**\n * @summary Navigation bar move right button class\n * @extends PSV.buttons.AbstractMoveButton\n * @memberof PSV.buttons\n */\nexport class MoveRightButton extends AbstractMoveButton {\n\n  static id = 'moveRight';\n  static icon = getOrientedArrow('right');\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, { longitude: false });\n  }\n\n}\n","import { AbstractMoveButton, getOrientedArrow } from './AbstractMoveButton';\n\n/**\n * @summary Navigation bar move up button class\n * @extends PSV.buttons.AbstractMoveButton\n * @memberof PSV.buttons\n */\nexport class MoveUpButton extends AbstractMoveButton {\n\n  static id = 'moveUp';\n  static icon = getOrientedArrow('up');\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, { latitude: false });\n  }\n\n}\n","import { KEY_CODES } from '../data/constants';\nimport { SYSTEM } from '../data/system';\nimport { getEventKey } from '../utils';\nimport { PressHandler } from '../utils/PressHandler';\nimport { AbstractButton } from './AbstractButton';\n\n/**\n * @summary Navigation bar zoom button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class AbstractZoomButton extends AbstractButton {\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   * @param {number} value\n   */\n  constructor(navbar, value) {\n    super(navbar, 'psv-button--hover-scale psv-zoom-button');\n\n    /**\n     * @override\n     * @property {boolean} value\n     * @property {PressHandler} handler\n     */\n    this.prop = {\n      ...this.prop,\n      value  : value,\n      handler: new PressHandler(),\n    };\n\n    this.container.addEventListener('mousedown', this);\n    this.container.addEventListener('keydown', this);\n    this.container.addEventListener('keyup', this);\n    this.psv.container.addEventListener('mouseup', this);\n    this.psv.container.addEventListener('touchend', this);\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.__onMouseUp();\n\n    this.psv.container.removeEventListener('mouseup', this);\n    this.psv.container.removeEventListener('touchend', this);\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case 'mousedown': this.__onMouseDown(); break;\n      case 'mouseup':   this.__onMouseUp(); break;\n      case 'touchend':  this.__onMouseUp(); break;\n      case 'keydown':   getEventKey(e) === KEY_CODES.Enter && this.__onMouseDown(); break;\n      case 'keyup':     getEventKey(e) === KEY_CODES.Enter && this.__onMouseUp(); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return { initial: true, promise: SYSTEM.isTouchEnabled.then(enabled => !enabled) };\n  }\n\n  /**\n   * @override\n   */\n  onClick() {\n    // nothing\n  }\n\n  /**\n   * @private\n   */\n  __onMouseDown() {\n    if (!this.prop.enabled) {\n      return;\n    }\n\n    this.psv.dynamics.zoom.roll(this.prop.value);\n    this.prop.handler.down();\n  }\n\n  /**\n   * @private\n   */\n  __onMouseUp() {\n    if (!this.prop.enabled) {\n      return;\n    }\n\n    this.prop.handler.up(() => this.psv.dynamics.zoom.stop());\n  }\n\n}\n","import { AbstractZoomButton } from './AbstractZoomButton';\nimport zoomIn from '../icons/zoom-in.svg';\n\n/**\n * @summary Navigation bar zoom-in button class\n * @extends PSV.buttons.AbstractZoomButton\n * @memberof PSV.buttons\n */\nexport class ZoomInButton extends AbstractZoomButton {\n\n  static id = 'zoomIn';\n  static icon = zoomIn;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, false);\n  }\n\n}\n","import { AbstractZoomButton } from './AbstractZoomButton';\nimport zoomOut from '../icons/zoom-out.svg';\n\n/**\n * @summary Navigation bar zoom-out button class\n * @extends PSV.buttons.AbstractZoomButton\n * @memberof PSV.buttons\n */\nexport class ZoomOutButton extends AbstractZoomButton {\n\n  static id = 'zoomOut';\n  static icon = zoomOut;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, true);\n  }\n\n}\n","import { EVENTS } from '../data/constants';\nimport { SYSTEM } from '../data/system';\nimport { getStyle } from '../utils';\nimport { AbstractButton } from './AbstractButton';\n\n/**\n * @summary Navigation bar zoom button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class ZoomRangeButton extends AbstractButton {\n\n  static id = 'zoomRange';\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-zoom-range', false, false);\n\n    /**\n     * @override\n     * @property {boolean} mousedown\n     * @property {number} mediaMinWidth\n     */\n    this.prop = {\n      ...this.prop,\n      mousedown    : false,\n      mediaMinWidth: 0,\n    };\n\n    /**\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.zoomRange = document.createElement('div');\n    this.zoomRange.className = 'psv-zoom-range-line';\n    this.container.appendChild(this.zoomRange);\n\n    /**\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.zoomValue = document.createElement('div');\n    this.zoomValue.className = 'psv-zoom-range-handle';\n    this.zoomRange.appendChild(this.zoomValue);\n\n    this.prop.mediaMinWidth = parseInt(getStyle(this.container, 'maxWidth'), 10);\n\n    this.container.addEventListener('mousedown', this);\n    this.container.addEventListener('touchstart', this);\n    this.psv.container.addEventListener('mousemove', this);\n    this.psv.container.addEventListener('touchmove', this);\n    this.psv.container.addEventListener('mouseup', this);\n    this.psv.container.addEventListener('touchend', this);\n\n    this.psv.on(EVENTS.ZOOM_UPDATED, this);\n\n    if (this.psv.prop.ready) {\n      this.__moveZoomValue(this.psv.getZoomLevel());\n    }\n    else {\n      this.psv.once(EVENTS.READY, this);\n    }\n\n    this.refreshUi();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.__stopZoomChange();\n\n    this.psv.container.removeEventListener('mousemove', this);\n    this.psv.container.removeEventListener('touchmove', this);\n    this.psv.container.removeEventListener('mouseup', this);\n    this.psv.container.removeEventListener('touchend', this);\n\n    delete this.zoomRange;\n    delete this.zoomValue;\n\n    this.psv.off(EVENTS.ZOOM_UPDATED, this);\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case 'mousedown':    this.__initZoomChangeWithMouse(e); break;\n      case 'touchstart':   this.__initZoomChangeByTouch(e);   break;\n      case 'mousemove':    this.__changeZoomWithMouse(e);     break;\n      case 'touchmove':    this.__changeZoomByTouch(e);       break;\n      case 'mouseup':      this.__stopZoomChange(e);          break;\n      case 'touchend':     this.__stopZoomChange(e);          break;\n      case EVENTS.ZOOM_UPDATED: this.__moveZoomValue(e.args[0]); break;\n      case EVENTS.READY:        this.__moveZoomValue(this.psv.getZoomLevel()); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return { initial: true, promise: SYSTEM.isTouchEnabled.then(enabled => !enabled) };\n  }\n\n  /**\n   * @override\n   */\n  refreshUi() {\n    if (this.prop.supported) {\n      if (this.psv.prop.size.width <= this.prop.mediaMinWidth && this.prop.visible) {\n        this.hide();\n      }\n      else if (this.psv.prop.size.width > this.prop.mediaMinWidth && !this.prop.visible) {\n        this.show();\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  onClick() {\n    // nothing\n  }\n\n  /**\n   * @summary Moves the zoom cursor\n   * @param {number} level\n   * @private\n   */\n  __moveZoomValue(level) {\n    this.zoomValue.style.left = (level / 100 * this.zoomRange.offsetWidth - this.zoomValue.offsetWidth / 2) + 'px';\n  }\n\n  /**\n   * @summary Handles mouse down events\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __initZoomChangeWithMouse(evt) {\n    if (!this.prop.enabled) {\n      return;\n    }\n\n    this.prop.mousedown = true;\n    this.__changeZoom(evt.clientX);\n  }\n\n  /**\n   * @summary Handles touch events\n   * @param {TouchEvent} evt\n   * @private\n   */\n  __initZoomChangeByTouch(evt) {\n    if (!this.prop.enabled) {\n      return;\n    }\n\n    this.prop.mousedown = true;\n    this.__changeZoom(evt.changedTouches[0].clientX);\n  }\n\n  /**\n   * @summary Handles mouse up events\n   * @private\n   */\n  __stopZoomChange() {\n    if (!this.prop.enabled) {\n      return;\n    }\n\n    this.prop.mousedown = false;\n    this.prop.buttondown = false;\n  }\n\n  /**\n   * @summary Handles mouse move events\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __changeZoomWithMouse(evt) {\n    if (!this.prop.enabled || !this.prop.mousedown) {\n      return;\n    }\n\n    evt.preventDefault();\n    this.__changeZoom(evt.clientX);\n  }\n\n  /**\n   * @summary Handles touch move events\n   * @param {TouchEvent} evt\n   * @private\n   */\n  __changeZoomByTouch(evt) {\n    if (!this.prop.enabled || !this.prop.mousedown) {\n      return;\n    }\n    this.__changeZoom(evt.changedTouches[0].clientX);\n  }\n\n  /**\n   * @summary Zoom change\n   * @param {number} x - mouse/touch position\n   * @private\n   */\n  __changeZoom(x) {\n    const userInput = x - this.zoomRange.getBoundingClientRect().left;\n    const zoomLevel = userInput / this.zoomRange.offsetWidth * 100;\n    this.psv.zoom(zoomLevel);\n  }\n\n}\n","import { PSVError } from '../PSVError';\n\n/**\n * @namespace PSV.adapters\n */\n\n/**\n * @summary Base adapters class\n * @memberof PSV.adapters\n * @abstract\n */\nexport class AbstractAdapter {\n\n  /**\n   * @summary Unique identifier of the adapter\n   * @member {string}\n   * @readonly\n   * @static\n   */\n  static id = null;\n\n  /**\n   * @summary Indicates if the adapter supports panorama download natively\n   * @type {boolean}\n   * @readonly\n   * @static\n   */\n  static supportsDownload = false;\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    /**\n     * @summary Reference to main controller\n     * @type {PSV.Viewer}\n     * @readonly\n     */\n    this.psv = psv;\n  }\n\n  /**\n   * @summary Destroys the adapter\n   */\n  destroy() {\n    delete this.psv;\n  }\n\n  /**\n   * @summary Indicates if the adapter supports transitions between panoramas\n   * @param {*} panorama\n   * @return {boolean}\n   */\n  supportsTransition(panorama) { // eslint-disable-line no-unused-vars\n    return false;\n  }\n\n  /**\n   * @summary Indicates if the adapter supports preload of a panorama\n   * @param {*} panorama\n   * @return {boolean}\n   */\n  supportsPreload(panorama) { // eslint-disable-line no-unused-vars\n    return false;\n  }\n\n  /**\n   * @abstract\n   * @summary Loads the panorama texture(s)\n   * @param {*} panorama\n   * @param {PSV.PanoData | PSV.PanoDataProvider} [newPanoData]\n   * @returns {Promise.<PSV.TextureData>}\n   */\n  loadTexture(panorama, newPanoData) { // eslint-disable-line no-unused-vars\n    throw new PSVError('loadTexture not implemented');\n  }\n\n  /**\n   * @abstract\n   * @summary Creates the cube mesh\n   * @param {number} [scale=1]\n   * @returns {external:THREE.Mesh}\n   */\n  createMesh(scale = 1) { // eslint-disable-line no-unused-vars\n    throw new PSVError('createMesh not implemented');\n  }\n\n  /**\n   * @abstract\n   * @summary Applies the texture to the mesh\n   * @param {external:THREE.Mesh} mesh\n   * @param {PSV.TextureData} textureData\n   * @param {boolean} [transition=false]\n   */\n  setTexture(mesh, textureData, transition = false) { // eslint-disable-line no-unused-vars\n    throw new PSVError('setTexture not implemented');\n  }\n\n  /**\n   * @abstract\n   * @summary Changes the opacity of the mesh\n   * @param {external:THREE.Mesh} mesh\n   * @param {number} opacity\n   */\n  setTextureOpacity(mesh, opacity) { // eslint-disable-line no-unused-vars\n    throw new PSVError('setTextureOpacity not implemented');\n  }\n\n  /**\n   * @abstract\n   * @summary Clear a loaded texture from memory\n   * @param {PSV.TextureData} textureData\n   */\n  disposeTexture(textureData) { // eslint-disable-line no-unused-vars\n    throw new PSVError('disposeTexture not implemented');\n  }\n\n}\n","import * as THREE from 'three';\nimport { SPHERE_RADIUS } from '../../data/constants';\nimport { SYSTEM } from '../../data/system';\nimport { PSVError } from '../../PSVError';\nimport { createTexture, firstNonNull, getXMPValue, isPowerOfTwo, logWarn } from '../../utils';\nimport { AbstractAdapter } from '../AbstractAdapter';\n\n\n/**\n * @typedef {Object} PSV.adapters.EquirectangularAdapter.Options\n * @property {number} [resolution=64] - number of faces of the sphere geometry, higher values may decrease performances\n */\n\n\n/**\n * @summary Adapter for equirectangular panoramas\n * @memberof PSV.adapters\n */\nexport class EquirectangularAdapter extends AbstractAdapter {\n\n  static id = 'equirectangular';\n  static supportsDownload = true;\n\n  /**\n   * @param {PSV.Viewer} psv\n   * @param {PSV.adapters.EquirectangularAdapter.Options} options\n   */\n  constructor(psv, options) {\n    super(psv);\n\n    /**\n     * @member {PSV.adapters.EquirectangularAdapter.Options}\n     * @private\n     */\n    this.config = {\n      resolution: 64,\n      ...options,\n    };\n\n    if (!isPowerOfTwo(this.config.resolution)) {\n      throw new PSVError('EquirectangularAdapter resolution must be power of two');\n    }\n\n    this.SPHERE_SEGMENTS = this.config.resolution;\n    this.SPHERE_HORIZONTAL_SEGMENTS = this.SPHERE_SEGMENTS / 2;\n  }\n\n  /**\n   * @override\n   */\n  supportsTransition() {\n    return true;\n  }\n\n  /**\n   * @override\n   */\n  supportsPreload() {\n    return true;\n  }\n\n  /**\n   * @override\n   * @param {string} panorama\n   * @param {PSV.PanoData | PSV.PanoDataProvider} [newPanoData]\n   * @returns {Promise.<PSV.TextureData>}\n   */\n  loadTexture(panorama, newPanoData) {\n    if (typeof panorama !== 'string') {\n      if (Array.isArray(panorama) || typeof panorama === 'object' && !!panorama.left) {\n        logWarn('Cubemap support now requires an additional adapter, see https://photo-sphere-viewer.js.org/guide/adapters');\n      }\n      return Promise.reject(new PSVError('Invalid panorama url, are you using the right adapter?'));\n    }\n\n    return (\n      !this.psv.config.useXmpData\n        ? this.psv.textureLoader.loadImage(panorama, p => this.psv.loader.setProgress(p))\n          .then(img => ({ img: img, xmpPanoData: null }))\n        : this.__loadXMP(panorama, p => this.psv.loader.setProgress(p))\n          .then(xmpPanoData => this.psv.textureLoader.loadImage(panorama).then(img => ({ img, xmpPanoData })))\n    )\n      .then(({ img, xmpPanoData }) => {\n        if (typeof newPanoData === 'function') {\n          newPanoData = newPanoData(img);\n        }\n\n        const panoData = {\n          fullWidth    : firstNonNull(newPanoData?.fullWidth, xmpPanoData?.fullWidth, img.width),\n          fullHeight   : firstNonNull(newPanoData?.fullHeight, xmpPanoData?.fullHeight, img.height),\n          croppedWidth : firstNonNull(newPanoData?.croppedWidth, xmpPanoData?.croppedWidth, img.width),\n          croppedHeight: firstNonNull(newPanoData?.croppedHeight, xmpPanoData?.croppedHeight, img.height),\n          croppedX     : firstNonNull(newPanoData?.croppedX, xmpPanoData?.croppedX, 0),\n          croppedY     : firstNonNull(newPanoData?.croppedY, xmpPanoData?.croppedY, 0),\n          poseHeading  : firstNonNull(newPanoData?.poseHeading, xmpPanoData?.poseHeading, 0),\n          posePitch    : firstNonNull(newPanoData?.posePitch, xmpPanoData?.posePitch, 0),\n          poseRoll     : firstNonNull(newPanoData?.poseRoll, xmpPanoData?.poseRoll, 0),\n        };\n\n        if (panoData.croppedWidth !== img.width || panoData.croppedHeight !== img.height) {\n          logWarn(`Invalid panoData, croppedWidth and/or croppedHeight is not coherent with loaded image.\n    panoData: ${panoData.croppedWidth}x${panoData.croppedHeight}, image: ${img.width}x${img.height}`);\n        }\n        if ((newPanoData || xmpPanoData) && panoData.fullWidth !== panoData.fullHeight * 2) {\n          logWarn('Invalid panoData, fullWidth should be twice fullHeight');\n        }\n\n        const texture = this.__createEquirectangularTexture(img, panoData);\n\n        return { panorama, texture, panoData };\n      });\n  }\n\n  /**\n   * @summary Loads the XMP data of an image\n   * @param {string} panorama\n   * @param {function(number)} [onProgress]\n   * @returns {Promise<PSV.PanoData>}\n   * @throws {PSV.PSVError} when the image cannot be loaded\n   * @private\n   */\n  __loadXMP(panorama, onProgress) {\n    return this.psv.textureLoader.loadFile(panorama, onProgress)\n      .then(blob => this.__loadBlobAsString(blob))\n      .then((binary) => {\n        const a = binary.indexOf('<x:xmpmeta');\n        const b = binary.indexOf('</x:xmpmeta>');\n        const data = binary.substring(a, b);\n\n        if (a !== -1 && b !== -1 && data.indexOf('GPano:') !== -1) {\n          return {\n            fullWidth    : getXMPValue(data, 'FullPanoWidthPixels'),\n            fullHeight   : getXMPValue(data, 'FullPanoHeightPixels'),\n            croppedWidth : getXMPValue(data, 'CroppedAreaImageWidthPixels'),\n            croppedHeight: getXMPValue(data, 'CroppedAreaImageHeightPixels'),\n            croppedX     : getXMPValue(data, 'CroppedAreaLeftPixels'),\n            croppedY     : getXMPValue(data, 'CroppedAreaTopPixels'),\n            poseHeading  : getXMPValue(data, 'PoseHeadingDegrees'),\n            posePitch    : getXMPValue(data, 'PosePitchDegrees'),\n            poseRoll     : getXMPValue(data, 'PoseRollDegrees'),\n          };\n        }\n\n        return null;\n      });\n  }\n\n  /**\n   * @summmary read a Blob as string\n   * @param {Blob} blob\n   * @returns {Promise<string>}\n   * @private\n   */\n  __loadBlobAsString(blob) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => resolve(reader.result);\n      reader.onerror = reject;\n      reader.readAsText(blob);\n    });\n  }\n\n  /**\n   * @summary Creates the final texture from image and panorama data\n   * @param {Image} img\n   * @param {PSV.PanoData} panoData\n   * @returns {external:THREE.Texture}\n   * @private\n   */\n  __createEquirectangularTexture(img, panoData) {\n    // resize image / fill cropped parts with black\n    if (panoData.fullWidth > SYSTEM.maxTextureWidth\n      || panoData.croppedWidth !== panoData.fullWidth\n      || panoData.croppedHeight !== panoData.fullHeight\n    ) {\n      const ratio = SYSTEM.getMaxCanvasWidth() / panoData.fullWidth;\n\n      const resizedPanoData = { ...panoData };\n      if (ratio < 1) {\n        resizedPanoData.fullWidth *= ratio;\n        resizedPanoData.fullHeight *= ratio;\n        resizedPanoData.croppedWidth *= ratio;\n        resizedPanoData.croppedHeight *= ratio;\n        resizedPanoData.croppedX *= ratio;\n        resizedPanoData.croppedY *= ratio;\n      }\n\n      const buffer = document.createElement('canvas');\n      buffer.width = resizedPanoData.fullWidth;\n      buffer.height = resizedPanoData.fullHeight;\n\n      const ctx = buffer.getContext('2d');\n      ctx.drawImage(img,\n        resizedPanoData.croppedX, resizedPanoData.croppedY,\n        resizedPanoData.croppedWidth, resizedPanoData.croppedHeight);\n\n      return createTexture(buffer);\n    }\n\n    return createTexture(img);\n  }\n\n  /**\n   * @override\n   */\n  createMesh(scale = 1) {\n    // The middle of the panorama is placed at longitude=0\n    const geometry = new THREE.SphereGeometry(SPHERE_RADIUS * scale, this.SPHERE_SEGMENTS, this.SPHERE_HORIZONTAL_SEGMENTS, -Math.PI / 2)\n      .scale(-1, 1, 1);\n\n    const material = new THREE.MeshBasicMaterial();\n\n    return new THREE.Mesh(geometry, material);\n  }\n\n  /**\n   * @override\n   */\n  setTexture(mesh, textureData) {\n    const { texture } = textureData;\n\n    mesh.material.map?.dispose();\n    mesh.material.map = texture;\n  }\n\n  /**\n   * @override\n   */\n  setTextureOpacity(mesh, opacity) {\n    mesh.material.opacity = opacity;\n    mesh.material.transparent = opacity < 1;\n  }\n\n  /**\n   * @override\n   */\n  disposeTexture(textureData) {\n    textureData.texture?.dispose();\n  }\n\n}\n","import { EventEmitter } from 'uevent';\n\n/**\n * @namespace PSV.plugins\n */\n\n/**\n * @summary Base plugins class\n * @memberof PSV.plugins\n * @abstract\n */\nexport class AbstractPlugin extends EventEmitter {\n\n  /**\n   * @summary Unique identifier of the plugin\n   * @member {string}\n   * @readonly\n   * @static\n   */\n  static id = null;\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super();\n\n    /**\n     * @summary Reference to main controller\n     * @type {PSV.Viewer}\n     * @readonly\n     */\n    this.psv = psv;\n  }\n\n  /**\n   * @summary Initializes the plugin\n   * @package\n   */\n  init() {\n  }\n\n  /**\n   * @summary Destroys the plugin\n   * @package\n   */\n  destroy() {\n    delete this.psv;\n  }\n\n}\n","import { AbstractAdapter } from '../adapters/AbstractAdapter';\nimport { EquirectangularAdapter } from '../adapters/equirectangular';\nimport { AbstractPlugin } from '../plugins/AbstractPlugin';\nimport { PSVError } from '../PSVError';\nimport { bound, clone, deepmerge, each, logWarn, parseAngle, parseSpeed, pluginInterop } from '../utils';\nimport { ACTIONS, KEY_CODES } from './constants';\n\n/**\n * @summary Default options\n * @type {PSV.Options}\n * @memberOf PSV\n * @constant\n */\nexport const DEFAULTS = {\n  panorama           : null,\n  container          : null,\n  adapter            : null,\n  plugins            : [],\n  caption            : null,\n  downloadUrl        : null,\n  loadingImg         : null,\n  loadingTxt         : 'Loading...',\n  size               : null,\n  fisheye            : false,\n  minFov             : 30,\n  maxFov             : 90,\n  defaultZoomLvl     : 50,\n  defaultLong        : 0,\n  defaultLat         : 0,\n  sphereCorrection   : null,\n  moveSpeed          : 1,\n  zoomSpeed          : 1,\n  autorotateDelay    : null,\n  autorotateSpeed    : '2rpm',\n  autorotateLat      : null,\n  moveInertia        : true,\n  mousewheel         : true,\n  mousemove          : true,\n  captureCursor      : false,\n  mousewheelCtrlKey  : false,\n  touchmoveTwoFingers: false,\n  useXmpData         : true,\n  panoData           : null,\n  requestHeaders     : null,\n  canvasBackground   : '#000',\n  withCredentials    : false,\n  navbar             : [\n    'autorotate',\n    'zoom',\n    'move',\n    'download',\n    'caption',\n    'fullscreen',\n  ],\n  lang               : {\n    autorotate: 'Automatic rotation',\n    zoom      : 'Zoom',\n    zoomOut   : 'Zoom out',\n    zoomIn    : 'Zoom in',\n    move      : 'Move',\n    download  : 'Download',\n    fullscreen: 'Fullscreen',\n    menu      : 'Menu',\n    twoFingers: 'Use two fingers to navigate',\n    ctrlZoom  : 'Use ctrl + scroll to zoom the image',\n    loadError : 'The panorama can\\'t be loaded',\n  },\n  keyboard           : {\n    [KEY_CODES.ArrowUp]   : ACTIONS.ROTATE_LAT_UP,\n    [KEY_CODES.ArrowDown] : ACTIONS.ROTATE_LAT_DOWN,\n    [KEY_CODES.ArrowRight]: ACTIONS.ROTATE_LONG_RIGHT,\n    [KEY_CODES.ArrowLeft] : ACTIONS.ROTATE_LONG_LEFT,\n    [KEY_CODES.PageUp]    : ACTIONS.ZOOM_IN,\n    [KEY_CODES.PageDown]  : ACTIONS.ZOOM_OUT,\n    [KEY_CODES.Plus]      : ACTIONS.ZOOM_IN,\n    [KEY_CODES.Minus]     : ACTIONS.ZOOM_OUT,\n    [KEY_CODES.Space]     : ACTIONS.TOGGLE_AUTOROTATE,\n  },\n};\n\n/**\n * @summary List of unmodifiable options and their error messages\n * @private\n */\nexport const READONLY_OPTIONS = {\n  panorama : 'Use setPanorama method to change the panorama',\n  panoData : 'Use setPanorama method to change the panorama',\n  container: 'Cannot change viewer container',\n  adapter  : 'Cannot change adapter',\n  plugins  : 'Cannot change plugins',\n};\n\n/**\n * @summary List of deprecated options and their warning messages\n * @private\n */\nexport const DEPRECATED_OPTIONS = {\n  zoomButtonIncrement    : 'zoomButtonIncrement is deprecated, use zoomSpeed',\n  mousewheelSpeed        : 'mousewheelSpeed is deprecated, use zoomSpeed',\n  sphereCorrectionReorder: 'sphereCorrectionReorder is deprecated',\n};\n\n/**\n * @summary Parsers/validators for each option\n * @private\n */\nexport const CONFIG_PARSERS = {\n  container      : (container) => {\n    if (!container) {\n      throw new PSVError('No value given for container.');\n    }\n    return container;\n  },\n  adapter        : (adapter) => {\n    if (!adapter) {\n      adapter = [EquirectangularAdapter];\n    }\n    else if (Array.isArray(adapter)) {\n      adapter = [pluginInterop(adapter[0], AbstractAdapter), adapter[1]];\n    }\n    else {\n      adapter = [pluginInterop(adapter, AbstractAdapter)];\n    }\n    if (!adapter[0]) {\n      throw new PSVError('Un undefined value with given for adapter.');\n    }\n    return adapter;\n  },\n  defaultLong    : (defaultLong) => {\n    // defaultLat is between 0 and PI\n    return parseAngle(defaultLong);\n  },\n  defaultLat     : (defaultLat) => {\n    // defaultLat is between -PI/2 and PI/2\n    return parseAngle(defaultLat, true);\n  },\n  minFov         : (minFov, config) => {\n    // minFov and maxFov must be ordered\n    if (config.maxFov < minFov) {\n      logWarn('maxFov cannot be lower than minFov');\n      minFov = config.maxFov;\n    }\n    // minFov between 1 and 179\n    return bound(minFov, 1, 179);\n  },\n  maxFov         : (maxFov, config) => {\n    // minFov and maxFov must be ordered\n    if (maxFov < config.minFov) {\n      maxFov = config.minFov;\n    }\n    // maxFov between 1 and 179\n    return bound(maxFov, 1, 179);\n  },\n  lang           : (lang) => {\n    if (Array.isArray(lang.twoFingers)) {\n      logWarn('lang.twoFingers must not be an array');\n      lang.twoFingers = lang.twoFingers[0];\n    }\n    return {\n      ...DEFAULTS.lang,\n      ...lang,\n    };\n  },\n  keyboard       : (keyboard) => {\n    // keyboard=true becomes the default map\n    if (keyboard === true) {\n      return clone(DEFAULTS.keyboard);\n    }\n    return keyboard;\n  },\n  autorotateLat  : (autorotateLat, config) => {\n    // default autorotateLat is defaultLat\n    if (autorotateLat === null) {\n      return parseAngle(config.defaultLat, true);\n    }\n    // autorotateLat is between -PI/2 and PI/2\n    else {\n      return parseAngle(autorotateLat, true);\n    }\n  },\n  autorotateSpeed: (autorotateSpeed) => {\n    return parseSpeed(autorotateSpeed);\n  },\n  fisheye        : (fisheye) => {\n    // translate boolean fisheye to amount\n    if (fisheye === true) {\n      return 1;\n    }\n    else if (fisheye === false) {\n      return 0;\n    }\n    return fisheye;\n  },\n  plugins        : (plugins) => {\n    return plugins\n      .map((plugin) => {\n        if (Array.isArray(plugin)) {\n          plugin = [pluginInterop(plugin[0], AbstractPlugin), plugin[1]];\n        }\n        else {\n          plugin = [pluginInterop(plugin, AbstractPlugin)];\n        }\n        if (!plugin[0]) {\n          throw new PSVError('Un undefined value was given for plugins.');\n        }\n        return plugin;\n      });\n  },\n};\n\n/**\n * @summary Merge user config with default config and performs validation\n * @param {PSV.Options} options\n * @returns {PSV.Options}\n * @memberOf PSV\n * @private\n */\nexport function getConfig(options) {\n  const tempConfig = clone(DEFAULTS);\n  deepmerge(tempConfig, options);\n\n  const config = {};\n\n  each(tempConfig, (value, key) => {\n    if (DEPRECATED_OPTIONS[key]) {\n      logWarn(DEPRECATED_OPTIONS[key]);\n      return;\n    }\n\n    if (!Object.prototype.hasOwnProperty.call(DEFAULTS, key)) {\n      throw new PSVError(`Unknown option ${key}`);\n    }\n\n    if (CONFIG_PARSERS[key]) {\n      config[key] = CONFIG_PARSERS[key](value, tempConfig);\n    }\n    else {\n      config[key] = value;\n    }\n  });\n\n  return config;\n}\n","import { AbstractButton } from './AbstractButton';\nimport { EVENTS } from '../data/constants';\nimport info from '../icons/info.svg';\n\n/**\n * @summary Navigation bar caption button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class CaptionButton extends AbstractButton {\n\n  static id = 'caption';\n  static icon = info;\n\n  /**\n   * @param {PSV.components.NavbarCaption} caption\n   */\n  constructor(caption) {\n    super(caption, 'psv-button--hover-scale psv-caption-button');\n\n    this.psv.on(EVENTS.HIDE_NOTIFICATION, this);\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.off(EVENTS.HIDE_NOTIFICATION, this);\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case EVENTS.HIDE_NOTIFICATION: this.toggleActive(false); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles caption\n   */\n  onClick() {\n    if (this.psv.notification.prop.visible) {\n      this.psv.notification.hide();\n    }\n    else {\n      this.psv.notification.show(this.parent.prop.caption);\n      this.toggleActive(true);\n    }\n  }\n\n}\n","import { CaptionButton } from '../buttons/CaptionButton';\nimport { AbstractComponent } from './AbstractComponent';\n\n/**\n * @summary Navbar caption class\n * @extends PSV.components.AbstractComponent\n * @memberof PSV.components\n */\nexport class NavbarCaption extends AbstractComponent {\n\n  static id = 'caption';\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   * @param {string} caption\n   */\n  constructor(navbar, caption) {\n    super(navbar, 'psv-caption');\n\n    /**\n     * @member {PSV.buttons.CaptionButton}\n     * @readonly\n     * @private\n     */\n    this.button = new CaptionButton(this);\n    this.button.hide();\n\n    /**\n     * @override\n     * @property {string} id\n     * @property {boolean} collapsable\n     * @property {number} width\n     * @property {string} caption\n     * @property {boolean} contentVisible - if the content is visible in the navbar\n     * @property {number} contentWidth - with of the caption content\n     */\n    this.prop = {\n      ...this.prop,\n      id            : this.constructor.id,\n      collapsable   : false,\n      width         : this.button.prop.width,\n      caption       : '',\n      contentVisible: true,\n      contentWidth  : 0,\n    };\n\n    /**\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.content = document.createElement('div');\n    this.content.className = 'psv-caption-content';\n    this.container.appendChild(this.content);\n\n    this.setCaption(caption);\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    delete this.button;\n    delete this.content;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Sets the bar caption\n   * @param {string} html\n   */\n  setCaption(html) {\n    this.prop.caption = html || '';\n    this.content.innerHTML = this.prop.caption;\n\n    if (html) {\n      this.show(false);\n\n      this.content.style.display = '';\n      this.prop.contentWidth = this.content.offsetWidth;\n\n      this.refreshUi();\n    }\n    else {\n      this.hide();\n    }\n  }\n\n  /**\n   * @summary Toggles content and icon depending on available space\n   * @private\n   */\n  refreshUi() {\n    const availableWidth = this.container.offsetWidth;\n    if (availableWidth >= this.prop.contentWidth && !this.prop.contentVisible) {\n      this.content.style.display = '';\n      this.prop.contentVisible = true;\n      this.button.hide(false);\n    }\n    else if (availableWidth < this.prop.contentWidth && this.prop.contentVisible) {\n      this.content.style.display = 'none';\n      this.prop.contentVisible = false;\n      this.button.show(false);\n    }\n  }\n\n}\n","import { AutorotateButton } from '../buttons/AutorotateButton';\nimport { CustomButton } from '../buttons/CustomButton';\nimport { DownloadButton } from '../buttons/DownloadButton';\nimport { FullscreenButton } from '../buttons/FullscreenButton';\nimport { MenuButton } from '../buttons/MenuButton';\nimport { MoveDownButton } from '../buttons/MoveDownButton';\nimport { MoveLeftButton } from '../buttons/MoveLeftButton';\nimport { MoveRightButton } from '../buttons/MoveRightButton';\nimport { MoveUpButton } from '../buttons/MoveUpButton';\nimport { ZoomInButton } from '../buttons/ZoomInButton';\nimport { ZoomOutButton } from '../buttons/ZoomOutButton';\nimport { ZoomRangeButton } from '../buttons/ZoomRangeButton';\nimport { DEFAULTS } from '../data/config';\nimport { PSVError } from '../PSVError';\nimport { clone, logWarn } from '../utils';\nimport { AbstractComponent } from './AbstractComponent';\nimport { NavbarCaption } from './NavbarCaption';\n\n/**\n * @summary List of available buttons\n * @type {Object<string, Class<PSV.buttons.AbstractButton>>}\n * @private\n */\nconst AVAILABLE_BUTTONS = {};\n\n/**\n * @summary Register a new button available for all viewers\n * @param {Class<PSV.buttons.AbstractButton>} button\n * @param {'start' | 'end' | '[id]:left' | '[id]:right'} [defaultPosition]\n *    If provided the default configuration of the navbar will be modified.\n * @memberOf PSV\n */\nexport function registerButton(button, defaultPosition) {\n  if (!button.id) {\n    throw new PSVError('Button ID is required');\n  }\n\n  AVAILABLE_BUTTONS[button.id] = button;\n\n  if (typeof defaultPosition === 'string') {\n    switch (defaultPosition) {\n      case 'start':\n        DEFAULTS.navbar.unshift(button.id);\n        break;\n      case 'end':\n        DEFAULTS.navbar.push(button.id);\n        break;\n      default:\n        const [id, pos] = defaultPosition.split(':');\n        DEFAULTS.navbar.splice(DEFAULTS.navbar.indexOf(id) + (pos === 'right' ? 1 : 0), 0, button.id);\n    }\n  }\n}\n\n[\n  AutorotateButton,\n  ZoomInButton,\n  ZoomRangeButton,\n  ZoomOutButton,\n  DownloadButton,\n  FullscreenButton,\n  MoveRightButton,\n  MoveLeftButton,\n  MoveUpButton,\n  MoveDownButton,\n].forEach(registerButton);\n\n/**\n * @summary Navigation bar component\n * @extends PSV.components.AbstractComponent\n * @memberof PSV.components\n */\nexport class Navbar extends AbstractComponent {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv, 'psv-navbar');\n\n    /**\n     * @summary List of buttons of the navbar\n     * @member {PSV.buttons.AbstractButton[]}\n     * @override\n     */\n    this.children = [];\n\n    /**\n     * @summary List of collapsed buttons\n     * @member {PSV.buttons.AbstractButton[]}\n     * @private\n     */\n    this.collapsed = [];\n  }\n\n  /**\n   * @summary Change the buttons visible on the navbar\n   * @param {string|Array<string|PSV.NavbarCustomButton>} buttons\n   * @throws {PSV.PSVError} when a button is unknown\n   */\n  setButtons(buttons) {\n    this.children.slice().forEach(item => item.destroy());\n    this.children.length = 0;\n\n    /* eslint-disable no-new */\n    this.__cleanButtons(buttons).forEach((button) => {\n      if (typeof button === 'object') {\n        new CustomButton(this, button);\n      }\n      else if (AVAILABLE_BUTTONS[button]) {\n        new AVAILABLE_BUTTONS[button](this);\n      }\n      else if (button === 'caption') {\n        new NavbarCaption(this, this.psv.config.caption);\n      }\n      else if (button === 'zoom') {\n        new ZoomOutButton(this);\n        new ZoomRangeButton(this);\n        new ZoomInButton(this);\n      }\n      else if (button === 'move') {\n        new MoveLeftButton(this);\n        new MoveRightButton(this);\n        new MoveUpButton(this);\n        new MoveDownButton(this);\n      }\n      else {\n        throw new PSVError('Unknown button ' + button);\n      }\n    });\n\n    new MenuButton(this);\n    /* eslint-enable no-new */\n\n    this.children.forEach((item) => {\n      if (typeof item.checkSupported === 'function') {\n        item.checkSupported();\n      }\n    });\n  }\n\n  /**\n   * @summary Sets the bar caption\n   * @param {string} html\n   */\n  setCaption(html) {\n    const caption = this.getButton('caption', false);\n    caption?.setCaption(html);\n  }\n\n  /**\n   * @summary Returns a button by its identifier\n   * @param {string} id\n   * @param {boolean} [warnNotFound=true]\n   * @returns {PSV.buttons.AbstractButton}\n   */\n  getButton(id, warnNotFound = true) {\n    let button = null;\n\n    this.children.some((item) => {\n      if (item.prop.id === id) {\n        button = item;\n        return true;\n      }\n      else {\n        return false;\n      }\n    });\n\n    if (!button && warnNotFound) {\n      logWarn(`button \"${id}\" not found in the navbar`);\n    }\n\n    return button;\n  }\n\n  /**\n   * @summary Shows the navbar\n   */\n  show() {\n    this.container.classList.add('psv-navbar--open');\n    this.prop.visible = true;\n  }\n\n  /**\n   * @summary Hides the navbar\n   */\n  hide() {\n    this.container.classList.remove('psv-navbar--open');\n    this.prop.visible = false;\n  }\n\n  /**\n   * @override\n   */\n  refreshUi() {\n    super.refreshUi();\n\n    if (this.psv.prop.uiRefresh === true) {\n      const availableWidth = this.container.offsetWidth;\n\n      let totalWidth = 0;\n      const visibleButtons = [];\n      const collapsableButtons = [];\n\n      this.children.forEach((item) => {\n        if (item.prop.visible) {\n          totalWidth += item.prop.width;\n          visibleButtons.push(item);\n          if (item.prop.collapsable) {\n            collapsableButtons.push(item);\n          }\n        }\n      });\n\n      if (!visibleButtons.length) {\n        return;\n      }\n\n      if (availableWidth < totalWidth && collapsableButtons.length > 0) {\n        collapsableButtons.forEach(item => item.collapse());\n        this.collapsed = collapsableButtons;\n\n        this.getButton(MenuButton.id).show(false);\n      }\n      else if (availableWidth >= totalWidth && this.collapsed.length > 0) {\n        this.collapsed.forEach(item => item.uncollapse());\n        this.collapsed = [];\n\n        this.getButton(MenuButton.id).hide(false);\n      }\n\n      const caption = this.getButton(NavbarCaption.id, false);\n      if (caption) {\n        caption.refreshUi();\n      }\n    }\n  }\n\n  /**\n   * @summary Ensure the buttons configuration is correct\n   * @private\n   */\n  __cleanButtons(buttons) {\n    // true becomes the default array\n    if (buttons === true) {\n      return clone(DEFAULTS.navbar);\n    }\n    // can be a space or coma separated list\n    else if (typeof buttons === 'string') {\n      return buttons.split(/[ ,]/);\n    }\n    else {\n      return buttons || [];\n    }\n  }\n\n}\n","import { EVENTS } from '../data/constants';\nimport { SYSTEM } from '../data/system';\nimport { bound, getStyle } from '../utils';\nimport { AbstractComponent } from './AbstractComponent';\n\n/**\n * @summary Loader component\n * @extends PSV.components.AbstractComponent\n * @memberof PSV.components\n */\nexport class Loader extends AbstractComponent {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv, 'psv-loader-container');\n\n    /**\n     * @summary Inner container for vertical center\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.loader = document.createElement('div');\n    this.loader.className = 'psv-loader';\n    this.container.appendChild(this.loader);\n\n    /**\n     * @summary Animation canvas\n     * @member {HTMLCanvasElement}\n     * @readonly\n     * @private\n     */\n    this.canvas = document.createElement('canvas');\n    this.canvas.className = 'psv-loader-canvas';\n\n    this.canvas.width = this.loader.clientWidth * SYSTEM.pixelRatio;\n    this.canvas.height = this.loader.clientWidth * SYSTEM.pixelRatio;\n    this.loader.appendChild(this.canvas);\n\n    /**\n     * @override\n     * @property {number} thickness\n     * @property {string} current\n     */\n    this.prop = {\n      ...this.prop,\n      tickness: (this.loader.offsetWidth - this.loader.clientWidth) / 2 * SYSTEM.pixelRatio,\n      current : null,\n    };\n\n    this.refreshUi();\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    delete this.loader;\n    delete this.canvas;\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  refreshUi() {\n    if (this.prop.current !== (this.psv.config.loadingImg || this.psv.config.loadingTxt)) {\n      if (this.prop.current) {\n        this.loader.removeChild(this.loader.lastChild);\n      }\n\n      let inner;\n      if (this.psv.config.loadingImg) {\n        inner = document.createElement('img');\n        inner.className = 'psv-loader-image';\n        inner.src = this.psv.config.loadingImg;\n      }\n      else if (this.psv.config.loadingTxt) {\n        inner = document.createElement('div');\n        inner.className = 'psv-loader-text';\n        inner.innerHTML = this.psv.config.loadingTxt;\n      }\n      if (inner) {\n        const size = Math.round(Math.sqrt(2 * Math.pow((this.canvas.width / 2 - this.prop.tickness / 2) / SYSTEM.pixelRatio, 2)));\n        inner.style.maxWidth = size + 'px';\n        inner.style.maxHeight = size + 'px';\n        this.loader.appendChild(inner);\n      }\n\n      this.prop.current = this.psv.config.loadingImg || this.psv.config.loadingTxt;\n    }\n  }\n\n  /**\n   * @summary Sets the loader progression\n   * @param {number} value - from 0 to 100\n   */\n  setProgress(value) {\n    const context = this.canvas.getContext('2d');\n\n    context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n    context.lineWidth = this.prop.tickness;\n    context.strokeStyle = getStyle(this.loader, 'color');\n\n    context.beginPath();\n    context.arc(\n      this.canvas.width / 2, this.canvas.height / 2,\n      this.canvas.width / 2 - this.prop.tickness / 2,\n      -Math.PI / 2, bound(value, 0, 100) / 100 * 2 * Math.PI - Math.PI / 2\n    );\n    context.stroke();\n\n    this.psv.trigger(EVENTS.LOAD_PROGRESS, Math.round(value));\n  }\n\n}\n","import { EVENTS } from '../data/constants';\nimport { AbstractComponent } from './AbstractComponent';\n\n/**\n * @summary Notification component\n * @extends PSV.components.AbstractComponent\n * @memberof PSV.components\n */\nexport class Notification extends AbstractComponent {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv, 'psv-notification');\n\n    /**\n     * @override\n     * @property {*} timeout\n     */\n    this.prop = {\n      ...this.prop,\n      visible: false,\n      timeout: null,\n    };\n\n    /**\n     * Notification content\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.content = document.createElement('div');\n    this.content.className = 'psv-notification-content';\n    this.container.appendChild(this.content);\n\n    this.content.addEventListener('click', () => this.hide());\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    delete this.content;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Displays a notification on the viewer\n   * @param {Object|string} config\n   * @param {string} config.content\n   * @param {number} [config.timeout]\n   * @fires PSV.show-notification\n   *\n   * @example\n   * viewer.showNotification({ content: 'Hello world', timeout: 5000 })\n   * @example\n   * viewer.showNotification('Hello world')\n   */\n  show(config) {\n    if (this.prop.timeout) {\n      clearTimeout(this.prop.timeout);\n      this.prop.timeout = null;\n    }\n\n    if (typeof config === 'string') {\n      config = { content: config };\n    }\n\n    this.content.innerHTML = config.content;\n    this.prop.visible = true;\n\n    this.container.classList.add('psv-notification--visible');\n\n    this.psv.trigger(EVENTS.SHOW_NOTIFICATION);\n\n    if (config.timeout) {\n      this.prop.timeout = setTimeout(() => this.hide(), config.timeout);\n    }\n  }\n\n  /**\n   * @summary Hides the notification\n   * @fires PSV.hide-notification\n   */\n  hide() {\n    if (this.prop.visible) {\n      this.container.classList.remove('psv-notification--visible');\n\n      this.prop.visible = false;\n\n      this.psv.trigger(EVENTS.HIDE_NOTIFICATION);\n    }\n  }\n\n}\n","import { EVENTS, KEY_CODES } from '../data/constants';\nimport { getEventKey } from '../utils';\nimport { AbstractComponent } from './AbstractComponent';\nimport { PSVError } from '../PSVError';\n\n/**\n * @summary Overlay component\n * @extends PSV.components.AbstractComponent\n * @memberof PSV.components\n */\nexport class Overlay extends AbstractComponent {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv, 'psv-overlay');\n\n    /**\n     * @override\n     * @property {string} contentId\n     * @property {boolean} dissmisable\n     */\n    this.prop = {\n      ...this.prop,\n      contentId  : undefined,\n      dissmisable: true,\n    };\n\n    /**\n     * Image container\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.image = document.createElement('div');\n    this.image.className = 'psv-overlay-image';\n    this.container.appendChild(this.image);\n\n    /**\n     * Text container\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.text = document.createElement('div');\n    this.text.className = 'psv-overlay-text';\n    this.container.appendChild(this.text);\n\n    /**\n     * Subtext container\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.subtext = document.createElement('div');\n    this.subtext.className = 'psv-overlay-subtext';\n    this.container.appendChild(this.subtext);\n\n    this.container.addEventListener('mouseup', this);\n\n    document.addEventListener('keydown', this);\n\n    super.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    document.removeEventListener('keydown', this);\n\n    delete this.image;\n    delete this.text;\n    delete this.subtext;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case 'mouseup':  this.prop.dissmisable && this.hide(); break;\n      case 'keydown':  getEventKey(e) === KEY_CODES.Escape && this.prop.dissmisable && this.hide(); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @param {string} [id]\n   */\n  isVisible(id) {\n    return this.prop.visible && (!id || !this.prop.contentId || this.prop.contentId === id);\n  }\n\n  /**\n   * @override\n   * @summary This method is not supported\n   * @throws {PSV.PSVError} always\n   */\n  toggle() {\n    throw new PSVError('Overlay cannot be toggled');\n  }\n\n  /**\n   * @summary Displays an overlay on the viewer\n   * @param {Object|string} config\n   * @param {string} [config.id] - unique identifier to use with \"hide\"\n   * @param {string} config.image - SVG image/icon displayed above the text\n   * @param {string} config.text - main message\n   * @param {string} [config.subtext] - secondary message\n   * @param {boolean} [config.dissmisable=true] - if the user can hide the overlay by clicking\n   * @fires PSV.show-overlay\n   */\n  show(config) {\n    if (typeof config === 'string') {\n      config = { text: config };\n    }\n\n    this.prop.contentId = config.id;\n    this.prop.dissmisable = config.dissmisable !== false;\n    this.image.innerHTML = config.image || '';\n    this.text.innerHTML = config.text || '';\n    this.subtext.innerHTML = config.subtext || '';\n\n    super.show();\n\n    this.psv.trigger(EVENTS.SHOW_OVERLAY, config.id);\n  }\n\n  /**\n   * @summary Hides the overlay\n   * @param {string} [id]\n   * @fires PSV.hide-overlay\n   */\n  hide(id) {\n    if (this.isVisible() && (!id || !this.prop.contentId || this.prop.contentId === id)) {\n      const contentId = this.prop.contentId;\n\n      super.hide();\n\n      this.prop.contentId = undefined;\n\n      this.psv.trigger(EVENTS.HIDE_OVERLAY, contentId);\n    }\n  }\n\n}\n","import { EVENTS, KEY_CODES } from '../data/constants';\nimport { SYSTEM } from '../data/system';\nimport { PSVError } from '../PSVError';\nimport { getEventKey, toggleClass } from '../utils';\nimport { AbstractComponent } from './AbstractComponent';\n\n/**\n * @summary Minimum width of the panel\n * @type {number}\n * @constant\n * @private\n */\nconst PANEL_MIN_WIDTH = 200;\n\n/**\n * @summary Panel component\n * @extends PSV.components.AbstractComponent\n * @memberof PSV.components\n */\nexport class Panel extends AbstractComponent {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv, 'psv-panel');\n\n    /**\n     * @override\n     * @property {string} contentId\n     * @property {number} mouseX\n     * @property {number} mouseY\n     * @property {boolean} mousedown\n     * @property {function} clickHandler\n     * @property {function} keyHandler\n     */\n    this.prop = {\n      ...this.prop,\n      visible     : false,\n      contentId   : undefined,\n      mouseX      : 0,\n      mouseY      : 0,\n      mousedown   : false,\n      clickHandler: null,\n      keyHandler  : null,\n      width       : {},\n    };\n\n    const resizer = document.createElement('div');\n    resizer.className = 'psv-panel-resizer';\n    this.container.appendChild(resizer);\n\n    const closeBtn = document.createElement('div');\n    closeBtn.className = 'psv-panel-close-button';\n    this.container.appendChild(closeBtn);\n\n    /**\n     * @summary Content container\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.content = document.createElement('div');\n    this.content.className = 'psv-panel-content';\n    this.container.appendChild(this.content);\n\n    // Stop wheel event bubbling from panel\n    this.container.addEventListener(SYSTEM.mouseWheelEvent, e => e.stopPropagation());\n\n    closeBtn.addEventListener('click', () => this.hide());\n\n    // Event for panel resizing + stop bubling\n    resizer.addEventListener('mousedown', this);\n    resizer.addEventListener('touchstart', this);\n    this.psv.container.addEventListener('mouseup', this);\n    this.psv.container.addEventListener('touchend', this);\n    this.psv.container.addEventListener('mousemove', this);\n    this.psv.container.addEventListener('touchmove', this);\n\n    document.addEventListener('keydown', this);\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.container.removeEventListener('mousemove', this);\n    this.psv.container.removeEventListener('touchmove', this);\n    this.psv.container.removeEventListener('mouseup', this);\n    this.psv.container.removeEventListener('touchend', this);\n\n    document.removeEventListener('keydown', this);\n\n    delete this.prop;\n    delete this.content;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case 'mousedown':  this.__onMouseDown(e);  break;\n      case 'touchstart': this.__onTouchStart(e); break;\n      case 'mousemove':  this.__onMouseMove(e);  break;\n      case 'touchmove':  this.__onTouchMove(e);  break;\n      case 'mouseup':    this.__onMouseUp(e);    break;\n      case 'touchend':   this.__onMouseUp(e);    break;\n      case 'keydown':    getEventKey(e) === KEY_CODES.Escape && this.hide(); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @param {string} [id]\n   */\n  isVisible(id) {\n    return this.prop.visible && (!id || !this.prop.contentId || this.prop.contentId === id);\n  }\n\n  /**\n   * @override\n   * @summary This method is not supported\n   * @throws {PSV.PSVError} always\n   */\n  toggle() {\n    throw new PSVError('Panel cannot be toggled');\n  }\n\n  /**\n   * @summary Shows the panel\n   * @param {string|Object} config\n   * @param {string} [config.id] - unique identifier to use with \"hide\" and to store the user desired width\n   * @param {string} config.content - HTML content of the panel\n   * @param {boolean} [config.noMargin=false] - remove the default margins\n   * @param {string} [config.width] - initial width\n   * @param {Function} [config.clickHandler] - called when the user clicks inside the panel or presses the Enter key while an element focused\n   * @fires PSV.open-panel\n   */\n  show(config) {\n    const wasVisible = this.isVisible(config.id);\n\n    if (typeof config === 'string') {\n      config = { content: config };\n    }\n\n    this.prop.contentId = config.id;\n    this.prop.visible = true;\n\n    if (this.prop.clickHandler) {\n      this.content.removeEventListener('click', this.prop.clickHandler);\n      this.content.removeEventListener('keydown', this.prop.keyHandler);\n      this.prop.clickHandler = null;\n      this.prop.keyHandler = null;\n    }\n\n    if (config.id && this.prop.width[config.id]) {\n      this.container.style.width = this.prop.width[config.id];\n    }\n    else if (config.width) {\n      this.container.style.width = config.width;\n    }\n    else {\n      this.container.style.width = null;\n    }\n\n    this.content.innerHTML = config.content;\n    this.content.scrollTop = 0;\n    this.container.classList.add('psv-panel--open');\n\n    toggleClass(this.content, 'psv-panel-content--no-margin', config.noMargin === true);\n\n    if (config.clickHandler) {\n      this.prop.clickHandler = config.clickHandler;\n      this.prop.keyHandler = (e) => {\n        if (getEventKey(e) === KEY_CODES.Enter) {\n          config.clickHandler(e);\n        }\n      };\n      this.content.addEventListener('click', this.prop.clickHandler);\n      this.content.addEventListener('keydown', this.prop.keyHandler);\n\n      // focus the first element if possible, after animation ends\n      if (!wasVisible) {\n        setTimeout(() => {\n          this.content.querySelector('a,button,[tabindex]')?.focus();\n        }, 300);\n      }\n    }\n\n    this.psv.trigger(EVENTS.OPEN_PANEL, config.id);\n  }\n\n  /**\n   * @summary Hides the panel\n   * @param {string} [id]\n   * @fires PSV.close-panel\n   */\n  hide(id) {\n    if (this.isVisible(id)) {\n      const contentId = this.prop.contentId;\n\n      this.prop.visible = false;\n      this.prop.contentId = undefined;\n\n      this.content.innerHTML = null;\n      this.container.classList.remove('psv-panel--open');\n\n      if (this.prop.clickHandler) {\n        this.content.removeEventListener('click', this.prop.clickHandler);\n        this.prop.clickHandler = null;\n      }\n\n      this.psv.trigger(EVENTS.CLOSE_PANEL, contentId);\n    }\n  }\n\n  /**\n   * @summary Handles mouse down events\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __onMouseDown(evt) {\n    evt.stopPropagation();\n    this.__startResize(evt);\n  }\n\n  /**\n   * @summary Handles touch events\n   * @param {TouchEvent} evt\n   * @private\n   */\n  __onTouchStart(evt) {\n    evt.stopPropagation();\n    this.__startResize(evt.changedTouches[0]);\n  }\n\n  /**\n   * @summary Handles mouse up events\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __onMouseUp(evt) {\n    if (this.prop.mousedown) {\n      evt.stopPropagation();\n      this.prop.mousedown = false;\n      this.content.classList.remove('psv-panel-content--no-interaction');\n    }\n  }\n\n  /**\n   * @summary Handles mouse move events\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __onMouseMove(evt) {\n    if (this.prop.mousedown) {\n      evt.stopPropagation();\n      this.__resize(evt);\n    }\n  }\n\n  /**\n   * @summary Handles touch move events\n   * @param {TouchEvent} evt\n   * @private\n   */\n  __onTouchMove(evt) {\n    if (this.prop.mousedown) {\n      this.__resize(evt.touches[0]);\n    }\n  }\n\n  /**\n   * @summary Initializes the panel resize\n   * @param {MouseEvent|Touch} evt\n   * @private\n   */\n  __startResize(evt) {\n    this.prop.mouseX = evt.clientX;\n    this.prop.mouseY = evt.clientY;\n    this.prop.mousedown = true;\n    this.content.classList.add('psv-panel-content--no-interaction');\n  }\n\n  /**\n   * @summary Resizes the panel\n   * @param {MouseEvent|Touch} evt\n   * @private\n   */\n  __resize(evt) {\n    const x = evt.clientX;\n    const y = evt.clientY;\n    const width = Math.max(PANEL_MIN_WIDTH, this.container.offsetWidth - (x - this.prop.mouseX)) + 'px';\n\n    if (this.prop.contentId) {\n      this.prop.width[this.prop.contentId] = width;\n    }\n\n    this.container.style.width = width;\n\n    this.prop.mouseX = x;\n    this.prop.mouseY = y;\n  }\n\n}\n","/**\n * @namespace PSV.services\n */\n\n/**\n * @summary Base services class\n * @memberof PSV.services\n * @abstract\n */\nexport class AbstractService {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    /**\n     * @summary Reference to main controller\n     * @type {PSV.Viewer}\n     * @readonly\n     */\n    this.psv = psv;\n\n    /**\n     * @summary Configuration holder\n     * @type {PSV.Options}\n     * @readonly\n     */\n    this.config = psv.config;\n\n    /**\n     * @summary Properties holder\n     * @type {Object}\n     * @readonly\n     */\n    this.prop = psv.prop;\n  }\n\n  /**\n   * @summary Destroys the service\n   */\n  destroy() {\n    delete this.psv;\n    delete this.config;\n    delete this.prop;\n  }\n\n}\n","import * as THREE from 'three';\nimport { MESH_USER_DATA, SPHERE_RADIUS } from '../data/constants';\nimport { PSVError } from '../PSVError';\nimport { applyEulerInverse, parseAngle, parseSpeed } from '../utils';\nimport { AbstractService } from './AbstractService';\n\nconst vector2 = new THREE.Vector2();\nconst vector3 = new THREE.Vector3();\nconst eulerZero = new THREE.Euler(0, 0, 0, 'ZXY');\n\n/**\n * @summary Collections of data converters for the current viewer\n * @extends PSV.services.AbstractService\n * @memberof PSV.services\n */\nexport class DataHelper extends AbstractService {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv);\n  }\n\n  /**\n   * @summary Converts vertical FOV to zoom level\n   * @param {number} fov\n   * @returns {number}\n   */\n  fovToZoomLevel(fov) {\n    const temp = Math.round((fov - this.config.minFov) / (this.config.maxFov - this.config.minFov) * 100);\n    return temp - 2 * (temp - 50);\n  }\n\n  /**\n   * @summary Converts zoom level to vertical FOV\n   * @param {number} level\n   * @returns {number}\n   */\n  zoomLevelToFov(level) {\n    return this.config.maxFov + (level / 100) * (this.config.minFov - this.config.maxFov);\n  }\n\n  /**\n   * @summary Convert vertical FOV to horizontal FOV\n   * @param {number} vFov\n   * @returns {number}\n   */\n  vFovToHFov(vFov) {\n    return THREE.Math.radToDeg(2 * Math.atan(Math.tan(THREE.Math.degToRad(vFov) / 2) * this.prop.aspect));\n  }\n\n  /**\n   * @summary Converts a speed into a duration from current position to a new position\n   * @param {string|number} value\n   * @param {number} angle\n   * @returns {number}\n   */\n  speedToDuration(value, angle) {\n    if (!value || typeof value !== 'number') {\n      // desired radial speed\n      const speed = value ? parseSpeed(value) : this.config.autorotateSpeed;\n      // compute duration\n      return angle / Math.abs(speed) * 1000;\n    }\n    else {\n      return Math.abs(value);\n    }\n  }\n\n  /**\n   * @summary Converts pixel texture coordinates to spherical radians coordinates\n   * @param {PSV.Point} point\n   * @returns {PSV.Position}\n   * @throws {PSV.PSVError} when the current adapter does not support texture coordinates\n   */\n  textureCoordsToSphericalCoords(point) {\n    const panoData = this.prop.panoData;\n    if (!panoData) {\n      throw new PSVError('Current adapter does not support texture coordinates.');\n    }\n\n    const relativeX = (point.x + panoData.croppedX) / panoData.fullWidth * Math.PI * 2;\n    const relativeY = (point.y + panoData.croppedY) / panoData.fullHeight * Math.PI;\n\n    const result = {\n      longitude: relativeX >= Math.PI ? relativeX - Math.PI : relativeX + Math.PI,\n      latitude : Math.PI / 2 - relativeY,\n    };\n\n    // Apply panoData pose and sphereCorrection\n    if (!eulerZero.equals(this.psv.renderer.mesh.rotation) || !eulerZero.equals(this.psv.renderer.meshContainer.rotation)) {\n      this.sphericalCoordsToVector3(result, vector3);\n      vector3.applyEuler(this.psv.renderer.mesh.rotation);\n      vector3.applyEuler(this.psv.renderer.meshContainer.rotation);\n      return this.vector3ToSphericalCoords(vector3);\n    }\n    else {\n      return result;\n    }\n  }\n\n  /**\n   * @summary Converts spherical radians coordinates to pixel texture coordinates\n   * @param {PSV.Position} position\n   * @returns {PSV.Point}\n   * @throws {PSV.PSVError} when the current adapter does not support texture coordinates\n   */\n  sphericalCoordsToTextureCoords(position) {\n    const panoData = this.prop.panoData;\n    if (!panoData) {\n      throw new PSVError('Current adapter does not support texture coordinates.');\n    }\n\n    // Apply panoData pose and sphereCorrection\n    if (!eulerZero.equals(this.psv.renderer.mesh.rotation) || !eulerZero.equals(this.psv.renderer.meshContainer.rotation)) {\n      this.sphericalCoordsToVector3(position, vector3);\n      applyEulerInverse(vector3, this.psv.renderer.meshContainer.rotation);\n      applyEulerInverse(vector3, this.psv.renderer.mesh.rotation);\n      position = this.vector3ToSphericalCoords(vector3);\n    }\n\n    const relativeLong = position.longitude / Math.PI / 2 * panoData.fullWidth;\n    const relativeLat = position.latitude / Math.PI * panoData.fullHeight;\n\n    return {\n      x: Math.round(position.longitude < Math.PI ? relativeLong + panoData.fullWidth / 2 : relativeLong - panoData.fullWidth / 2) - panoData.croppedX,\n      y: Math.round(panoData.fullHeight / 2 - relativeLat) - panoData.croppedY,\n    };\n  }\n\n  /**\n   * @summary Converts spherical radians coordinates to a THREE.Vector3\n   * @param {PSV.Position} position\n   * @param {external:THREE.Vector3} [vector]\n   * @returns {external:THREE.Vector3}\n   */\n  sphericalCoordsToVector3(position, vector) {\n    if (!vector) {\n      vector = new THREE.Vector3();\n    }\n    vector.x = SPHERE_RADIUS * -Math.cos(position.latitude) * Math.sin(position.longitude);\n    vector.y = SPHERE_RADIUS * Math.sin(position.latitude);\n    vector.z = SPHERE_RADIUS * Math.cos(position.latitude) * Math.cos(position.longitude);\n    return vector;\n  }\n\n  /**\n   * @summary Converts a THREE.Vector3 to spherical radians coordinates\n   * @param {external:THREE.Vector3} vector\n   * @returns {PSV.Position}\n   */\n  vector3ToSphericalCoords(vector) {\n    const phi = Math.acos(vector.y / Math.sqrt(vector.x * vector.x + vector.y * vector.y + vector.z * vector.z));\n    const theta = Math.atan2(vector.x, vector.z);\n\n    return {\n      longitude: theta < 0 ? -theta : Math.PI * 2 - theta,\n      latitude : Math.PI / 2 - phi,\n    };\n  }\n\n  /**\n   * @summary Converts position on the viewer to a THREE.Vector3\n   * @param {PSV.Point} viewerPoint\n   * @returns {external:THREE.Vector3}\n   */\n  viewerCoordsToVector3(viewerPoint) {\n    const sphereIntersect = this.getIntersections(viewerPoint).filter(i => i.object.userData[MESH_USER_DATA]);\n\n    if (sphereIntersect) {\n      return sphereIntersect.point;\n    }\n    else {\n      return null;\n    }\n  }\n\n  /**\n   * @summary Converts a THREE.Vector3 to position on the viewer\n   * @param {external:THREE.Vector3} vector\n   * @returns {PSV.Point}\n   */\n  vector3ToViewerCoords(vector) {\n    const vectorClone = vector.clone();\n    vectorClone.project(this.psv.renderer.camera);\n\n    return {\n      x: Math.round((vectorClone.x + 1) / 2 * this.prop.size.width),\n      y: Math.round((1 - vectorClone.y) / 2 * this.prop.size.height),\n    };\n  }\n\n  /**\n   * @summary Converts spherical radians coordinates to position on the viewer\n   * @param {PSV.Position} position\n   * @returns {PSV.Point}\n   */\n  sphericalCoordsToViewerCoords(position) {\n    return this.vector3ToViewerCoords(this.sphericalCoordsToVector3(position, vector3));\n  }\n\n  /**\n   * @summary Returns intersections with objects in the scene\n   * @param {PSV.Point} viewerPoint\n   * @return {external:THREE.Intersection[]}\n   */\n  getIntersections(viewerPoint) {\n    vector2.x = 2 * viewerPoint.x / this.prop.size.width - 1;\n    vector2.y = -2 * viewerPoint.y / this.prop.size.height + 1;\n\n    this.psv.renderer.raycaster.setFromCamera(vector2, this.psv.renderer.camera);\n\n    return this.psv.renderer.raycaster.intersectObjects(this.psv.renderer.scene.children, true)\n      .filter(i => !!i.object.userData);\n  }\n\n  /**\n   * @summary Converts x/y to latitude/longitude if present and ensure boundaries\n   * @param {PSV.ExtendedPosition} position\n   * @returns {PSV.Position}\n   */\n  cleanPosition(position) {\n    if (position.x !== undefined && position.y !== undefined) {\n      return this.textureCoordsToSphericalCoords(position);\n    }\n    else {\n      return {\n        longitude: parseAngle(position.longitude),\n        latitude : parseAngle(position.latitude, true),\n      };\n    }\n  }\n\n  /**\n   * @summary Ensure a SphereCorrection object is valid\n   * @param {PSV.SphereCorrection} sphereCorrection\n   * @returns {PSV.SphereCorrection}\n   */\n  cleanSphereCorrection(sphereCorrection) {\n    return {\n      pan : parseAngle(sphereCorrection?.pan || 0),\n      tilt: parseAngle(sphereCorrection?.tilt || 0, true),\n      roll: parseAngle(sphereCorrection?.roll || 0, true, false),\n    };\n  }\n\n  /**\n   * @summary Parse the pose angles of the pano data\n   * @param {PSV.PanoData} panoData\n   * @returns {PSV.SphereCorrection}\n   */\n  cleanPanoramaPose(panoData) {\n    return {\n      pan : THREE.Math.degToRad(panoData?.poseHeading || 0),\n      tilt: THREE.Math.degToRad(panoData?.posePitch || 0),\n      roll: THREE.Math.degToRad(panoData?.poseRoll || 0),\n    };\n  }\n\n}\n","import * as THREE from 'three';\nimport { Animation } from '../Animation';\nimport {\n  ACTIONS,\n  CTRLZOOM_TIMEOUT,\n  DBLCLICK_DELAY,\n  EVENTS,\n  IDS,\n  INERTIA_WINDOW,\n  KEY_CODES,\n  LONGTOUCH_DELAY,\n  MOVE_THRESHOLD,\n  OBJECT_EVENTS,\n  TWOFINGERSOVERLAY_DELAY\n} from '../data/constants';\nimport { SYSTEM } from '../data/system';\nimport gestureIcon from '../icons/gesture.svg';\nimport mousewheelIcon from '../icons/mousewheel.svg';\nimport {\n  clone,\n  distance,\n  each,\n  getClosest,\n  getEventKey,\n  getPosition,\n  isEmpty,\n  isFullscreenEnabled,\n  normalizeWheel,\n  throttle\n} from '../utils';\nimport { PressHandler } from '../utils/PressHandler';\nimport { AbstractService } from './AbstractService';\n\n/**\n * @summary Events handler\n * @extends PSV.services.AbstractService\n * @memberof PSV.services\n */\nexport class EventsHandler extends AbstractService {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv);\n\n    /**\n     * @summary Internal properties\n     * @member {Object}\n     * @property {number} moveThreshold - computed threshold based on device pixel ratio\n     * @property {boolean} moving - is the user moving\n     * @property {boolean} zooming - is the user zooming\n     * @property {number} startMouseX - start x position of the click/touch\n     * @property {number} startMouseY - start y position of the click/touch\n     * @property {number} mouseX - current x position of the cursor\n     * @property {number} mouseY - current y position of the cursor\n     * @property {number[][]} mouseHistory - list of latest positions of the cursor, [time, x, y]\n     * @property {number} pinchDist - distance between fingers when zooming\n     * @property {PressHandler} keyHandler\n     * @property {boolean} ctrlKeyDown - when the Ctrl key is pressed\n     * @property {PSV.ClickData} dblclickData - temporary storage of click data between two clicks\n     * @property {number} dblclickTimeout - timeout id for double click\n     * @property {number} twofingersTimeout - timeout id for \"two fingers\" overlay\n     * @property {number} ctrlZoomTimeout - timeout id for \"ctrol zoom\" overlay\n     * @protected\n     */\n    this.state = {\n      moveThreshold    : MOVE_THRESHOLD * SYSTEM.pixelRatio,\n      keyboardEnabled  : false,\n      moving           : false,\n      zooming          : false,\n      startMouseX      : 0,\n      startMouseY      : 0,\n      mouseX           : 0,\n      mouseY           : 0,\n      mouseHistory     : [],\n      pinchDist        : 0,\n      keyHandler       : new PressHandler(),\n      ctrlKeyDown      : false,\n      dblclickData     : null,\n      dblclickTimeout  : null,\n      longtouchTimeout : null,\n      twofingersTimeout: null,\n      ctrlZoomTimeout  : null,\n    };\n\n    /**\n     * @summary Throttled wrapper of {@link PSV.Viewer#autoSize}\n     * @type {Function}\n     * @private\n     */\n    this.__onResize = throttle(() => this.psv.autoSize(), 50);\n  }\n\n  /**\n   * @summary Initializes event handlers\n   * @protected\n   */\n  init() {\n    window.addEventListener('resize', this);\n    window.addEventListener('keydown', this);\n    window.addEventListener('keyup', this);\n    this.psv.container.addEventListener('mouseenter', this);\n    this.psv.container.addEventListener('mousedown', this);\n    this.psv.container.addEventListener('mouseleave', this);\n    this.psv.container.addEventListener('mousemove', this);\n    window.addEventListener('mouseup', this);\n    this.psv.container.addEventListener('touchstart', this);\n    this.psv.container.addEventListener('touchmove', this);\n    window.addEventListener('touchend', this);\n    this.psv.container.addEventListener(SYSTEM.mouseWheelEvent, this);\n\n    if (SYSTEM.fullscreenEvent) {\n      document.addEventListener(SYSTEM.fullscreenEvent, this);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    window.removeEventListener('resize', this);\n    window.removeEventListener('keydown', this);\n    window.removeEventListener('keyup', this);\n    this.psv.container.removeEventListener('mouseenter', this);\n    this.psv.container.removeEventListener('mousedown', this);\n    this.psv.container.removeEventListener('mouseleave', this);\n    this.psv.container.removeEventListener('mousemove', this);\n    window.removeEventListener('mouseup', this);\n    this.psv.container.removeEventListener('touchstart', this);\n    this.psv.container.removeEventListener('touchmove', this);\n    window.removeEventListener('touchend', this);\n    this.psv.container.removeEventListener(SYSTEM.mouseWheelEvent, this);\n\n    if (SYSTEM.fullscreenEvent) {\n      document.removeEventListener(SYSTEM.fullscreenEvent, this);\n    }\n\n    clearTimeout(this.state.dblclickTimeout);\n    clearTimeout(this.state.longtouchTimeout);\n    clearTimeout(this.state.twofingersTimeout);\n    clearTimeout(this.state.ctrlZoomTimeout);\n\n    delete this.state;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} evt\n   * @private\n   */\n  handleEvent(evt) {\n    /* eslint-disable */\n    switch (evt.type) {\n      // @formatter:off\n      case 'resize':   this.__onResize(); break;\n      case 'keydown':  this.__onKeyDown(evt); break;\n      case 'keyup':    this.__onKeyUp(); break;\n      case 'mouseup':  this.__onMouseUp(evt); break;\n      case 'touchend': this.__onTouchEnd(evt); break;\n      case SYSTEM.fullscreenEvent: this.__fullscreenToggled(); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n\n    if (!getClosest(evt.target, '.psv-navbar') && !getClosest(evt.target, '.psv-panel')) {\n      /* eslint-disable */\n      switch (evt.type) {\n        // @formatter:off\n        case 'mousedown':  this.__onMouseDown(evt); break;\n        case 'mouseenter': this.__onMouseEnter(evt); break;\n        case 'mouseleave': this.__onMouseLeave(evt); break;\n        case 'mousemove':  this.__onMouseMove(evt); break;\n        case 'touchstart': this.__onTouchStart(evt); break;\n        case 'touchmove':  this.__onTouchMove(evt); break;\n        case SYSTEM.mouseWheelEvent: this.__onMouseWheel(evt); break;\n        // @formatter:on\n      }\n      /* eslint-enable */\n    }\n  }\n\n  /**\n   * @summary Enables the keyboard controls\n   * @protected\n   */\n  enableKeyboard() {\n    this.state.keyboardEnabled = true;\n  }\n\n  /**\n   * @summary Disables the keyboard controls\n   * @protected\n   */\n  disableKeyboard() {\n    this.state.keyboardEnabled = false;\n  }\n\n  /**\n   * @summary Handles keyboard events\n   * @param {KeyboardEvent} evt\n   * @private\n   */\n  __onKeyDown(evt) {\n    const key = getEventKey(evt);\n\n    if (this.config.mousewheelCtrlKey) {\n      this.state.ctrlKeyDown = key === KEY_CODES.Control;\n\n      if (this.state.ctrlKeyDown) {\n        clearTimeout(this.state.ctrlZoomTimeout);\n        this.psv.overlay.hide(IDS.CTRL_ZOOM);\n      }\n    }\n\n    if (!this.state.keyboardEnabled) {\n      return;\n    }\n\n    if (this.config.keyboard[key] === ACTIONS.TOGGLE_AUTOROTATE) {\n      this.psv.toggleAutorotate();\n    }\n    else if (this.config.keyboard[key] && !this.state.keyHandler.time) {\n      /* eslint-disable */\n      switch (this.config.keyboard[key]) {\n        // @formatter:off\n        case ACTIONS.ROTATE_LAT_UP: this.psv.dynamics.position.roll({latitude: false}); break;\n        case ACTIONS.ROTATE_LAT_DOWN: this.psv.dynamics.position.roll({latitude: true});  break;\n        case ACTIONS.ROTATE_LONG_RIGHT: this.psv.dynamics.position.roll({longitude: false}); break;\n        case ACTIONS.ROTATE_LONG_LEFT: this.psv.dynamics.position.roll({longitude: true}); break;\n        case ACTIONS.ZOOM_IN: this.psv.dynamics.zoom.roll(false); break;\n        case ACTIONS.ZOOM_OUT: this.psv.dynamics.zoom.roll(true); break;\n        // @formatter:on\n      }\n      /* eslint-enable */\n\n      this.state.keyHandler.down();\n    }\n  }\n\n  /**\n   * @summary Handles keyboard events\n   * @private\n   */\n  __onKeyUp() {\n    this.state.ctrlKeyDown = false;\n\n    if (!this.state.keyboardEnabled) {\n      return;\n    }\n\n    this.state.keyHandler.up(() => {\n      this.psv.dynamics.position.stop();\n      this.psv.dynamics.zoom.stop();\n    });\n  }\n\n  /**\n   * @summary Handles mouse down events\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __onMouseDown(evt) {\n    if (!this.config.mousemove || this.config.captureCursor) {\n      return;\n    }\n\n    this.__startMove(evt);\n  }\n\n  /**\n   * @summary Handles mouse enter events\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __onMouseEnter(evt) {\n    if (!this.config.mousemove || !this.config.captureCursor) {\n      return;\n    }\n\n    this.__startMove(evt);\n  }\n\n  /**\n   * @summary Handles mouse up events\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __onMouseUp(evt) {\n    if (!this.config.mousemove || this.config.captureCursor) {\n      return;\n    }\n\n    this.__stopMove(evt);\n  }\n\n  /**\n   * @summary Handles mouse leave events\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __onMouseLeave(evt) {\n    if (!this.config.mousemove || !this.config.captureCursor) {\n      return;\n    }\n\n    this.__stopMove(evt);\n  }\n\n  /**\n   * @summary Handles mouse move events\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __onMouseMove(evt) {\n    if (this.config.mousemove) {\n      if (evt.buttons !== 0) {\n        evt.preventDefault();\n        this.__move(evt);\n      }\n      else if (this.config.captureCursor) {\n        this.__moveAbsolute(evt);\n      }\n    }\n\n    if (!isEmpty(this.prop.objectsObservers)) {\n      const viewerPos = getPosition(this.psv.container);\n\n      const viewerPoint = {\n        x: evt.clientX - viewerPos.left,\n        y: evt.clientY - viewerPos.top,\n      };\n\n      const intersections = this.psv.dataHelper.getIntersections(viewerPoint);\n\n      const emit = (observer, key, type) => {\n        observer.listener.handleEvent(new CustomEvent(type, {\n          detail: {\n            originalEvent: evt,\n            object       : observer.object,\n            data         : observer.object.userData[key],\n            viewerPoint  : viewerPoint,\n          },\n        }));\n      };\n\n      each(this.prop.objectsObservers, (observer, key) => {\n        const intersection = intersections.find(i => i.object.userData[key]);\n\n        if (intersection) {\n          if (observer.object && intersection.object !== observer.object) {\n            emit(observer, key, OBJECT_EVENTS.LEAVE_OBJECT);\n            delete observer.object;\n          }\n\n          if (!observer.object) {\n            observer.object = intersection.object;\n            emit(observer, key, OBJECT_EVENTS.ENTER_OBJECT);\n          }\n          else {\n            emit(observer, key, OBJECT_EVENTS.HOVER_OBJECT);\n          }\n        }\n        else if (observer.object) {\n          emit(observer, key, OBJECT_EVENTS.LEAVE_OBJECT);\n          delete observer.object;\n        }\n      });\n    }\n  }\n\n  /**\n   * @summary Handles touch events\n   * @param {TouchEvent} evt\n   * @private\n   */\n  __onTouchStart(evt) {\n    if (!this.config.mousemove) {\n      return;\n    }\n\n    if (evt.touches.length === 1) {\n      if (!this.config.touchmoveTwoFingers) {\n        this.__startMove(evt.touches[0]);\n        evt.preventDefault(); // prevent mouse events emulation\n      }\n\n      if (!this.prop.longtouchTimeout) {\n        this.prop.longtouchTimeout = setTimeout(() => {\n          this.__click(evt.touches[0], true);\n          this.prop.longtouchTimeout = null;\n        }, LONGTOUCH_DELAY);\n      }\n    }\n    else if (evt.touches.length === 2) {\n      this.__cancelLongTouch();\n      this.__cancelTwoFingersOverlay();\n      this.__startMoveZoom(evt);\n      evt.preventDefault();\n    }\n  }\n\n  /**\n   * @summary Handles touch events\n   * @param {TouchEvent} evt\n   * @private\n   */\n  __onTouchEnd(evt) {\n    if (!this.config.mousemove) {\n      return;\n    }\n\n    this.__cancelLongTouch();\n    this.__cancelTwoFingersOverlay();\n\n    if (evt.touches.length === 1) {\n      this.__stopMoveZoom();\n    }\n    else if (evt.touches.length === 0) {\n      this.__stopMove(evt.changedTouches[0]);\n    }\n  }\n\n  /**\n   * @summary Handles touch move events\n   * @param {TouchEvent} evt\n   * @private\n   */\n  __onTouchMove(evt) {\n    if (!this.config.mousemove) {\n      return;\n    }\n\n    this.__cancelLongTouch();\n\n    if (evt.touches.length === 1) {\n      if (this.config.touchmoveTwoFingers) {\n        if (!this.prop.twofingersTimeout) {\n          this.prop.twofingersTimeout = setTimeout(() => {\n            this.psv.overlay.show({\n              id   : IDS.TWO_FINGERS,\n              image: gestureIcon,\n              text : this.config.lang.twoFingers,\n            });\n          }, TWOFINGERSOVERLAY_DELAY);\n        }\n      }\n      else {\n        evt.preventDefault();\n        this.__move(evt.touches[0]);\n      }\n    }\n    else if (evt.touches.length === 2) {\n      evt.preventDefault();\n      this.__moveZoom(evt);\n      this.__cancelTwoFingersOverlay();\n    }\n  }\n\n  /**\n   * @summary Cancel the long touch timer if any\n   * @private\n   */\n  __cancelLongTouch() {\n    if (this.prop.longtouchTimeout) {\n      clearTimeout(this.prop.longtouchTimeout);\n      this.prop.longtouchTimeout = null;\n    }\n  }\n\n  /**\n   * @summary Cancel the two fingers overlay timer if any\n   * @private\n   */\n  __cancelTwoFingersOverlay() {\n    if (this.prop.twofingersTimeout) {\n      clearTimeout(this.prop.twofingersTimeout);\n      this.prop.twofingersTimeout = null;\n    }\n    this.psv.overlay.hide(IDS.TWO_FINGERS);\n  }\n\n  /**\n   * @summary Handles mouse wheel events\n   * @param {WheelEvent} evt\n   * @private\n   */\n  __onMouseWheel(evt) {\n    if (!this.config.mousewheel) {\n      return;\n    }\n\n    if (this.config.mousewheelCtrlKey && !this.state.ctrlKeyDown) {\n      this.psv.overlay.show({\n        id   : IDS.CTRL_ZOOM,\n        image: mousewheelIcon,\n        text : this.config.lang.ctrlZoom,\n      });\n\n      clearTimeout(this.state.ctrlZoomTimeout);\n      this.state.ctrlZoomTimeout = setTimeout(() => this.psv.overlay.hide(IDS.CTRL_ZOOM), CTRLZOOM_TIMEOUT);\n\n      return;\n    }\n\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    const delta = normalizeWheel(evt).spinY * 5 * this.config.zoomSpeed;\n    if (delta !== 0) {\n      this.psv.dynamics.zoom.step(-delta, 5);\n    }\n  }\n\n  /**\n   * @summary Handles fullscreen events\n   * @param {boolean} [force] force state\n   * @fires PSV.fullscreen-updated\n   * @package\n   */\n  __fullscreenToggled(force) {\n    this.prop.fullscreen = force !== undefined ? force : isFullscreenEnabled(this.psv.container);\n\n    if (this.config.keyboard) {\n      if (this.prop.fullscreen) {\n        this.psv.startKeyboardControl();\n      }\n      else {\n        this.psv.stopKeyboardControl();\n      }\n    }\n\n    this.psv.trigger(EVENTS.FULLSCREEN_UPDATED, this.prop.fullscreen);\n  }\n\n  /**\n   * @summary Initializes the movement\n   * @param {MouseEvent|Touch} evt\n   * @private\n   */\n  __startMove(evt) {\n    this.psv.stopAutorotate();\n    this.psv.stopAnimation()\n      .then(() => {\n        this.state.mouseX = evt.clientX;\n        this.state.mouseY = evt.clientY;\n        this.state.startMouseX = this.state.mouseX;\n        this.state.startMouseY = this.state.mouseY;\n        this.state.moving = true;\n        this.state.zooming = false;\n\n        this.state.mouseHistory.length = 0;\n        this.__logMouseMove(evt);\n      });\n  }\n\n  /**\n   * @summary Initializes the combines move and zoom\n   * @param {TouchEvent} evt\n   * @private\n   */\n  __startMoveZoom(evt) {\n    const p1 = { x: evt.touches[0].clientX, y: evt.touches[0].clientY };\n    const p2 = { x: evt.touches[1].clientX, y: evt.touches[1].clientY };\n\n    this.state.pinchDist = distance(p1, p2);\n    this.state.mouseX = (p1.x + p2.x) / 2;\n    this.state.mouseY = (p1.y + p2.y) / 2;\n    this.state.startMouseX = this.state.mouseX;\n    this.state.startMouseY = this.state.mouseY;\n    this.state.moving = true;\n    this.state.zooming = true;\n  }\n\n  /**\n   * @summary Stops the movement\n   * @description If the move threshold was not reached a click event is triggered, otherwise an animation is launched to simulate inertia\n   * @param {MouseEvent|Touch} evt\n   * @private\n   */\n  __stopMove(evt) {\n    if (!getClosest(evt.target, '.psv-container')) {\n      this.state.moving = false;\n      this.state.mouseHistory.length = 0;\n      return;\n    }\n\n    if (this.state.moving) {\n      // move threshold to trigger a click\n      if (Math.abs(evt.clientX - this.state.startMouseX) < this.state.moveThreshold\n        && Math.abs(evt.clientY - this.state.startMouseY) < this.state.moveThreshold) {\n        this.__click(evt);\n        this.state.moving = false;\n      }\n      // inertia animation\n      else if (this.config.moveInertia) {\n        this.__logMouseMove(evt);\n        this.__stopMoveInertia(evt);\n      }\n      else {\n        this.state.moving = false;\n      }\n\n      this.state.mouseHistory.length = 0;\n    }\n  }\n\n  /**\n   * @summary Stops the combined move and zoom\n   * @private\n   */\n  __stopMoveZoom() {\n    this.state.mouseHistory.length = 0;\n    this.state.moving = false;\n    this.state.zooming = false;\n  }\n\n  /**\n   * @summary Performs an animation to simulate inertia when the movement stops\n   * @param {MouseEvent|Touch} evt\n   * @private\n   */\n  __stopMoveInertia(evt) {\n    const direction = {\n      x: evt.clientX - this.state.mouseHistory[0][1],\n      y: evt.clientY - this.state.mouseHistory[0][2],\n    };\n\n    const norm = Math.sqrt(direction.x * direction.x + direction.y * direction.y);\n\n    this.prop.animationPromise = new Animation({\n      properties: {\n        clientX: { start: evt.clientX, end: evt.clientX + direction.x },\n        clientY: { start: evt.clientY, end: evt.clientY + direction.y },\n      },\n      duration  : norm * INERTIA_WINDOW / 100,\n      easing    : 'outCirc',\n      onTick    : (properties) => {\n        this.__move(properties, false);\n      },\n    });\n\n    this.prop.animationPromise\n      .then(() => {\n        this.state.moving = false;\n      });\n  }\n\n  /**\n   * @summary Triggers an event with all coordinates when a simple click is performed\n   * @param {MouseEvent|Touch} evt\n   * @param {boolean} [longtouch=false]\n   * @fires PSV.click\n   * @fires PSV.dblclick\n   * @private\n   */\n  __click(evt, longtouch = false) {\n    const boundingRect = this.psv.container.getBoundingClientRect();\n\n    /**\n     * @type {PSV.ClickData}\n     */\n    const data = {\n      rightclick: longtouch || evt.button === 2,\n      target    : evt.target,\n      clientX   : evt.clientX,\n      clientY   : evt.clientY,\n      viewerX   : evt.clientX - boundingRect.left,\n      viewerY   : evt.clientY - boundingRect.top,\n    };\n\n    const intersections = this.psv.dataHelper.getIntersections({\n      x: data.viewerX,\n      y: data.viewerY,\n    });\n\n    const sphereIntersection = intersections.find(i => i.object.userData.psvSphere);\n\n    if (sphereIntersection) {\n      const sphericalCoords = this.psv.dataHelper.vector3ToSphericalCoords(sphereIntersection.point);\n      data.longitude = sphericalCoords.longitude;\n      data.latitude = sphericalCoords.latitude;\n\n      data.objects = intersections.map(i => i.object).filter(o => !o.userData.psvSphere);\n\n      try {\n        const textureCoords = this.psv.dataHelper.sphericalCoordsToTextureCoords(data);\n        data.textureX = textureCoords.x;\n        data.textureY = textureCoords.y;\n      }\n      catch (e) {\n        data.textureX = NaN;\n        data.textureY = NaN;\n      }\n\n      if (!this.state.dblclickTimeout) {\n        this.psv.trigger(EVENTS.CLICK, data);\n\n        this.state.dblclickData = clone(data);\n        this.state.dblclickTimeout = setTimeout(() => {\n          this.state.dblclickTimeout = null;\n          this.state.dblclickData = null;\n        }, DBLCLICK_DELAY);\n      }\n      else {\n        if (Math.abs(this.state.dblclickData.clientX - data.clientX) < this.state.moveThreshold\n          && Math.abs(this.state.dblclickData.clientY - data.clientY) < this.state.moveThreshold) {\n          this.psv.trigger(EVENTS.DOUBLE_CLICK, this.state.dblclickData);\n        }\n\n        clearTimeout(this.state.dblclickTimeout);\n        this.state.dblclickTimeout = null;\n        this.state.dblclickData = null;\n      }\n    }\n  }\n\n  /**\n   * @summary Performs movement\n   * @param {MouseEvent|Touch} evt\n   * @param {boolean} [log=true]\n   * @private\n   */\n  __move(evt, log) {\n    if (this.state.moving) {\n      const x = evt.clientX;\n      const y = evt.clientY;\n\n      const rotation = {\n        longitude: (x - this.state.mouseX) / this.prop.size.width * this.config.moveSpeed * THREE.Math.degToRad(this.prop.hFov),\n        latitude : (y - this.state.mouseY) / this.prop.size.height * this.config.moveSpeed * THREE.Math.degToRad(this.prop.vFov),\n      };\n\n      const currentPosition = this.psv.getPosition();\n      this.psv.rotate({\n        longitude: currentPosition.longitude - rotation.longitude,\n        latitude : currentPosition.latitude + rotation.latitude,\n      });\n\n      this.state.mouseX = x;\n      this.state.mouseY = y;\n\n      if (log !== false) {\n        this.__logMouseMove(evt);\n      }\n    }\n  }\n\n  /**\n   * @summary Performs movement absolute to cursor position in viewer\n   * @param {MouseEvent} evt\n   * @private\n   */\n  __moveAbsolute(evt) {\n    if (this.state.moving) {\n      const containerRect = this.psv.container.getBoundingClientRect();\n      this.psv.dynamics.position.goto({\n        longitude: ((evt.clientX - containerRect.left) / containerRect.width - 0.5) * Math.PI * 2,\n        latitude : -((evt.clientY - containerRect.top) / containerRect.height - 0.5) * Math.PI,\n      }, 10);\n    }\n  }\n\n  /**\n   * @summary Perfoms combined move and zoom\n   * @param {TouchEvent} evt\n   * @private\n   */\n  __moveZoom(evt) {\n    if (this.state.zooming && this.state.moving) {\n      const p1 = { x: evt.touches[0].clientX, y: evt.touches[0].clientY };\n      const p2 = { x: evt.touches[1].clientX, y: evt.touches[1].clientY };\n\n      const p = distance(p1, p2);\n      const delta = 80 * (p - this.state.pinchDist) / this.prop.size.width * this.config.zoomSpeed;\n\n      this.psv.zoom(this.psv.getZoomLevel() + delta);\n\n      this.__move({\n        clientX: (p1.x + p2.x) / 2,\n        clientY: (p1.y + p2.y) / 2,\n      });\n\n      this.state.pinchDist = p;\n    }\n  }\n\n  /**\n   * @summary Stores each mouse position during a mouse move\n   * @description Positions older than \"INERTIA_WINDOW\" are removed<br>\n   *     Positions before a pause of \"INERTIA_WINDOW\" / 10 are removed\n   * @param {MouseEvent|Touch} evt\n   * @private\n   */\n  __logMouseMove(evt) {\n    const now = Date.now();\n    this.state.mouseHistory.push([now, evt.clientX, evt.clientY]);\n\n    let previous = null;\n\n    for (let i = 0; i < this.state.mouseHistory.length;) {\n      if (this.state.mouseHistory[0][i] < now - INERTIA_WINDOW) {\n        this.state.mouseHistory.splice(i, 1);\n      }\n      else if (previous && this.state.mouseHistory[0][i] - previous > INERTIA_WINDOW / 10) {\n        this.state.mouseHistory.splice(0, i);\n        i = 0;\n        previous = this.state.mouseHistory[0][i];\n      }\n      else {\n        i++;\n        previous = this.state.mouseHistory[0][i];\n      }\n    }\n  }\n\n}\n","import * as THREE from 'three';\nimport { Animation } from '../Animation';\nimport { EVENTS, MESH_USER_DATA, SPHERE_RADIUS } from '../data/constants';\nimport { SYSTEM } from '../data/system';\nimport { each, isExtendedPosition } from '../utils';\nimport { AbstractService } from './AbstractService';\n\n/**\n * @summary Viewer and renderer\n * @extends PSV.services.AbstractService\n * @memberof PSV.services\n */\nexport class Renderer extends AbstractService {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv);\n\n    /**\n     * @member {external:THREE.WebGLRenderer}\n     * @readonly\n     * @protected\n     */\n    this.renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });\n    this.renderer.setPixelRatio(SYSTEM.pixelRatio);\n    this.renderer.domElement.className = 'psv-canvas';\n\n    /**\n     * @member {external:THREE.Scene}\n     * @readonly\n     * @protected\n     */\n    this.scene = new THREE.Scene();\n\n    /**\n     * @member {external:THREE.PerspectiveCamera}\n     * @readonly\n     * @protected\n     */\n    this.camera = new THREE.PerspectiveCamera(50, 16 / 9, 1, 2 * SPHERE_RADIUS);\n\n    /**\n     * @member {external:THREE.Mesh}\n     * @readonly\n     * @protected\n     */\n    this.mesh = this.psv.adapter.createMesh();\n    this.mesh.userData = { [MESH_USER_DATA]: true };\n\n    /**\n     * @member {external:THREE.Group}\n     * @readonly\n     * @private\n     */\n    this.meshContainer = new THREE.Group();\n    this.meshContainer.add(this.mesh);\n    this.scene.add(this.meshContainer);\n\n    /**\n     * @member {external:THREE.Raycaster}\n     * @readonly\n     * @protected\n     */\n    this.raycaster = new THREE.Raycaster();\n\n    /**\n     * @member {number}\n     * @private\n     */\n    this.timestamp = null;\n\n    /**\n     * @member {boolean}\n     * @private\n     */\n    this.ready = false;\n\n    /**\n     * @member {HTMLElement}\n     * @readonly\n     * @package\n     */\n    this.canvasContainer = document.createElement('div');\n    this.canvasContainer.className = 'psv-canvas-container';\n    this.canvasContainer.style.background = this.psv.config.canvasBackground;\n    this.canvasContainer.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\n    this.canvasContainer.appendChild(this.renderer.domElement);\n    this.psv.container.appendChild(this.canvasContainer);\n\n    psv.on(EVENTS.SIZE_UPDATED, this);\n    psv.on(EVENTS.ZOOM_UPDATED, this);\n    psv.on(EVENTS.POSITION_UPDATED, this);\n    psv.on(EVENTS.CONFIG_CHANGED, this);\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    // cancel render loop\n    this.renderer.setAnimationLoop(null);\n\n    // destroy ThreeJS view\n    this.__cleanTHREEScene(this.scene);\n\n    // remove container\n    this.psv.container.removeChild(this.canvasContainer);\n\n    delete this.canvasContainer;\n    delete this.renderer;\n    delete this.scene;\n    delete this.camera;\n    delete this.mesh;\n    delete this.meshContainer;\n    delete this.raycaster;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} evt\n   * @private\n   */\n  handleEvent(evt) {\n    /* eslint-disable */\n    switch (evt.type) {\n      // @formatter:off\n      case EVENTS.SIZE_UPDATED:     this.__onSizeUpdated(); break;\n      case EVENTS.ZOOM_UPDATED:     this.__onZoomUpdated(); break;\n      case EVENTS.POSITION_UPDATED: this.__onPositionUpdated(); break;\n      case EVENTS.CONFIG_CHANGED:\n        if (evt.args[0].indexOf('fisheye') !== -1) {\n          this.__onPositionUpdated();\n        }\n        if (evt.args[0].indexOf('mousemove') !== -1) {\n          this.canvasContainer.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\n        }\n        break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @summary Hides the viewer\n   */\n  hide() {\n    this.canvasContainer.style.opacity = 0;\n  }\n\n  /**\n   * @summary Shows the viewer\n   */\n  show() {\n    this.canvasContainer.style.opacity = 1;\n  }\n\n  /**\n   * @summary Updates the size of the renderer and the aspect of the camera\n   * @private\n   */\n  __onSizeUpdated() {\n    this.renderer.setSize(this.prop.size.width, this.prop.size.height);\n    this.camera.aspect = this.prop.aspect;\n    this.camera.updateProjectionMatrix();\n    this.prop.needsUpdate = true;\n  }\n\n  /**\n   * @summary Updates the fov of the camera\n   * @private\n   */\n  __onZoomUpdated() {\n    this.camera.fov = this.prop.vFov;\n    this.camera.updateProjectionMatrix();\n    this.prop.needsUpdate = true;\n  }\n\n  /**\n   * @summary Updates the position of the camera\n   * @private\n   */\n  __onPositionUpdated() {\n    this.camera.position.set(0, 0, 0);\n    this.camera.lookAt(this.prop.direction);\n    if (this.config.fisheye) {\n      this.camera.position.copy(this.prop.direction).multiplyScalar(this.config.fisheye / 2).negate();\n    }\n    this.prop.needsUpdate = true;\n  }\n\n  /**\n   * @summary Main event loop, calls {@link render} if `prop.needsUpdate` is true\n   * @param {number} timestamp\n   * @fires PSV.before-render\n   * @private\n   */\n  __renderLoop(timestamp) {\n    const elapsed = this.timestamp !== null ? timestamp - this.timestamp : 0;\n    this.timestamp = timestamp;\n\n    this.psv.trigger(EVENTS.BEFORE_RENDER, timestamp, elapsed);\n    each(this.psv.dynamics, d => d.update(elapsed));\n\n    if (this.prop.needsUpdate) {\n      this.render();\n      this.prop.needsUpdate = false;\n    }\n  }\n\n  /**\n   * @summary Performs a render\n   * @description Do not call this method directly, instead call\n   * {@link PSV.Viewer#needsUpdate} on {@link PSV.event:before-render}.\n   * @fires PSV.render\n   */\n  render() {\n    this.renderer.render(this.scene, this.camera);\n    this.psv.trigger(EVENTS.RENDER);\n  }\n\n  /**\n   * @summary Applies the texture to the scene, creates the scene if needed\n   * @param {PSV.TextureData} textureData\n   * @fires PSV.panorama-loaded\n   * @package\n   */\n  setTexture(textureData) {\n    this.prop.panoData = textureData.panoData;\n\n    this.psv.adapter.setTexture(this.mesh, textureData);\n\n    if (!this.ready) {\n      this.renderer.setAnimationLoop(t => this.__renderLoop(t));\n      this.ready = true;\n    }\n\n    this.psv.needsUpdate();\n\n    this.psv.trigger(EVENTS.PANORAMA_LOADED);\n  }\n\n  /**\n   * @summary Apply a panorama data pose to a Mesh\n   * @param {PSV.PanoData} [panoData]\n   * @param {external:THREE.Mesh} [mesh=this.mesh]\n   * @package\n   */\n  setPanoramaPose(panoData, mesh = this.mesh) {\n    // By Google documentation the angles are applied on the camera in order : heading, pitch, roll\n    // here we apply the reverse transformation on the sphere\n    const cleanCorrection = this.psv.dataHelper.cleanPanoramaPose(panoData);\n\n    mesh.rotation.set(\n      -cleanCorrection.tilt,\n      -cleanCorrection.pan,\n      -cleanCorrection.roll,\n      'ZXY'\n    );\n  }\n\n  /**\n   * @summary Apply a SphereCorrection to a Mesh\n   * @param {PSV.SphereCorrection} [sphereCorrection]\n   * @param {external:THREE.Mesh} [mesh=this.meshContainer]\n   * @package\n   */\n  setSphereCorrection(sphereCorrection, mesh = this.meshContainer) {\n    const cleanCorrection = this.psv.dataHelper.cleanSphereCorrection(sphereCorrection);\n\n    mesh.rotation.set(\n      cleanCorrection.tilt,\n      cleanCorrection.pan,\n      cleanCorrection.roll,\n      'ZXY'\n    );\n  }\n\n  /**\n   * @summary Performs transition between the current and a new texture\n   * @param {PSV.TextureData} textureData\n   * @param {PSV.PanoramaOptions} options\n   * @returns {PSV.Animation}\n   * @package\n   */\n  transition(textureData, options) {\n    const positionProvided = isExtendedPosition(options);\n    const zoomProvided = 'zoom' in options;\n\n    // create temp group and new mesh, half size to be in \"front\" of the first one\n    const group = new THREE.Group();\n    const mesh = this.psv.adapter.createMesh(0.5);\n    this.psv.adapter.setTexture(mesh, textureData, true);\n    this.psv.adapter.setTextureOpacity(mesh, 0);\n    this.setPanoramaPose(textureData.panoData, mesh);\n    this.setSphereCorrection(options.sphereCorrection, group);\n\n    // rotate the new sphere to make the target position face the camera\n    if (positionProvided) {\n      const cleanPosition = this.psv.dataHelper.cleanPosition(options);\n      const currentPosition = this.psv.getPosition();\n\n      // Longitude rotation along the vertical axis\n      const verticalAxis = new THREE.Vector3(0, 1, 0);\n      group.rotateOnWorldAxis(verticalAxis, cleanPosition.longitude - currentPosition.longitude);\n\n      // Latitude rotation along the camera horizontal axis\n      const horizontalAxis = new THREE.Vector3(0, 1, 0).cross(this.camera.getWorldDirection(new THREE.Vector3())).normalize();\n      group.rotateOnWorldAxis(horizontalAxis, cleanPosition.latitude - currentPosition.latitude);\n    }\n\n    group.add(mesh);\n    this.scene.add(group);\n\n    const animation = new Animation({\n      properties: {\n        opacity: { start: 0.0, end: 1.0 },\n        zoom   : zoomProvided ? { start: this.psv.getZoomLevel(), end: options.zoom } : undefined,\n      },\n      duration  : options.transition,\n      easing    : 'outCubic',\n      onTick    : (properties) => {\n        this.psv.adapter.setTextureOpacity(mesh, properties.opacity);\n        this.psv.adapter.setTextureOpacity(this.mesh, 1 - properties.opacity);\n\n        if (zoomProvided) {\n          this.psv.zoom(properties.zoom);\n        }\n\n        this.psv.needsUpdate();\n      },\n    });\n\n    animation\n      .then((completed) => {\n        if (completed) {\n          // remove temp sphere and transfer the texture to the main mesh\n          this.setTexture(textureData);\n          this.psv.adapter.setTextureOpacity(this.mesh, 1);\n          this.setPanoramaPose(textureData.panoData);\n          this.setSphereCorrection(options.sphereCorrection);\n\n          // actually rotate the camera\n          if (positionProvided) {\n            this.psv.rotate(options);\n          }\n        }\n        else {\n          this.psv.adapter.disposeTexture(textureData);\n        }\n\n        this.scene.remove(group);\n        mesh.geometry.dispose();\n        mesh.geometry = null;\n      });\n\n    return animation;\n  }\n\n  /**\n   * @summary Calls `dispose` on all objects and textures\n   * @param {external:THREE.Object3D} object\n   * @private\n   */\n  __cleanTHREEScene(object) {\n    object.traverse((item) => {\n      if (item.geometry) {\n        item.geometry.dispose();\n      }\n\n      if (item.material) {\n        if (Array.isArray(item.material)) {\n          item.material.forEach((material) => {\n            if (material.map) {\n              material.map.dispose();\n            }\n\n            material.dispose();\n          });\n        }\n        else {\n          if (item.material.map) {\n            item.material.map.dispose();\n          }\n\n          item.material.dispose();\n        }\n      }\n\n      if (item.dispose && !(item instanceof THREE.Scene)) {\n        item.dispose();\n      }\n\n      if (item !== object) {\n        this.__cleanTHREEScene(item);\n      }\n    });\n  }\n\n}\n","import * as THREE from 'three';\nimport { AbstractService } from './AbstractService';\n\n/**\n * @summary Texture loader\n * @extends PSV.services.AbstractService\n * @memberof PSV.services\n */\nexport class TextureLoader extends AbstractService {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv);\n\n    /**\n     * @summary THREE file loader\n     * @type {external:THREE:FileLoader}\n     * @private\n     */\n    this.loader = new THREE.FileLoader();\n    this.loader.setResponseType('blob');\n    if (this.config.withCredentials) {\n      this.loader.setWithCredentials(true);\n    }\n    if (this.config.requestHeaders && typeof this.config.requestHeaders === 'object') {\n      this.loader.setRequestHeader(this.config.requestHeaders);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.abortLoading();\n    super.destroy();\n  }\n\n  /**\n   * @summary Loads the panorama texture(s)\n   * @param {*} panorama\n   * @param {PSV.PanoData | PSV.PanoDataProvider} [newPanoData]\n   * @returns {Promise.<PSV.TextureData>}\n   * @throws {PSV.PSVError} when the image cannot be loaded\n   * @package\n   * @deprecated\n   */\n  loadTexture(panorama, newPanoData) {\n    return this.psv.adapter.loadTexture(panorama, newPanoData);\n  }\n\n  /**\n   * @summary Cancels current HTTP requests\n   * @package\n   */\n  abortLoading() {\n    // noop implementation waiting for https://github.com/mrdoob/three.js/pull/23070\n  }\n\n  /**\n   * @summary Loads a Blob with FileLoader\n   * @param {string} url\n   * @param {function(number)} [onProgress]\n   * @returns {Promise<Blob>}\n   */\n  loadFile(url, onProgress) {\n    if (this.config.requestHeaders && typeof this.config.requestHeaders === 'function') {\n      this.loader.setRequestHeader(this.config.requestHeaders(url));\n    }\n\n    return new Promise((resolve, reject) => {\n      let progress = 0;\n      onProgress && onProgress(progress);\n\n      this.loader.load(\n        url,\n        (result) => {\n          progress = 100;\n          onProgress && onProgress(progress);\n          resolve(result);\n        },\n        (e) => {\n          if (e.lengthComputable) {\n            const newProgress = e.loaded / e.total * 100;\n            if (newProgress > progress) {\n              progress = newProgress;\n              onProgress && onProgress(progress);\n            }\n          }\n        },\n        (err) => {\n          reject(err);\n        }\n      );\n    });\n  }\n\n  /**\n   * @summary Loads an Image using FileLoader to have progress events\n   * @param {string} url\n   * @param {function(number)} [onProgress]\n   * @returns {Promise<HTMLImageElement>}\n   */\n  loadImage(url, onProgress) {\n    return this.loadFile(url, onProgress)\n      .then(result => new Promise((resolve, reject) => {\n        const img = document.createElementNS('http://www.w3.org/1999/xhtml', 'img');\n        img.onload = () => {\n          URL.revokeObjectURL(img.src);\n          resolve(img);\n        };\n        img.onerror = reject;\n        img.src = URL.createObjectURL(result);\n      }));\n  }\n\n  /**\n   * @summary Preload a panorama file without displaying it\n   * @param {*} panorama\n   * @returns {Promise}\n   */\n  preloadPanorama(panorama) {\n    if (this.psv.adapter.supportsPreload(panorama)) {\n      return this.psv.adapter.loadTexture(panorama);\n    }\n    else {\n      return Promise.resolve();\n    }\n  }\n\n}\n","import { EVENTS } from '../data/constants';\nimport { PSVError } from '../PSVError';\nimport { addClasses, cleanPosition } from '../utils';\nimport { AbstractComponent } from './AbstractComponent';\n\nconst STATE = { NONE: 0, SHOWING: 1, HIDING: 2, READY: 3 };\n\n/**\n * @typedef {Object} PSV.components.Tooltip.Position\n * @summary Object defining the tooltip position\n * @property {number} top - Position of the tip of the arrow of the tooltip, in pixels\n * @property {number} left - Position of the tip of the arrow of the tooltip, in pixels\n * @property {string|string[]} [position='top center'] - Tooltip position toward it's arrow tip.\n *           Accepted values are combinations of `top`, `center`, `bottom` and `left`, `center`, `right`\n * @property {Object} [box] - Used when displaying a tooltip on a marker\n * @property {number} [box.width=0]\n * @property {number} [box.height=0]\n */\n\n/**\n * @typedef {PSV.components.Tooltip.Position} PSV.components.Tooltip.Config\n * @summary Object defining the tooltip configuration\n * @property {string} content - HTML content of the tooltip\n * @property {string} [className] - Additional CSS class added to the tooltip\n * @property {*} [data] - Userdata associated to the tooltip\n */\n\n/**\n * @summary Tooltip component\n * @description Never instanciate tooltips directly use {@link PSV.services.TooltipRenderer} instead\n * @extends PSV.components.AbstractComponent\n * @memberof PSV.components\n */\nexport class Tooltip extends AbstractComponent {\n\n  /**\n   * @param {PSV.Viewer} psv\n   * @param {{arrow: number, offset: number}} size\n   */\n  constructor(psv, size) {\n    super(psv, 'psv-tooltip');\n\n    /**\n     * @override\n     * @property {number} arrow\n     * @property {number} offset\n     * @property {number} width\n     * @property {number} height\n     * @property {string} pos\n     * @property {string} state\n     * @property {*} data\n     */\n    this.prop = {\n      ...this.prop,\n      ...size,\n      state : STATE.NONE,\n      width : 0,\n      height: 0,\n      pos   : '',\n      data  : null,\n    };\n\n    /**\n     * Tooltip content\n     * @member {HTMLElement}\n     * @readonly\n     * @private\n     */\n    this.content = document.createElement('div');\n    this.content.className = 'psv-tooltip-content';\n    this.container.appendChild(this.content);\n\n    /**\n     * Tooltip arrow\n     * @member {HTMLElement}\n     * @readonly\n     * @package\n     */\n    this.arrow = document.createElement('div');\n    this.arrow.className = 'psv-tooltip-arrow';\n    this.container.appendChild(this.arrow);\n\n    this.container.addEventListener('transitionend', this);\n\n    this.container.style.top = '-1000px';\n    this.container.style.left = '-1000px';\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    delete this.arrow;\n    delete this.content;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case 'transitionend': this.__onTransitionEnd(e); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @summary This method is not supported\n   * @throws {PSV.PSVError} always\n   */\n  toggle() {\n    throw new PSVError('Tooltip cannot be toggled');\n  }\n\n  /**\n   * @summary Displays the tooltip on the viewer\n   * Do not call this method directly, use {@link PSV.services.TooltipRenderer} instead.\n   * @param {PSV.components.Tooltip.Config} config\n   *\n   * @fires PSV.show-tooltip\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   *\n   * @package\n   */\n  show(config) {\n    if (this.prop.state !== STATE.NONE) {\n      throw new PSVError('Initialized tooltip cannot be re-initialized');\n    }\n\n    if (config.className) {\n      addClasses(this.container, config.className);\n    }\n\n    this.content.innerHTML = config.content;\n\n    const rect = this.container.getBoundingClientRect();\n    this.prop.width = rect.right - rect.left;\n    this.prop.height = rect.bottom - rect.top;\n\n    this.prop.state = STATE.READY;\n\n    this.move(config);\n\n    this.prop.data = config.data;\n    this.prop.state = STATE.SHOWING;\n\n    this.psv.trigger(EVENTS.SHOW_TOOLTIP, this.prop.data, this);\n  }\n\n  /**\n   * @summary Moves the tooltip to a new position\n   * @param {PSV.components.Tooltip.Position} config\n   *\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   */\n  move(config) {\n    if (this.prop.state !== STATE.SHOWING && this.prop.state !== STATE.READY) {\n      throw new PSVError('Uninitialized tooltip cannot be moved');\n    }\n\n    const t = this.container;\n    const a = this.arrow;\n\n    // compute size\n    const style = {\n      posClass : cleanPosition(config.position, 'top center', false),\n      width    : this.prop.width,\n      height   : this.prop.height,\n      top      : 0,\n      left     : 0,\n      arrowTop : 0,\n      arrowLeft: 0,\n    };\n\n    // set initial position\n    this.__computeTooltipPosition(style, config);\n\n    // correct position if overflow\n    let refresh = false;\n    if (style.top < this.prop.offset) {\n      style.posClass[0] = 'bottom';\n      refresh = true;\n    }\n    else if (style.top + style.height > this.psv.prop.size.height - this.prop.offset) {\n      style.posClass[0] = 'top';\n      refresh = true;\n    }\n    if (style.left < this.prop.offset) {\n      style.posClass[1] = 'right';\n      refresh = true;\n    }\n    else if (style.left + style.width > this.psv.prop.size.width - this.prop.offset) {\n      style.posClass[1] = 'left';\n      refresh = true;\n    }\n    if (refresh) {\n      this.__computeTooltipPosition(style, config);\n    }\n\n    // apply position\n    t.style.top = style.top + 'px';\n    t.style.left = style.left + 'px';\n\n    a.style.top = style.arrowTop + 'px';\n    a.style.left = style.arrowLeft + 'px';\n\n    const newPos = style.posClass.join('-');\n    if (newPos !== this.prop.pos) {\n      t.classList.remove(`psv-tooltip--${this.prop.pos}`);\n\n      this.prop.pos = newPos;\n      t.classList.add(`psv-tooltip--${this.prop.pos}`);\n    }\n  }\n\n  /**\n   * @summary Hides the tooltip\n   * @fires PSV.hide-tooltip\n   */\n  hide() {\n    this.container.classList.remove('psv-tooltip--visible');\n    this.prop.state = STATE.HIDING;\n\n    this.psv.trigger(EVENTS.HIDE_TOOLTIP, this.prop.data);\n  }\n\n  /**\n   * @summary Finalize transition\n   * @param {TransitionEvent} e\n   * @private\n   */\n  __onTransitionEnd(e) {\n    if (e.propertyName === 'transform') {\n      switch (this.prop.state) {\n        case STATE.SHOWING:\n          this.container.classList.add('psv-tooltip--visible');\n          this.prop.state = STATE.READY;\n          break;\n\n        case STATE.HIDING:\n          this.prop.state = STATE.NONE;\n          this.destroy();\n          break;\n\n        default:\n          // nothing\n      }\n    }\n  }\n\n  /**\n   * @summary Computes the position of the tooltip and its arrow\n   * @param {Object} style\n   * @param {Object} config\n   * @private\n   */\n  __computeTooltipPosition(style, config) {\n    let topBottom = false;\n\n    if (!config.box) {\n      config.box = {\n        width : 0,\n        height: 0,\n      };\n    }\n\n    switch (style.posClass[0]) {\n      case 'bottom':\n        style.top = config.top + config.box.height + this.prop.offset + this.prop.arrow;\n        style.arrowTop = -this.prop.arrow * 2;\n        topBottom = true;\n        break;\n\n      case 'center':\n        style.top = config.top + config.box.height / 2 - style.height / 2;\n        style.arrowTop = style.height / 2 - this.prop.arrow;\n        break;\n\n      case 'top':\n        style.top = config.top - style.height - this.prop.offset - this.prop.arrow;\n        style.arrowTop = style.height;\n        topBottom = true;\n        break;\n\n      // no default\n    }\n\n    switch (style.posClass[1]) {\n      case 'right':\n        if (topBottom) {\n          style.left = config.left + config.box.width / 2 - this.prop.offset - this.prop.arrow;\n          style.arrowLeft = this.prop.offset;\n        }\n        else {\n          style.left = config.left + config.box.width + this.prop.offset + this.prop.arrow;\n          style.arrowLeft = -this.prop.arrow * 2;\n        }\n        break;\n\n      case 'center':\n        style.left = config.left + config.box.width / 2 - style.width / 2;\n        style.arrowLeft = style.width / 2 - this.prop.arrow;\n        break;\n\n      case 'left':\n        if (topBottom) {\n          style.left = config.left - style.width + config.box.width / 2 + this.prop.offset + this.prop.arrow;\n          style.arrowLeft = style.width - this.prop.offset - this.prop.arrow * 2;\n        }\n        else {\n          style.left = config.left - style.width - this.prop.offset - this.prop.arrow;\n          style.arrowLeft = style.width;\n        }\n        break;\n\n      // no default\n    }\n  }\n\n}\n","import { Tooltip } from '../components/Tooltip';\nimport { getStyle } from '../utils';\nimport { AbstractService } from './AbstractService';\n\n/**\n * @summary Tooltip renderer\n * @extends PSV.services.AbstractService\n * @memberof PSV.services\n */\nexport class TooltipRenderer extends AbstractService {\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv);\n\n    const testTooltip = new Tooltip(this.psv);\n\n    /**\n     * @summary Computed static sizes\n     * @member {Object}\n     * @package\n     * @property {number} arrowSize\n     * @property {number} offset\n     */\n    this.size = {\n      arrow : parseInt(getStyle(testTooltip.arrow, 'borderTopWidth'), 10),\n      offset: parseInt(getStyle(testTooltip.container, 'outlineWidth'), 10),\n    };\n\n    testTooltip.destroy();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    delete this.size;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Displays a tooltip on the viewer\n   * @param {PSV.components.Tooltip.Config} config\n   * @returns {PSV.components.Tooltip}\n   *\n   * @fires PSV.show-tooltip\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   *\n   * @example\n   * viewer.tooltip.create({ content: 'Hello world', top: 200, left: 450, position: 'center bottom'})\n   */\n  create(config) {\n    const tooltip = new Tooltip(this.psv, this.size);\n    tooltip.show(config);\n\n    return tooltip;\n  }\n\n}\n","import { bound } from './index';\n\n/**\n * @summary Represents a variable that can dynamically change with time (using requestAnimationFrame)\n * @memberOf PSV\n * @package\n */\nexport class Dynamic {\n\n  static STOP = 0;\n  static INFINITE = 1;\n  static POSITION = 2;\n\n  /**\n   * @param {Function} [fn] Callback function\n   * @param {number} [defaultValue] Default position\n   * @param {number} [min] Minimum position\n   * @param {number} [max] Maximum position\n   */\n  constructor(fn, defaultValue = 0, min = -Infinity, max = Infinity) {\n    /**\n     * @type {Function}\n     * @private\n     * @readonly\n     */\n    this.fn = fn;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.mode = Dynamic.STOP;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.speed = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.speedMult = 1;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.currentSpeed = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.target = 0;\n\n    /**\n     * @type {number}\n     * @readonly\n     */\n    this.current = defaultValue;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.min = min;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.max = max;\n\n    if (this.fn) {\n      this.fn(defaultValue);\n    }\n  }\n\n  /**\n   * Changes base speed\n   * @param {number} speed\n   */\n  setSpeed(speed) {\n    this.speed = speed;\n  }\n\n  /**\n   * Defines the target position\n   * @param {number} position\n   * @param {number} [speedMult=1]\n   */\n  goto(position, speedMult = 1) {\n    this.mode = Dynamic.POSITION;\n    this.target = bound(position, this.min, this.max);\n    this.speedMult = speedMult;\n  }\n\n  /**\n   * Increase/decrease the target position\n   * @param {number} step\n   * @param {number} [speedMult=1]\n   */\n  step(step, speedMult = 1) {\n    if (this.mode !== Dynamic.POSITION) {\n      this.target = this.current;\n    }\n    this.goto(this.target + step, speedMult);\n  }\n\n  /**\n   * Starts infinite movement\n   * @param {boolean} [invert=false]\n   * @param {number} [speedMult=1]\n   */\n  roll(invert = false, speedMult = 1) {\n    this.mode = Dynamic.INFINITE;\n    this.target = invert ? -Infinity : Infinity;\n    this.speedMult = speedMult;\n  }\n\n  /**\n   * Stops movement\n   */\n  stop() {\n    this.mode = Dynamic.STOP;\n  }\n\n  /**\n   * Defines the current position and immediately stops movement\n   * @param {number} values\n   */\n  setValue(values) {\n    const next = bound(values, this.min, this.max);\n    this.target = next;\n    this.mode = Dynamic.STOP;\n    if (next !== this.current) {\n      this.current = next;\n      if (this.fn) {\n        this.fn(this.current);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * @package\n   */\n  update(elapsed) {\n    // in position mode switch to stop mode when in the decceleration window\n    if (this.mode === Dynamic.POSITION) {\n      const dstStop = this.currentSpeed * this.currentSpeed / (this.speed * this.speedMult * 4);\n      if (Math.abs(this.target - this.current) <= dstStop) {\n        this.mode = Dynamic.STOP;\n      }\n    }\n\n    // compute speed\n    let targetSpeed = this.mode === Dynamic.STOP ? 0 : this.speed * this.speedMult;\n    if (this.target < this.current) {\n      targetSpeed = -targetSpeed;\n    }\n    if (this.currentSpeed < targetSpeed) {\n      this.currentSpeed = Math.min(targetSpeed, this.currentSpeed + elapsed / 1000 * this.speed * this.speedMult * 2);\n    }\n    else if (this.currentSpeed > targetSpeed) {\n      this.currentSpeed = Math.max(targetSpeed, this.currentSpeed - elapsed / 1000 * this.speed * this.speedMult * 2);\n    }\n\n    // compute new position\n    let next = null;\n    if (this.current > this.target && this.currentSpeed) {\n      next = Math.max(this.target, this.current + this.currentSpeed * elapsed / 1000);\n    }\n    else if (this.current < this.target && this.currentSpeed) {\n      next = Math.min(this.target, this.current + this.currentSpeed * elapsed / 1000);\n    }\n\n    // apply value\n    if (next !== null) {\n      next = bound(next, this.min, this.max);\n      if (next !== this.current) {\n        this.current = next;\n        if (this.fn) {\n          this.fn(this.current);\n        }\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n}\n","import { each } from './index';\n\n/**\n * @summary Wrapper for multiple {@link PSV.Dynamic} evolving together\n * @memberOf PSV\n * @package\n */\nexport class MultiDynamic {\n\n  /**\n   * @type {Object<string, number>}\n   * @readonly\n   */\n  get current() {\n    const values = {};\n    each(this.dynamics, (dynamic, name) => {\n      values[name] = dynamic.current;\n    });\n    return values;\n  }\n\n  /**\n   * @param {Record<string, PSV.Dynamic>} dynamics\n   * @param {Function} [fn] Callback function\n   */\n  constructor(dynamics, fn) {\n    /**\n     * @type {Function}\n     * @private\n     * @readonly\n     */\n    this.fn = fn;\n\n    /**\n     * @type {Record<string, PSV.Dynamic>}\n     * @private\n     * @readonly\n     */\n    this.dynamics = dynamics;\n\n    if (this.fn) {\n      this.fn(this.current);\n    }\n  }\n\n  /**\n   * Changes base speed\n   * @param {number} speed\n   */\n  setSpeed(speed) {\n    each(this.dynamics, (d) => {\n      d.setSpeed(speed);\n    });\n  }\n\n  /**\n   * Defines the target positions\n   * @param {Record<string, number>} positions\n   * @param {number} [speedMult=1]\n   */\n  goto(positions, speedMult = 1) {\n    each(positions, (position, name) => {\n      this.dynamics[name].goto(position, speedMult);\n    });\n  }\n\n  /**\n   * Increase/decrease the target positions\n   * @param {Record<string, number>} steps\n   * @param {number} [speedMult=1]\n   */\n  step(steps, speedMult = 1) {\n    each(steps, (step, name) => {\n      this.dynamics[name].step(step, speedMult);\n    });\n  }\n\n  /**\n   * Starts infinite movements\n   * @param {Record<string, boolean>} rolls\n   * @param {number} [speedMult=1]\n   */\n  roll(rolls, speedMult = 1) {\n    each(rolls, (roll, name) => {\n      this.dynamics[name].roll(roll, speedMult);\n    });\n  }\n\n  /**\n   * Stops movements\n   */\n  stop() {\n    each(this.dynamics, d => d.stop());\n  }\n\n  /**\n   * Defines the current positions and immediately stops movements\n   * @param {Record<string, number>} values\n   */\n  setValue(values) {\n    let hasUpdates = false;\n    each(values, (value, name) => {\n      hasUpdates |= this.dynamics[name].setValue(value);\n    });\n\n    if (hasUpdates && this.fn) {\n      this.fn(this.current);\n    }\n\n    return hasUpdates;\n  }\n\n  /**\n   * @package\n   */\n  update(elapsed) {\n    let hasUpdates = false;\n    each(this.dynamics, (dynamic) => {\n      hasUpdates |= dynamic.update(elapsed);\n    });\n\n    if (hasUpdates && this.fn) {\n      this.fn(this.current);\n    }\n\n    return hasUpdates;\n  }\n\n}\n","import * as THREE from 'three';\nimport { EventEmitter } from 'uevent';\nimport { Animation } from './Animation';\nimport { Loader } from './components/Loader';\nimport { Navbar } from './components/Navbar';\nimport { Notification } from './components/Notification';\nimport { Overlay } from './components/Overlay';\nimport { Panel } from './components/Panel';\nimport { CONFIG_PARSERS, DEFAULTS, DEPRECATED_OPTIONS, getConfig, READONLY_OPTIONS } from './data/config';\nimport { CHANGE_EVENTS, DEFAULT_TRANSITION, EVENTS, IDS, SPHERE_RADIUS, VIEWER_DATA } from './data/constants';\nimport { SYSTEM } from './data/system';\nimport errorIcon from './icons/error.svg';\nimport { AbstractPlugin } from './plugins/AbstractPlugin';\nimport { PSVError } from './PSVError';\nimport { DataHelper } from './services/DataHelper';\nimport { EventsHandler } from './services/EventsHandler';\nimport { Renderer } from './services/Renderer';\nimport { TextureLoader } from './services/TextureLoader';\nimport { TooltipRenderer } from './services/TooltipRenderer';\nimport {\n  each,\n  exitFullscreen,\n  getAbortError,\n  getAngle,\n  getShortestArc,\n  isAbortError,\n  isExtendedPosition,\n  isFullscreenEnabled,\n  logWarn,\n  pluginInterop,\n  requestFullscreen,\n  throttle,\n  toggleClass\n} from './utils';\nimport { Dynamic } from './utils/Dynamic';\nimport { MultiDynamic } from './utils/MultiDynamic';\n\nTHREE.Cache.enabled = true;\n\n/**\n * @summary Main class\n * @memberOf PSV\n * @extends {external:uEvent.EventEmitter}\n */\nexport class Viewer extends EventEmitter {\n\n  /**\n   * @param {PSV.Options} options\n   * @fires PSV.ready\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   */\n  constructor(options) {\n    super();\n\n    SYSTEM.load();\n\n    // must support WebGL\n    if (!SYSTEM.isWebGLSupported) {\n      throw new PSVError('WebGL is not supported.');\n    }\n\n    if (SYSTEM.maxTextureWidth === 0) {\n      throw new PSVError('Unable to detect system capabilities');\n    }\n\n    /**\n     * @summary Internal properties\n     * @member {Object}\n     * @protected\n     * @property {boolean} ready - when all components are loaded\n     * @property {boolean} uiRefresh - if the UI needs to be renderer\n     * @property {boolean} needsUpdate - if the view needs to be renderer\n     * @property {boolean} fullscreen - if the viewer is currently fullscreen\n     * @property {external:THREE.Vector3} direction - direction of the camera\n     * @property {number} vFov - vertical FOV\n     * @property {number} hFov - horizontal FOV\n     * @property {number} aspect - viewer aspect ratio\n     * @property {boolean} autorotateEnabled - automatic rotation is enabled\n     * @property {PSV.Animation} animationPromise - promise of the current animation\n     * @property {Promise} loadingPromise - promise of the setPanorama method\n     * @property startTimeout - timeout id of the automatic rotation delay\n     * @property {object} objectsObservers\n     * @property {PSV.Size} size - size of the container\n     * @property {PSV.PanoData} panoData - panorama metadata, if supported\n     */\n    this.prop = {\n      ready            : false,\n      uiRefresh        : false,\n      needsUpdate      : false,\n      fullscreen       : false,\n      direction        : new THREE.Vector3(0, 0, SPHERE_RADIUS),\n      vFov             : null,\n      hFov             : null,\n      aspect           : null,\n      autorotateEnabled: false,\n      animationPromise : null,\n      loadingPromise   : null,\n      startTimeout     : null,\n      objectsObservers : {},\n      size             : {\n        width : 0,\n        height: 0,\n      },\n      panoData         : {\n        fullWidth    : 0,\n        fullHeight   : 0,\n        croppedWidth : 0,\n        croppedHeight: 0,\n        croppedX     : 0,\n        croppedY     : 0,\n        poseHeading  : 0,\n        posePitch    : 0,\n        poseRoll     : 0,\n      },\n    };\n\n    /**\n     * @summary Configuration holder\n     * @type {PSV.Options}\n     * @readonly\n     */\n    this.config = getConfig(options);\n\n    /**\n     * @summary Top most parent\n     * @member {HTMLElement}\n     * @readonly\n     */\n    this.parent = (typeof options.container === 'string') ? document.getElementById(options.container) : options.container;\n    this.parent[VIEWER_DATA] = this;\n\n    /**\n     * @summary Main container\n     * @member {HTMLElement}\n     * @readonly\n     */\n    this.container = document.createElement('div');\n    this.container.classList.add('psv-container');\n    this.parent.appendChild(this.container);\n\n    /**\n     * @summary Render adapter\n     * @type {PSV.adapters.AbstractAdapter}\n     * @readonly\n     * @package\n     */\n    this.adapter = new this.config.adapter[0](this, this.config.adapter[1]); // eslint-disable-line new-cap\n\n    /**\n     * @summary All child components\n     * @type {PSV.components.AbstractComponent[]}\n     * @readonly\n     * @package\n     */\n    this.children = [];\n\n    /**\n     * @summary All plugins\n     * @type {Object<string, PSV.plugins.AbstractPlugin>}\n     * @readonly\n     * @package\n     */\n    this.plugins = {};\n\n    /**\n     * @type {PSV.services.Renderer}\n     * @readonly\n     */\n    this.renderer = new Renderer(this);\n\n    /**\n     * @type {PSV.services.TextureLoader}\n     * @readonly\n     */\n    this.textureLoader = new TextureLoader(this);\n\n    /**\n     * @type {PSV.services.EventsHandler}\n     * @readonly\n     */\n    this.eventsHandler = new EventsHandler(this);\n\n    /**\n     * @type {PSV.services.DataHelper}\n     * @readonly\n     */\n    this.dataHelper = new DataHelper(this);\n\n    /**\n     * @member {PSV.components.Loader}\n     * @readonly\n     */\n    this.loader = new Loader(this);\n\n    /**\n     * @member {PSV.components.Navbar}\n     * @readonly\n     */\n    this.navbar = new Navbar(this);\n\n    /**\n     * @member {PSV.components.Panel}\n     * @readonly\n     */\n    this.panel = new Panel(this);\n\n    /**\n     * @member {PSV.services.TooltipRenderer}\n     * @readonly\n     */\n    this.tooltip = new TooltipRenderer(this);\n\n    /**\n     * @member {PSV.components.Notification}\n     * @readonly\n     */\n    this.notification = new Notification(this);\n\n    /**\n     * @member {PSV.components.Overlay}\n     * @readonly\n     */\n    this.overlay = new Overlay(this);\n\n    /**\n     * @member {Record<string, PSV.Dynamic>}\n     * @package\n     */\n    this.dynamics = {\n      zoom: new Dynamic((value) => {\n        this.prop.vFov = this.dataHelper.zoomLevelToFov(value);\n        this.prop.hFov = this.dataHelper.vFovToHFov(this.prop.vFov);\n        this.trigger(EVENTS.ZOOM_UPDATED, value);\n      }, this.config.defaultZoomLvl, 0, 100),\n\n      position: new MultiDynamic({\n        longitude: new Dynamic(null, this.config.defaultLong),\n        latitude : new Dynamic(null, this.config.defaultLat, -Math.PI / 2, Math.PI / 2),\n      }, (position) => {\n        this.dataHelper.sphericalCoordsToVector3(position, this.prop.direction);\n        this.trigger(EVENTS.POSITION_UPDATED, this.dataHelper.cleanPosition(position));\n      }),\n    };\n\n    this.__updateSpeeds();\n\n    this.eventsHandler.init();\n\n    this.__resizeRefresh = throttle(() => this.refreshUi('resize'), 500);\n\n    // apply container size\n    this.resize(this.config.size);\n\n    // init plugins\n    this.config.plugins.forEach(([plugin, opts]) => {\n      this.plugins[plugin.id] = new plugin(this, opts); // eslint-disable-line new-cap\n    });\n    each(this.plugins, plugin => plugin.init?.());\n\n    // init buttons\n    this.navbar.setButtons(this.config.navbar);\n\n    // load panorama\n    if (this.config.panorama) {\n      this.setPanorama(this.config.panorama);\n    }\n\n    SYSTEM.isTouchEnabled.then(enabled => toggleClass(this.container, 'psv--is-touch', enabled));\n\n    // enable GUI after first render\n    this.once(EVENTS.RENDER, () => {\n      if (this.config.navbar) {\n        this.container.classList.add('psv--has-navbar');\n        this.navbar.show();\n      }\n\n      // Queue autorotate\n      if (this.config.autorotateDelay) {\n        this.prop.startTimeout = setTimeout(() => this.startAutorotate(), this.config.autorotateDelay);\n      }\n\n      this.prop.ready = true;\n\n      setTimeout(() => {\n        this.refreshUi('init');\n\n        this.trigger(EVENTS.READY);\n      }, 0);\n    });\n  }\n\n  /**\n   * @summary Destroys the viewer\n   * @description The memory used by the ThreeJS context is not totally cleared. This will be fixed as soon as possible.\n   */\n  destroy() {\n    this.__stopAll();\n    this.stopKeyboardControl();\n    this.exitFullscreen();\n\n    this.eventsHandler.destroy();\n    this.renderer.destroy();\n    this.textureLoader.destroy();\n    this.dataHelper.destroy();\n    this.adapter.destroy();\n\n    this.children.slice().forEach(child => child.destroy());\n    this.children.length = 0;\n\n    each(this.plugins, plugin => plugin.destroy());\n    delete this.plugins;\n\n    this.parent.removeChild(this.container);\n    delete this.parent[VIEWER_DATA];\n\n    delete this.parent;\n    delete this.container;\n\n    delete this.loader;\n    delete this.navbar;\n    delete this.panel;\n    delete this.tooltip;\n    delete this.notification;\n    delete this.overlay;\n\n    delete this.config;\n  }\n\n  /**\n   * @summary Refresh UI\n   * @package\n   */\n  refreshUi(reason) {\n    if (!this.prop.ready) {\n      return;\n    }\n\n    if (!this.prop.uiRefresh) {\n      // console.log(`PhotoSphereViewer: UI Refresh, ${reason}`);\n\n      this.prop.uiRefresh = true;\n\n      this.children.every((child) => {\n        child.refreshUi();\n        return this.prop.uiRefresh === true;\n      });\n\n      this.prop.uiRefresh = false;\n    }\n    else if (this.prop.uiRefresh !== 'new') {\n      this.prop.uiRefresh = 'new';\n\n      // wait for current refresh to cancel\n      setTimeout(() => {\n        this.prop.uiRefresh = false;\n        this.refreshUi(reason);\n      });\n    }\n  }\n\n  /**\n   * @summary Returns the instance of a plugin if it exists\n   * @param {Class<PSV.plugins.AbstractPlugin>|string} pluginId\n   * @returns {PSV.plugins.AbstractPlugin}\n   */\n  getPlugin(pluginId) {\n    if (typeof pluginId === 'string') {\n      return this.plugins[pluginId];\n    }\n    else {\n      const pluginCtor = pluginInterop(pluginId, AbstractPlugin);\n      return pluginCtor ? this.plugins[pluginCtor.id] : undefined;\n    }\n  }\n\n  /**\n   * @summary Returns the current position of the camera\n   * @returns {PSV.Position}\n   */\n  getPosition() {\n    return this.dataHelper.cleanPosition(this.dynamics.position.current);\n  }\n\n  /**\n   * @summary Returns the current zoom level\n   * @returns {number}\n   */\n  getZoomLevel() {\n    return this.dynamics.zoom.current;\n  }\n\n  /**\n   * @summary Returns the current viewer size\n   * @returns {PSV.Size}\n   */\n  getSize() {\n    return { ...this.prop.size };\n  }\n\n  /**\n   * @summary Checks if the automatic rotation is enabled\n   * @returns {boolean}\n   */\n  isAutorotateEnabled() {\n    return this.prop.autorotateEnabled;\n  }\n\n  /**\n   * @summary Checks if the viewer is in fullscreen\n   * @returns {boolean}\n   */\n  isFullscreenEnabled() {\n    if (SYSTEM.fullscreenEvent) {\n      return isFullscreenEnabled(this.container);\n    }\n    else {\n      return this.prop.fullscreen;\n    }\n  }\n\n  /**\n   * @summary Flags the view has changed for the next render\n   */\n  needsUpdate() {\n    this.prop.needsUpdate = true;\n  }\n\n  /**\n   * @summary Resizes the canvas when the window is resized\n   * @fires PSV.size-updated\n   */\n  autoSize() {\n    if (this.container.clientWidth !== this.prop.size.width || this.container.clientHeight !== this.prop.size.height) {\n      this.prop.size.width = Math.round(this.container.clientWidth);\n      this.prop.size.height = Math.round(this.container.clientHeight);\n      this.prop.aspect = this.prop.size.width / this.prop.size.height;\n      this.prop.hFov = this.dataHelper.vFovToHFov(this.prop.vFov);\n\n      this.trigger(EVENTS.SIZE_UPDATED, this.getSize());\n      this.__resizeRefresh();\n    }\n  }\n\n  /**\n   * @summary Loads a new panorama file\n   * @description Loads a new panorama file, optionally changing the camera position/zoom and activating the transition animation.<br>\n   * If the \"options\" parameter is not defined, the camera will not move and the ongoing animation will continue.<br>\n   * If another loading is already in progress it will be aborted.\n   * @param {*} path - URL of the new panorama file\n   * @param {PSV.PanoramaOptions} [options]\n   * @returns {Promise<boolean>} resolves false if the loading was aborted by another call\n   */\n  setPanorama(path, options = {}) {\n    this.textureLoader.abortLoading();\n    this.prop.transitionAnimation?.cancel();\n\n    // apply default parameters on first load\n    if (!this.prop.ready) {\n      if (!('sphereCorrection' in options)) {\n        options.sphereCorrection = this.config.sphereCorrection;\n      }\n      if (!('panoData' in options)) {\n        options.panoData = this.config.panoData;\n      }\n    }\n\n    if (options.transition === undefined || options.transition === true) {\n      options.transition = DEFAULT_TRANSITION;\n    }\n    if (options.showLoader === undefined) {\n      options.showLoader = true;\n    }\n    if (options.caption === undefined) {\n      options.caption = this.config.caption;\n    }\n\n    const positionProvided = isExtendedPosition(options);\n    const zoomProvided = 'zoom' in options;\n\n    if (positionProvided || zoomProvided) {\n      this.__stopAll();\n    }\n\n    this.hideError();\n\n    this.config.panorama = path;\n    this.config.caption = options.caption;\n\n    const done = (err) => {\n      this.loader.hide();\n\n      this.prop.loadingPromise = null;\n\n      if (isAbortError(err)) {\n        return false;\n      }\n      else if (err) {\n        this.navbar.setCaption('');\n        this.showError(this.config.lang.loadError);\n        console.error(err);\n        throw err;\n      }\n      else {\n        this.navbar.setCaption(this.config.caption);\n        return true;\n      }\n    };\n\n    this.navbar.setCaption(`<em>${this.config.loadingTxt || ''}</em>`);\n    if (options.showLoader || !this.prop.ready) {\n      this.loader.show();\n    }\n\n    const loadingPromise = this.adapter.loadTexture(this.config.panorama, options.panoData)\n      .then((textureData) => {\n        // check if another panorama was requested\n        if (textureData.panorama !== this.config.panorama) {\n          this.adapter.disposeTexture(textureData);\n          throw getAbortError();\n        }\n        return textureData;\n      });\n\n    if (!options.transition || !this.prop.ready || !this.adapter.supportsTransition(this.config.panorama)) {\n      this.prop.loadingPromise = loadingPromise\n        .then((textureData) => {\n          this.renderer.show();\n          this.renderer.setTexture(textureData);\n          this.renderer.setPanoramaPose(textureData.panoData);\n          this.renderer.setSphereCorrection(options.sphereCorrection);\n\n          if (zoomProvided) {\n            this.zoom(options.zoom);\n          }\n          if (positionProvided) {\n            this.rotate(options);\n          }\n        })\n        .then(done, done);\n    }\n    else {\n      this.prop.loadingPromise = loadingPromise\n        .then((textureData) => {\n          this.loader.hide();\n\n          this.prop.transitionAnimation = this.renderer.transition(textureData, options);\n          return this.prop.transitionAnimation\n            .then((completed) => {\n              this.prop.transitionAnimation = null;\n              if (!completed) {\n                throw getAbortError();\n              }\n            });\n        })\n        .then(done, done);\n    }\n\n    return this.prop.loadingPromise;\n  }\n\n  /**\n   * @summary Update options\n   * @param {PSV.Options} options\n   * @fires PSV.config-changed\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   */\n  setOptions(options) {\n    each(options, (value, key) => {\n      if (DEPRECATED_OPTIONS[key]) {\n        logWarn(DEPRECATED_OPTIONS[key]);\n        return;\n      }\n\n      if (!Object.prototype.hasOwnProperty.call(DEFAULTS, key)) {\n        throw new PSVError(`Unknown option ${key}`);\n      }\n\n      if (READONLY_OPTIONS[key]) {\n        throw new PSVError(READONLY_OPTIONS[key]);\n      }\n\n      if (CONFIG_PARSERS[key]) {\n        this.config[key] = CONFIG_PARSERS[key](value, options);\n      }\n      else {\n        this.config[key] = value;\n      }\n\n      switch (key) {\n        case 'caption':\n          this.navbar.setCaption(value);\n          break;\n\n        case 'size':\n          this.resize(value);\n          break;\n\n        case 'sphereCorrection':\n          this.renderer.setSphereCorrection(value);\n          break;\n\n        case 'navbar':\n        case 'lang':\n          this.navbar.setButtons(this.config.navbar);\n          break;\n\n        case 'moveSpeed':\n        case 'zoomSpeed':\n          this.__updateSpeeds();\n          break;\n\n        case 'minFov':\n        case 'maxFov':\n          this.dynamics.zoom.setValue(this.dataHelper.fovToZoomLevel(this.prop.vFov));\n          this.trigger(EVENTS.ZOOM_UPDATED, this.getZoomLevel());\n          break;\n\n        case 'canvasBackground':\n          this.renderer.canvasContainer.style.background = this.config.canvasBackground;\n          break;\n\n        default:\n          break;\n      }\n    });\n\n    this.needsUpdate();\n    this.refreshUi('set options');\n\n    this.trigger(EVENTS.CONFIG_CHANGED, Object.keys(options));\n  }\n\n  /**\n   * @summary Update options\n   * @param {string} option\n   * @param {any} value\n   * @fires PSV.config-changed\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   */\n  setOption(option, value) {\n    this.setOptions({ [option]: value });\n  }\n\n  /**\n   * @summary Starts the automatic rotation\n   * @fires PSV.autorotate\n   */\n  startAutorotate(refresh = false) {\n    if (refresh && !this.isAutorotateEnabled()) {\n      return;\n    }\n\n    if (!refresh) {\n      this.__stopAll();\n    }\n\n    this.dynamics.position.roll({\n      longitude: this.config.autorotateSpeed < 0,\n    }, Math.abs(this.config.autorotateSpeed / this.config.moveSpeed));\n\n    this.dynamics.position.goto({\n      latitude: this.config.autorotateLat,\n    }, Math.abs(this.config.autorotateSpeed / this.config.moveSpeed));\n\n    this.prop.autorotateEnabled = true;\n\n    if (!refresh) {\n      this.trigger(EVENTS.AUTOROTATE, true);\n    }\n  }\n\n  /**\n   * @summary Stops the automatic rotation\n   * @fires PSV.autorotate\n   */\n  stopAutorotate() {\n    if (this.prop.startTimeout) {\n      clearTimeout(this.prop.startTimeout);\n      this.prop.startTimeout = null;\n    }\n\n    if (this.isAutorotateEnabled()) {\n      this.dynamics.position.stop();\n\n      this.prop.autorotateEnabled = false;\n\n      this.trigger(EVENTS.AUTOROTATE, false);\n    }\n  }\n\n  /**\n   * @summary Starts or stops the automatic rotation\n   * @fires PSV.autorotate\n   */\n  toggleAutorotate() {\n    if (this.isAutorotateEnabled()) {\n      this.stopAutorotate();\n    }\n    else {\n      this.startAutorotate();\n    }\n  }\n\n  /**\n   * @summary Displays an error message over the viewer\n   * @param {string} message\n   */\n  showError(message) {\n    this.overlay.show({\n      id         : IDS.ERROR,\n      image      : errorIcon,\n      text       : message,\n      dissmisable: false,\n    });\n  }\n\n  /**\n   * @summary Hides the error message\n   */\n  hideError() {\n    this.overlay.hide(IDS.ERROR);\n  }\n\n  /**\n   * @summary Rotates the view to specific longitude and latitude\n   * @param {PSV.ExtendedPosition} position\n   * @fires PSV.before-rotate\n   * @fires PSV.position-updated\n   */\n  rotate(position) {\n    const e = this.trigger(EVENTS.BEFORE_ROTATE, position);\n    if (e.isDefaultPrevented()) {\n      return;\n    }\n\n    const cleanPosition = this.change(CHANGE_EVENTS.GET_ROTATE_POSITION, this.dataHelper.cleanPosition(position));\n    this.dynamics.position.setValue(cleanPosition);\n  }\n\n  /**\n   * @summary Rotates and zooms the view with a smooth animation\n   * @param {PSV.AnimateOptions} options - position and/or zoom level\n   * @returns {PSV.Animation}\n   */\n  animate(options) {\n    this.__stopAll();\n\n    const positionProvided = isExtendedPosition(options);\n    const zoomProvided = 'zoom' in options;\n\n    const animProperties = {};\n    let duration;\n\n    // clean/filter position and compute duration\n    if (positionProvided) {\n      const cleanPosition = this.change(CHANGE_EVENTS.GET_ANIMATE_POSITION, this.dataHelper.cleanPosition(options));\n      const currentPosition = this.getPosition();\n\n      // longitude offset for shortest arc\n      const tOffset = getShortestArc(currentPosition.longitude, cleanPosition.longitude);\n\n      animProperties.longitude = { start: currentPosition.longitude, end: currentPosition.longitude + tOffset };\n      animProperties.latitude = { start: currentPosition.latitude, end: cleanPosition.latitude };\n\n      duration = this.dataHelper.speedToDuration(options.speed, getAngle(currentPosition, cleanPosition));\n    }\n\n    // clean/filter zoom and compute duration\n    if (zoomProvided) {\n      const dZoom = Math.abs(options.zoom - this.getZoomLevel());\n\n      animProperties.zoom = { start: this.getZoomLevel(), end: options.zoom };\n\n      if (!duration) {\n        // if animating zoom only and a speed is given, use an arbitrary PI/4 to compute the duration\n        duration = this.dataHelper.speedToDuration(options.speed, Math.PI / 4 * dZoom / 100);\n      }\n    }\n\n    // if no animation needed\n    if (!duration) {\n      if (positionProvided) {\n        this.rotate(options);\n      }\n      if (zoomProvided) {\n        this.zoom(options.zoom);\n      }\n\n      return new Animation();\n    }\n\n    this.prop.animationPromise = new Animation({\n      properties: animProperties,\n      duration  : duration,\n      easing    : 'inOutSine',\n      onTick    : (properties) => {\n        if (positionProvided) {\n          this.rotate(properties);\n        }\n        if (zoomProvided) {\n          this.zoom(properties.zoom);\n        }\n      },\n    });\n\n    return this.prop.animationPromise;\n  }\n\n  /**\n   * @summary Stops the ongoing animation\n   * @description The return value is a Promise because the is no guaranty the animation can be stopped synchronously.\n   * @returns {Promise} Resolved when the animation has ben cancelled\n   */\n  stopAnimation() {\n    if (this.prop.animationPromise) {\n      return new Promise((resolve) => {\n        this.prop.animationPromise.then(resolve);\n        this.prop.animationPromise.cancel();\n        this.prop.animationPromise = null;\n      });\n    }\n    else {\n      return Promise.resolve();\n    }\n  }\n\n  /**\n   * @summary Zooms to a specific level between `max_fov` and `min_fov`\n   * @param {number} level - new zoom level from 0 to 100\n   * @fires PSV.zoom-updated\n   */\n  zoom(level) {\n    this.dynamics.zoom.setValue(level);\n  }\n\n  /**\n   * @summary Increases the zoom level\n   * @param {number} [step=1]\n   */\n  zoomIn(step = 1) {\n    this.dynamics.zoom.step(step);\n  }\n\n  /**\n   * @summary Decreases the zoom level\n   * @param {number} [step=1]\n   */\n  zoomOut(step = 1) {\n    this.dynamics.zoom.step(-step);\n  }\n\n  /**\n   * @summary Resizes the viewer\n   * @param {PSV.CssSize} size\n   */\n  resize(size) {\n    ['width', 'height'].forEach((dim) => {\n      if (size && size[dim]) {\n        if (/^[0-9.]+$/.test(size[dim])) {\n          size[dim] += 'px';\n        }\n        this.parent.style[dim] = size[dim];\n      }\n    });\n\n    this.autoSize();\n  }\n\n  /**\n   * @summary Enters the fullscreen mode\n   * @fires PSV.fullscreen-updated\n   */\n  enterFullscreen() {\n    if (SYSTEM.fullscreenEvent) {\n      requestFullscreen(this.container);\n    }\n    else {\n      this.container.classList.add('psv-container--fullscreen');\n      this.autoSize();\n      this.eventsHandler.__fullscreenToggled(true);\n    }\n  }\n\n  /**\n   * @summary Exits the fullscreen mode\n   * @fires PSV.fullscreen-updated\n   */\n  exitFullscreen() {\n    if (this.isFullscreenEnabled()) {\n      if (SYSTEM.fullscreenEvent) {\n        exitFullscreen();\n      }\n      else {\n        this.container.classList.remove('psv-container--fullscreen');\n        this.autoSize();\n        this.eventsHandler.__fullscreenToggled(false);\n      }\n    }\n  }\n\n  /**\n   * @summary Enters or exits the fullscreen mode\n   * @fires PSV.fullscreen-updated\n   */\n  toggleFullscreen() {\n    if (!this.isFullscreenEnabled()) {\n      this.enterFullscreen();\n    }\n    else {\n      this.exitFullscreen();\n    }\n  }\n\n  /**\n   * @summary Enables the keyboard controls (done automatically when entering fullscreen)\n   */\n  startKeyboardControl() {\n    this.eventsHandler.enableKeyboard();\n  }\n\n  /**\n   * @summary Disables the keyboard controls (done automatically when exiting fullscreen)\n   */\n  stopKeyboardControl() {\n    this.eventsHandler.disableKeyboard();\n  }\n\n  /**\n   * @summary Subscribes to events on objects in the scene\n   * @param {string} userDataKey - only objects with the following `userData` will be emitted\n   * @param {EventListener} listener - must implement `handleEvent\n   * @return {function} call to stop the subscription\n   * @package\n   */\n  observeObjects(userDataKey, listener) {\n    this.prop.objectsObservers[userDataKey] = { listener };\n\n    return () => {\n      delete this.prop.objectsObservers[userDataKey];\n    };\n  }\n\n  /**\n   * @summary Stops all current animations\n   * @package\n   */\n  __stopAll() {\n    this.stopAutorotate();\n    this.stopAnimation();\n\n    this.trigger(EVENTS.STOP_ALL);\n  }\n\n  /**\n   * @summary Recomputes dynamics speeds\n   * @private\n   */\n  __updateSpeeds() {\n    this.dynamics.zoom.setSpeed(this.config.zoomSpeed * 50);\n    this.dynamics.position.setSpeed(THREE.Math.degToRad(this.config.moveSpeed * 50));\n  }\n\n}\n"],"names":["DEFAULT_TRANSITION","MOVE_THRESHOLD","DBLCLICK_DELAY","LONGTOUCH_DELAY","TWOFINGERSOVERLAY_DELAY","CTRLZOOM_TIMEOUT","INERTIA_WINDOW","SPHERE_RADIUS","VIEWER_DATA","MESH_USER_DATA","ACTIONS","ROTATE_LAT_UP","ROTATE_LAT_DOWN","ROTATE_LONG_RIGHT","ROTATE_LONG_LEFT","ZOOM_IN","ZOOM_OUT","TOGGLE_AUTOROTATE","EVENTS","AUTOROTATE","BEFORE_RENDER","BEFORE_ROTATE","CLICK","CLOSE_PANEL","CONFIG_CHANGED","DOUBLE_CLICK","FULLSCREEN_UPDATED","HIDE_NOTIFICATION","HIDE_OVERLAY","HIDE_TOOLTIP","LOAD_PROGRESS","OPEN_PANEL","PANORAMA_LOADED","POSITION_UPDATED","READY","RENDER","SHOW_NOTIFICATION","SHOW_OVERLAY","SHOW_TOOLTIP","SIZE_UPDATED","STOP_ALL","ZOOM_UPDATED","CHANGE_EVENTS","GET_ANIMATE_POSITION","GET_ROTATE_POSITION","OBJECT_EVENTS","ENTER_OBJECT","HOVER_OBJECT","LEAVE_OBJECT","IDS","MENU","TWO_FINGERS","CTRL_ZOOM","ERROR","EASINGS","linear","t","inQuad","outQuad","inOutQuad","inCubic","outCubic","inOutCubic","inQuart","outQuart","inOutQuart","inQuint","outQuint","inOutQuint","inSine","Math","cos","PI","outSine","sin","inOutSine","inExpo","pow","outExpo","inOutExpo","inCirc","sqrt","outCirc","inOutCirc","KEY_CODES","Enter","Control","Escape","Space","PageUp","PageDown","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Delete","Plus","Minus","toggleClass","element","className","active","classList","currentClassName","getAttribute","currentActive","indexOf","regex","RegExp","undefined","length","replace","setAttribute","toggle","contains","add","remove","addClasses","split","forEach","name","removeClasses","hasParent","el","parent","test","parentNode","getClosest","selector","matches","msMatchesSelector","bind","SVGElement","parentElement","getPosition","left","top","offsetLeft","scrollLeft","clientLeft","offsetTop","scrollTop","clientTop","offsetParent","KEYMAP","MS_KEYMAP","Add","Del","Down","Esc","Left","Right","Spacebar","Subtract","Up","getEventKey","evt","key","keyCode","which","isFullscreenEnabled","elt","document","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","call","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","getStyle","prop","window","getComputedStyle","normalizeWheel","event","PIXEL_STEP","LINE_HEIGHT","PAGE_HEIGHT","spinX","spinY","pixelX","pixelY","detail","wheelDelta","wheelDeltaY","wheelDeltaX","axis","HORIZONTAL_AXIS","deltaY","deltaX","deltaMode","bound","x","min","max","isInteger","value","Number","isFinite","floor","isPowerOfTwo","log","sum","array","reduce","a","b","distance","p1","p2","y","getShortestArc","from","to","tCandidates","candidate","newCandidate","abs","Infinity","getAngle","position1","position2","acos","latitude","longitude","greatArcDistance","λ1","φ1","λ2","φ2","dasherize","str","s","i","toLowerCase","throttle","func","wait","self","args","result","timeout","previous","later","Date","now","apply","remaining","arguments","clearTimeout","setTimeout","isPlainObject","obj","Object","getPrototypeOf","proto","prototype","toString","deepmerge","target","src","first","merge","Array","isArray","e","keys","clone","isEmpty","constructor","each","object","callback","isNil","val","firstNonNull","values","PSVError","message","Error","captureStackTrace","stack","create","pluginInterop","plugin","entries","p","getAbortError","error","isAbortError","err","logWarn","console","warn","isExtendedPosition","some","key1","key2","getXMPValue","data","attr","match","parseInt","isNaN","CSS_POSITIONS","bottom","right","center","parsePosition","tokens","toLocaleLowerCase","slice","xFirst","map","token","reverse","parsed","join","parseFloat","LEFT_MAP","TOP_MAP","cleanPosition","defaultValue","allowCenter","tempPos","parseSpeed","speed","speedStr","trim","speedValue","speedUnit","THREE","degToRad","parseAngle","angle","zeroCenter","halfCircle","unit","createTexture","img","texture","Texture","needsUpdate","minFilter","LinearFilter","generateMipmaps","quaternion","Quaternion","applyEulerInverse","vector","euler","setFromEuler","invert","applyQuaternion","Animation","options","__callbacks","easing","__start","delay","__delayTimeout","__animationFrame","requestAnimationFrame","__run","__resolved","timestamp","progress","duration","current","properties","start","end","onTick","__resolve","cb","then","onFulfilled","onRejected","__cancelled","Promise","resolve","push","cancel","cancelAnimationFrame","catch","finally","onFinally","AbstractComponent","psv","children","visible","container","createElement","appendChild","destroy","removeChild","childIdx","splice","child","refreshUi","every","uiRefresh","isVisible","hide","show","style","display","AbstractButton","navbar","collapsable","tabbable","id","enabled","supported","collapsed","width","offsetWidth","icon","__setIcon","config","lang","title","tabIndex","addEventListener","onClick","stopPropagation","checkSupported","supportedOrObject","isSupported","initial","promise","toggleActive","iconActive","refresh","disable","enable","collapse","uncollapse","innerHTML","querySelector","AutorotateButton","on","off","handleEvent","type","toggleAutorotate","play","playActive","CustomButton","random","substr","content","DownloadButton","adapter","supportsDownload","downloadUrl","link","href","panorama","download","pop","click","FullscreenButton","toggleFullscreen","fullscreenIn","fullscreenOut","MenuButton","__hideMenu","__showMenu","panel","MENU_TEMPLATE","BUTTON_DATA","noMargin","clickHandler","li","buttonId","dataset","getButton","menuIcon","buttons","dataKey","menu","button","SYSTEM","loaded","pixelRatio","isWebGLSupported","isTouchEnabled","maxTextureWidth","mouseWheelEvent","fullscreenEvent","load","ctx","getWebGLCtx","devicePixelRatio","getMaxTextureWidth","getMouseWheelEvent","getFullscreenEvent","maxCanvasWidth","getMaxCanvasWidth","canvas","names","context","getContext","listener","removeEventListener","getParameter","MAX_TEXTURE_SIZE","maxWidth","height","fillStyle","fillRect","getImageData","onmousewheel","FULLSCREEN_EVT_MAP","validExits","filter","exit","PressHandler","time","down","getTime","up","elapsed","getOrientedArrow","direction","arrow","AbstractMoveButton","move","handler","__onMouseUp","__onMouseDown","__stopAll","dynamics","position","roll","stop","MoveDownButton","MoveLeftButton","MoveRightButton","MoveUpButton","AbstractZoomButton","zoom","ZoomInButton","zoomIn","ZoomOutButton","zoomOut","ZoomRangeButton","mousedown","mediaMinWidth","zoomRange","zoomValue","ready","__moveZoomValue","getZoomLevel","once","__stopZoomChange","__initZoomChangeWithMouse","__initZoomChangeByTouch","__changeZoomWithMouse","__changeZoomByTouch","size","level","__changeZoom","clientX","changedTouches","buttondown","preventDefault","userInput","getBoundingClientRect","zoomLevel","AbstractAdapter","supportsTransition","supportsPreload","loadTexture","newPanoData","createMesh","scale","setTexture","mesh","textureData","transition","setTextureOpacity","opacity","disposeTexture","EquirectangularAdapter","resolution","SPHERE_SEGMENTS","SPHERE_HORIZONTAL_SEGMENTS","reject","useXmpData","textureLoader","loadImage","loader","setProgress","xmpPanoData","__loadXMP","panoData","fullWidth","fullHeight","croppedWidth","croppedHeight","croppedX","croppedY","poseHeading","posePitch","poseRoll","__createEquirectangularTexture","onProgress","loadFile","blob","__loadBlobAsString","binary","substring","reader","FileReader","onload","onerror","readAsText","ratio","resizedPanoData","buffer","drawImage","geometry","SphereGeometry","material","MeshBasicMaterial","Mesh","dispose","transparent","AbstractPlugin","init","EventEmitter","DEFAULTS","plugins","caption","loadingImg","loadingTxt","fisheye","minFov","maxFov","defaultZoomLvl","defaultLong","defaultLat","sphereCorrection","moveSpeed","zoomSpeed","autorotateDelay","autorotateSpeed","autorotateLat","moveInertia","mousewheel","mousemove","captureCursor","mousewheelCtrlKey","touchmoveTwoFingers","requestHeaders","canvasBackground","withCredentials","autorotate","fullscreen","twoFingers","ctrlZoom","loadError","keyboard","READONLY_OPTIONS","DEPRECATED_OPTIONS","zoomButtonIncrement","mousewheelSpeed","sphereCorrectionReorder","CONFIG_PARSERS","getConfig","tempConfig","hasOwnProperty","CaptionButton","notification","info","NavbarCaption","contentVisible","contentWidth","setCaption","html","availableWidth","AVAILABLE_BUTTONS","registerButton","defaultPosition","unshift","pos","Navbar","setButtons","item","__cleanButtons","warnNotFound","totalWidth","visibleButtons","collapsableButtons","Loader","clientWidth","tickness","lastChild","inner","round","maxHeight","clearRect","lineWidth","strokeStyle","beginPath","arc","stroke","trigger","Notification","Overlay","contentId","dissmisable","image","text","subtext","PANEL_MIN_WIDTH","Panel","mouseX","mouseY","keyHandler","resizer","closeBtn","__onTouchStart","__onMouseMove","__onTouchMove","wasVisible","focus","__startResize","__resize","touches","clientY","AbstractService","vector2","Vector2","vector3","Vector3","eulerZero","Euler","DataHelper","fovToZoomLevel","fov","temp","zoomLevelToFov","vFovToHFov","vFov","radToDeg","atan","tan","aspect","speedToDuration","textureCoordsToSphericalCoords","point","relativeX","relativeY","equals","renderer","rotation","meshContainer","sphericalCoordsToVector3","applyEuler","vector3ToSphericalCoords","sphericalCoordsToTextureCoords","relativeLong","relativeLat","z","phi","theta","atan2","viewerCoordsToVector3","viewerPoint","sphereIntersect","getIntersections","userData","vector3ToViewerCoords","vectorClone","project","camera","sphericalCoordsToViewerCoords","raycaster","setFromCamera","intersectObjects","scene","cleanSphereCorrection","pan","tilt","cleanPanoramaPose","EventsHandler","state","moveThreshold","keyboardEnabled","moving","zooming","startMouseX","startMouseY","mouseHistory","pinchDist","ctrlKeyDown","dblclickData","dblclickTimeout","longtouchTimeout","twofingersTimeout","ctrlZoomTimeout","__onResize","autoSize","__onKeyDown","__onKeyUp","__onTouchEnd","__fullscreenToggled","__onMouseEnter","__onMouseLeave","__onMouseWheel","enableKeyboard","disableKeyboard","overlay","__startMove","__stopMove","__move","__moveAbsolute","objectsObservers","viewerPos","intersections","dataHelper","emit","observer","CustomEvent","originalEvent","intersection","find","__click","__cancelLongTouch","__cancelTwoFingersOverlay","__startMoveZoom","__stopMoveZoom","gestureIcon","__moveZoom","mousewheelIcon","delta","step","force","startKeyboardControl","stopKeyboardControl","stopAutorotate","stopAnimation","__logMouseMove","__stopMoveInertia","norm","animationPromise","longtouch","boundingRect","rightclick","viewerX","viewerY","sphereIntersection","psvSphere","sphericalCoords","objects","o","textureCoords","textureX","textureY","NaN","hFov","currentPosition","rotate","containerRect","goto","Renderer","WebGLRenderer","alpha","antialias","setPixelRatio","domElement","Scene","PerspectiveCamera","Group","Raycaster","canvasContainer","background","cursor","setAnimationLoop","__cleanTHREEScene","__onSizeUpdated","__onZoomUpdated","__onPositionUpdated","setSize","updateProjectionMatrix","set","lookAt","copy","multiplyScalar","negate","__renderLoop","d","update","render","setPanoramaPose","cleanCorrection","setSphereCorrection","positionProvided","zoomProvided","group","verticalAxis","rotateOnWorldAxis","horizontalAxis","cross","getWorldDirection","normalize","animation","completed","traverse","TextureLoader","FileLoader","setResponseType","setWithCredentials","setRequestHeader","abortLoading","url","lengthComputable","newProgress","total","createElementNS","URL","revokeObjectURL","createObjectURL","preloadPanorama","STATE","NONE","SHOWING","HIDING","Tooltip","__onTransitionEnd","rect","posClass","arrowTop","arrowLeft","__computeTooltipPosition","offset","newPos","propertyName","topBottom","box","TooltipRenderer","testTooltip","tooltip","Dynamic","fn","mode","STOP","speedMult","currentSpeed","setSpeed","POSITION","INFINITE","setValue","next","dstStop","targetSpeed","MultiDynamic","positions","steps","rolls","hasUpdates","dynamic","Cache","Viewer","autorotateEnabled","loadingPromise","startTimeout","getElementById","eventsHandler","__updateSpeeds","__resizeRefresh","resize","opts","setPanorama","startAutorotate","reason","getPlugin","pluginId","pluginCtor","getSize","isAutorotateEnabled","clientHeight","path","transitionAnimation","showLoader","hideError","done","showError","setOptions","setOption","option","errorIcon","isDefaultPrevented","change","animate","animProperties","tOffset","dZoom","dim","enterFullscreen","observeObjects","userDataKey"],"mappings":"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"}