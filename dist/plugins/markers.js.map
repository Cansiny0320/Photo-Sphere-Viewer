{"version":3,"file":"markers.js","sources":["../../src/plugins/markers/constants.js","../../src/utils/math.js","../../src/PSVError.js","../../src/utils/psv.js","../../src/plugins/markers/utils.js","../../src/plugins/markers/Marker.js","../../src/plugins/markers/MarkersButton.js","../../src/plugins/markers/MarkersListButton.js","../../src/plugins/markers/index.js"],"sourcesContent":["import icon from './pin-list.svg';\n\n/**\n * @summary Available events\n * @enum {string}\n * @memberof PSV.plugins.MarkersPlugin\n * @constant\n */\nexport const EVENTS = {\n  /**\n   * @event goto-marker-done\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the animation to a marker is done\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   */\n  GOTO_MARKER_DONE   : 'goto-marker-done',\n  /**\n   * @event leave-marker\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the user puts the cursor away from a marker\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   */\n  LEAVE_MARKER       : 'leave-marker',\n  /**\n   * @event over-marker\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the user puts the cursor hover a marker\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   */\n  OVER_MARKER        : 'over-marker',\n  /**\n   * @event filter:render-markers-list\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Used to alter the list of markers displayed on the side-panel\n   * @param {PSV.plugins.MarkersPlugin.Marker[]} markers\n   * @returns {PSV.plugins.MarkersPlugin.Marker[]}\n   */\n  RENDER_MARKERS_LIST: 'render-markers-list',\n  /**\n   * @event select-marker\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the user clicks on a marker. The marker can be retrieved from outside the event handler\n   * with {@link PSV.plugins.MarkersPlugin.getCurrentMarker}\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @param {PSV.plugins.MarkersPlugin.SelectMarkerData} data\n   */\n  SELECT_MARKER      : 'select-marker',\n  /**\n   * @event select-marker-list\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when a marker is selected from the side panel\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   */\n  SELECT_MARKER_LIST : 'select-marker-list',\n  /**\n   * @event unselect-marker\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when a marker was selected and the user clicks elsewhere\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   */\n  UNSELECT_MARKER    : 'unselect-marker',\n  /**\n   * @event hide-markers\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the markers are hidden\n   */\n  HIDE_MARKERS       : 'hide-markers',\n  /**\n   * @event set-marker\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the list of markers changes\n   * @param {PSV.plugins.MarkersPlugin.Marker[]} markers\n   */\n  SET_MARKERS        : 'set-markers',\n  /**\n   * @event show-markers\n   * @memberof PSV.plugins.MarkersPlugin\n   * @summary Triggered when the markers are shown\n   */\n  SHOW_MARKERS       : 'show-markers',\n};\n\n/**\n * @summary Namespace for SVG creation\n * @type {string}\n * @constant\n * @private\n */\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\n\n/**\n * @summary Property name added to marker elements\n * @type {string}\n * @constant\n * @private\n */\nexport const MARKER_DATA = 'psvMarker';\n\n/**\n * @summary Panel identifier for marker content\n * @type {string}\n * @constant\n * @private\n */\nexport const ID_PANEL_MARKER = 'marker';\n\n/**\n * @summary Panel identifier for markers list\n * @type {string}\n * @constant\n * @private\n */\nexport const ID_PANEL_MARKERS_LIST = 'markersList';\n\n/**\n * @summary Markers list template\n * @param {PSV.plugins.MarkersPlugin.Marker[]} markers\n * @param {string} title\n * @param {string} dataKey\n * @returns {string}\n * @constant\n * @private\n */\nexport const MARKERS_LIST_TEMPLATE = (markers, title, dataKey) => `\n<div class=\"psv-panel-menu psv-panel-menu--stripped\">\n  <h1 class=\"psv-panel-menu-title\">${icon} ${title}</h1>\n  <ul class=\"psv-panel-menu-list\">\n    ${markers.map(marker => `\n    <li data-${dataKey}=\"${marker.config.id}\" class=\"psv-panel-menu-item\" tabindex=\"0\">\n      ${marker.type === 'image' ? `<span class=\"psv-panel-menu-item-icon\"><img src=\"${marker.config.image}\"/></span>` : ''}\n      <span class=\"psv-panel-menu-item-label\">${marker.getListContent()}</span>\n    </li>\n    `).join('')}\n  </ul>\n</div>\n`;\n","/**\n * @summary Ensures that a number is in a given interval\n * @memberOf PSV.utils\n * @param {number} x\n * @param {number} min\n * @param {number} max\n * @returns {number}\n */\nexport function bound(x, min, max) {\n  return Math.max(min, Math.min(max, x));\n}\n\n/**\n * @summary Checks if a value is an integer\n * @memberOf PSV.utils\n * @param {*} value\n * @returns {boolean}\n */\nexport function isInteger(value) {\n  if (Number.isInteger) {\n    return Number.isInteger(value);\n  }\n  return typeof value === 'number' && Number.isFinite(value) && Math.floor(value) === value;\n}\n\n\n/**\n * @summary Computes the sum of an array\n * @memberOf PSV.utils\n * @param {number[]} array\n * @returns {number}\n */\nexport function sum(array) {\n  return array.reduce((a, b) => a + b, 0);\n}\n\n/**\n * @summary Computes the distance between two points\n * @memberOf PSV.utils\n * @param {PSV.Point} p1\n * @param {PSV.Point} p2\n * @returns {number}\n */\nexport function distance(p1, p2) {\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\n}\n\n/**\n * @summary Compute the shortest offset between two longitudes\n * @memberOf PSV.utils\n * @param {number} from\n * @param {number} to\n * @returns {number}\n */\nexport function getShortestArc(from, to) {\n  const tCandidates = [\n    0, // direct\n    Math.PI * 2, // clock-wise cross zero\n    -Math.PI * 2, // counter-clock-wise cross zero\n  ];\n\n  return tCandidates.reduce((value, candidate) => {\n    const newCandidate = to - from + candidate;\n    return Math.abs(newCandidate) < Math.abs(value) ? newCandidate : value;\n  }, Infinity);\n}\n\n/**\n * @summary Computes the angle between the current position and a target position\n * @memberOf PSV.utils\n * @param {PSV.Position} position1\n * @param {PSV.Position} position2\n * @returns {number}\n */\nexport function getAngle(position1, position2) {\n  return Math.acos(\n    Math.cos(position1.latitude)\n    * Math.cos(position2.latitude)\n    * Math.cos(position1.longitude - position2.longitude)\n    + Math.sin(position1.latitude)\n    * Math.sin(position2.latitude)\n  );\n}\n\n/**\n * @summary Returns the distance between two points on a sphere of radius one\n * {@link http://www.movable-type.co.uk/scripts/latlong.html}\n * @memberOf PSV.utils\n * @param {number[]} p1\n * @param {number[]} p2\n * @returns {number}\n */\nexport function greatArcDistance(p1, p2) {\n  const [λ1, φ1] = p1;\n  const [λ2, φ2] = p2;\n\n  const x = (λ2 - λ1) * Math.cos((φ1 + φ2) / 2);\n  const y = (φ2 - φ1);\n  return Math.sqrt(x * x + y * y);\n}\n","/**\n * @summary Custom error used in the lib\n * @param {string} message\n * @constructor\n * @memberOf PSV\n */\nfunction PSVError(message) {\n  this.message = message;\n\n  // Use V8's native method if available, otherwise fallback\n  if ('captureStackTrace' in Error) {\n    Error.captureStackTrace(this, PSVError);\n  }\n  else {\n    this.stack = (new Error()).stack;\n  }\n}\n\nPSVError.prototype = Object.create(Error.prototype);\nPSVError.prototype.name = 'PSVError';\nPSVError.prototype.constructor = PSVError;\n\nexport { PSVError };\n","import * as THREE from 'three';\nimport { PSVError } from '../PSVError';\nimport { bound } from './math';\n\n/**\n * @summary Returns the plugin constructor from the imported object\n * For retrocompatibility with previous default exports\n * @memberOf PSV.utils\n * @package\n */\nexport function pluginInterop(plugin, target) {\n  if (plugin) {\n    for (const [, p] of [['_', plugin], ...Object.entries(plugin)]) {\n      if (p.prototype instanceof target) {\n        return p;\n      }\n    }\n  }\n  return null;\n}\n\n/**\n * @summary Builds an Error with name 'AbortError'\n * @return {Error}\n */\nexport function getAbortError() {\n  const error = new Error('Loading was aborted.');\n  error.name = 'AbortError';\n  return error;\n}\n\n/**\n * @summary Tests if an Error has name 'AbortError'\n * @param {Error} err\n * @return {boolean}\n */\nexport function isAbortError(err) {\n  return err?.name === 'AbortError';\n}\n\n/**\n * @summary Displays a warning in the console\n * @memberOf PSV.utils\n * @param {string} message\n */\nexport function logWarn(message) {\n  console.warn(`PhotoSphereViewer: ${message}`);\n}\n\n/**\n * @summary Checks if an object is a {PSV.ExtendedPosition}, ie has x/y or longitude/latitude\n * @memberOf PSV.utils\n * @param {object} object\n * @returns {boolean}\n */\nexport function isExtendedPosition(object) {\n  return [['x', 'y'], ['longitude', 'latitude']].some(([key1, key2]) => {\n    return object[key1] !== undefined && object[key2] !== undefined;\n  });\n}\n\n/**\n * @summary Returns the value of a given attribute in the panorama metadata\n * @memberOf PSV.utils\n * @param {string} data\n * @param {string} attr\n * @returns (number)\n */\nexport function getXMPValue(data, attr) {\n  // XMP data are stored in children\n  let result = data.match('<GPano:' + attr + '>(.*)</GPano:' + attr + '>');\n  if (result !== null) {\n    const val = parseInt(result[1], 10);\n    return isNaN(val) ? null : val;\n  }\n\n  // XMP data are stored in attributes\n  result = data.match('GPano:' + attr + '=\"(.*?)\"');\n  if (result !== null) {\n    const val = parseInt(result[1], 10);\n    return isNaN(val) ? null : val;\n  }\n\n  return null;\n}\n\n/**\n * @readonly\n * @private\n * @type {{top: string, left: string, bottom: string, center: string, right: string}}\n */\nconst CSS_POSITIONS = {\n  top   : '0%',\n  bottom: '100%',\n  left  : '0%',\n  right : '100%',\n  center: '50%',\n};\n\n/**\n * @summary Translate CSS values like \"top center\" or \"10% 50%\" as top and left positions\n * @memberOf PSV.utils\n * @description The implementation is as close as possible to the \"background-position\" specification\n * {@link https://developer.mozilla.org/en-US/docs/Web/CSS/background-position}\n * @param {string|PSV.Point} value\n * @returns {PSV.Point}\n */\nexport function parsePosition(value) {\n  if (!value) {\n    return { x: 0.5, y: 0.5 };\n  }\n\n  if (typeof value === 'object') {\n    return value;\n  }\n\n  let tokens = value.toLocaleLowerCase().split(' ').slice(0, 2);\n\n  if (tokens.length === 1) {\n    if (CSS_POSITIONS[tokens[0]] !== undefined) {\n      tokens = [tokens[0], 'center'];\n    }\n    else {\n      tokens = [tokens[0], tokens[0]];\n    }\n  }\n\n  const xFirst = tokens[1] !== 'left' && tokens[1] !== 'right' && tokens[0] !== 'top' && tokens[0] !== 'bottom';\n\n  tokens = tokens.map(token => CSS_POSITIONS[token] || token);\n\n  if (!xFirst) {\n    tokens.reverse();\n  }\n\n  const parsed = tokens.join(' ').match(/^([0-9.]+)% ([0-9.]+)%$/);\n\n  if (parsed) {\n    return {\n      x: parseFloat(parsed[1]) / 100,\n      y: parseFloat(parsed[2]) / 100,\n    };\n  }\n  else {\n    return { x: 0.5, y: 0.5 };\n  }\n}\n\n/**\n * @readonly\n * @private\n */\nconst LEFT_MAP = { 0: 'left', 0.5: 'center', 1: 'right' };\n/**\n * @readonly\n * @private\n */\nconst TOP_MAP = { 0: 'top', 0.5: 'center', 1: 'bottom' };\n\n/**\n * @summary Parse a CSS-like position into an array of position keywords among top, bottom, left, right and center\n * @memberOf PSV.utils\n * @param {string | string[]} value\n * @param {string} defaultValue\n * @param {boolean} [allowCenter=true]\n * @return {string[]}\n */\nexport function cleanPosition(value, defaultValue, allowCenter = true) {\n  if (!value) {\n    return defaultValue.split(' ');\n  }\n\n  if (typeof value === 'string') {\n    const tempPos = parsePosition(value);\n\n    if (!(tempPos.x in LEFT_MAP) || !(tempPos.y in TOP_MAP)) {\n      throw new PSVError(`Unable to parse position \"${value}\"`);\n    }\n\n    value = [TOP_MAP[tempPos.y], LEFT_MAP[tempPos.x]];\n  }\n\n  if (!allowCenter && value[0] === 'center' && value[1] === 'center') {\n    throw new PSVError('Unable to parse position \"center center\"');\n  }\n\n  return value;\n}\n\n/**\n * @summary Parses an speed\n * @memberOf PSV.utils\n * @param {string|number} speed - The speed, in radians/degrees/revolutions per second/minute\n * @returns {number} radians per second\n * @throws {PSV.PSVError} when the speed cannot be parsed\n */\nexport function parseSpeed(speed) {\n  let parsed;\n\n  if (typeof speed === 'string') {\n    const speedStr = speed.toString().trim();\n\n    // Speed extraction\n    let speedValue = parseFloat(speedStr.replace(/^(-?[0-9]+(?:\\.[0-9]*)?).*$/, '$1'));\n    const speedUnit = speedStr.replace(/^-?[0-9]+(?:\\.[0-9]*)?(.*)$/, '$1').trim();\n\n    // \"per minute\" -> \"per second\"\n    if (speedUnit.match(/(pm|per minute)$/)) {\n      speedValue /= 60;\n    }\n\n    // Which unit?\n    switch (speedUnit) {\n      // Degrees per minute / second\n      case 'dpm':\n      case 'degrees per minute':\n      case 'dps':\n      case 'degrees per second':\n        parsed = THREE.Math.degToRad(speedValue);\n        break;\n\n      // Radians per minute / second\n      case 'rdpm':\n      case 'radians per minute':\n      case 'rdps':\n      case 'radians per second':\n        parsed = speedValue;\n        break;\n\n      // Revolutions per minute / second\n      case 'rpm':\n      case 'revolutions per minute':\n      case 'rps':\n      case 'revolutions per second':\n        parsed = speedValue * Math.PI * 2;\n        break;\n\n      // Unknown unit\n      default:\n        throw new PSVError('Unknown speed unit \"' + speedUnit + '\"');\n    }\n  }\n  else {\n    parsed = speed;\n  }\n\n  return parsed;\n}\n\n/**\n * @summary Parses an angle value in radians or degrees and returns a normalized value in radians\n * @memberOf PSV.utils\n * @param {string|number} angle - eg: 3.14, 3.14rad, 180deg\n * @param {boolean} [zeroCenter=false] - normalize between -Pi - Pi instead of 0 - 2*Pi\n * @param {boolean} [halfCircle=zeroCenter] - normalize between -Pi/2 - Pi/2 instead of -Pi - Pi\n * @returns {number}\n * @throws {PSV.PSVError} when the angle cannot be parsed\n */\nexport function parseAngle(angle, zeroCenter = false, halfCircle = zeroCenter) {\n  let parsed;\n\n  if (typeof angle === 'string') {\n    const match = angle.toLowerCase().trim().match(/^(-?[0-9]+(?:\\.[0-9]*)?)(.*)$/);\n\n    if (!match) {\n      throw new PSVError('Unknown angle \"' + angle + '\"');\n    }\n\n    const value = parseFloat(match[1]);\n    const unit = match[2];\n\n    if (unit) {\n      switch (unit) {\n        case 'deg':\n        case 'degs':\n          parsed = THREE.Math.degToRad(value);\n          break;\n        case 'rad':\n        case 'rads':\n          parsed = value;\n          break;\n        default:\n          throw new PSVError('Unknown angle unit \"' + unit + '\"');\n      }\n    }\n    else {\n      parsed = value;\n    }\n  }\n  else if (typeof angle === 'number' && !isNaN(angle)) {\n    parsed = angle;\n  }\n  else {\n    throw new PSVError('Unknown angle \"' + angle + '\"');\n  }\n\n  parsed = (zeroCenter ? parsed + Math.PI : parsed) % (Math.PI * 2);\n\n  if (parsed < 0) {\n    parsed += Math.PI * 2;\n  }\n\n  return zeroCenter ? bound(parsed - Math.PI, -Math.PI / (halfCircle ? 2 : 1), Math.PI / (halfCircle ? 2 : 1)) : parsed;\n}\n\n/**\n * @summary Creates a THREE texture from an image\n * @memberOf PSV.utils\n * @param {HTMLImageElement | HTMLCanvasElement} img\n * @return {external:THREE.Texture}\n */\nexport function createTexture(img) {\n  const texture = new THREE.Texture(img);\n  texture.needsUpdate = true;\n  texture.minFilter = THREE.LinearFilter;\n  texture.generateMipmaps = false;\n  return texture;\n}\n","import { CONSTANTS, utils } from '../..';\n\n/**\n * Returns intermediary point between two points on the sphere\n * {@link http://www.movable-type.co.uk/scripts/latlong.html}\n * @param {number[]} p1\n * @param {number[]} p2\n * @param {number} f\n * @returns {number[]}\n * @private\n */\nexport function greatArcIntermediaryPoint(p1, p2, f) {\n  const [λ1, φ1] = p1;\n  const [λ2, φ2] = p2;\n\n  const r = utils.greatArcDistance(p1, p2);\n  const a = Math.sin((1 - f) * r) / Math.sin(r);\n  const b = Math.sin(f * r) / Math.sin(r);\n  const x = a * Math.cos(φ1) * Math.cos(λ1) + b * Math.cos(φ2) * Math.cos(λ2);\n  const y = a * Math.cos(φ1) * Math.sin(λ1) + b * Math.cos(φ2) * Math.sin(λ2);\n  const z = a * Math.sin(φ1) + b * Math.sin(φ2);\n\n  return [\n    Math.atan2(y, x),\n    Math.atan2(z, Math.sqrt(x * x + y * y)),\n  ];\n}\n\n/**\n * @summary Computes the center point of a polygon\n * @todo Get \"visual center\" (https://blog.mapbox.com/a-new-algorithm-for-finding-a-visual-center-of-a-polygon-7c77e6492fbc)\n * @param {number[][]} polygon\n * @returns {number[]}\n * @private\n */\nexport function getPolygonCenter(polygon) {\n  // apply offsets to avoid crossing the origin\n  const workPoints = [polygon[0]];\n\n  let k = 0;\n  for (let i = 1; i < polygon.length; i++) {\n    const d = polygon[i - 1][0] - polygon[i][0];\n    if (d > Math.PI) { // crossed the origin left to right\n      k += 1;\n    }\n    else if (d < -Math.PI) { // crossed the origin right to left\n      k -= 1;\n    }\n    workPoints.push([polygon[i][0] + k * 2 * Math.PI, polygon[i][1]]);\n  }\n\n  const sum = workPoints.reduce((intermediary, point) => [intermediary[0] + point[0], intermediary[1] + point[1]]);\n  return [utils.parseAngle(sum[0] / polygon.length), sum[1] / polygon.length];\n}\n\n/**\n * @summary Computes the middle point of a polyline\n * @param {number[][]} polyline\n * @returns {number[]}\n * @private\n */\nexport function getPolylineCenter(polyline) {\n  // compute each segment length + total length\n  let length = 0;\n  const lengths = [];\n\n  for (let i = 0; i < polyline.length - 1; i++) {\n    const l = utils.greatArcDistance(polyline[i], polyline[i + 1]) * CONSTANTS.SPHERE_RADIUS;\n\n    lengths.push(l);\n    length += l;\n  }\n\n  // iterate until length / 2\n  let consumed = 0;\n\n  for (let j = 0; j < polyline.length - 1; j++) {\n    // once the segment containing the middle point is found, computes the intermediary point\n    if (consumed + lengths[j] > length / 2) {\n      const r = (length / 2 - consumed) / lengths[j];\n      return greatArcIntermediaryPoint(polyline[j], polyline[j + 1], r);\n    }\n\n    consumed += lengths[j];\n  }\n\n  // this never happens\n  return polyline[Math.round(polyline.length / 2)];\n}\n","import * as THREE from 'three';\nimport { CONSTANTS, PSVError, utils } from '../..';\nimport { getShortestArc, logWarn } from '../../utils';\nimport { MARKER_DATA, SVG_NS } from './constants';\nimport { getPolygonCenter, getPolylineCenter } from './utils';\n\n/**\n * @summary Types of marker\n * @memberOf PSV.plugins.MarkersPlugin\n * @enum {string}\n * @constant\n * @private\n */\nconst MARKER_TYPES = {\n  image      : 'image',\n  html       : 'html',\n  polygonPx  : 'polygonPx',\n  polygonRad : 'polygonRad',\n  polylinePx : 'polylinePx',\n  polylineRad: 'polylineRad',\n  square     : 'square',\n  rect       : 'rect',\n  circle     : 'circle',\n  ellipse    : 'ellipse',\n  path       : 'path',\n};\n\n/**\n * @typedef {Object} PSV.plugins.MarkersPlugin.Properties\n * @summary Marker properties, see {@link https://photo-sphere-viewer.js.org/plugins/plugin-markers.html#markers-options}\n */\n\n/**\n * @summary Object representing a marker\n * @memberOf PSV.plugins.MarkersPlugin\n */\nexport class Marker {\n\n  /**\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @param {PSV.Viewer} psv\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   */\n  constructor(properties, psv) {\n    if (!properties.id) {\n      throw new PSVError('missing marker id');\n    }\n\n    /**\n     * @member {PSV.Viewer}\n     * @readonly\n     * @protected\n     */\n    this.psv = psv;\n\n    /**\n     * @member {string}\n     * @readonly\n     */\n    this.id = properties.id;\n\n    /**\n     * @member {string}\n     * @readonly\n     */\n    this.type = Marker.getType(properties, false);\n\n    /**\n     * @member {boolean}\n     * @protected\n     */\n    this.visible = true;\n\n    /**\n     * @member {HTMLElement|SVGElement}\n     * @readonly\n     */\n    this.$el = null;\n\n    /**\n     * @summary Original configuration of the marker\n     * @member {PSV.plugins.MarkersPlugin.Properties}\n     * @readonly\n     */\n    this.config = {};\n\n    /**\n     * @summary User data associated to the marker\n     * @member {any}\n     */\n    this.data = undefined;\n\n    /**\n     * @summary Tooltip instance for this marker\n     * @member {PSV.components.Tooltip}\n     */\n    this.tooltip = null;\n\n    /**\n     * @summary Computed properties\n     * @member {Object}\n     * @protected\n     * @property {boolean} inViewport\n     * @property {boolean} dynamicSize\n     * @property {PSV.Point} anchor\n     * @property {PSV.Position} position - position in spherical coordinates\n     * @property {PSV.Point} position2D - position in viewer coordinates\n     * @property {external:THREE.Vector3[]} positions3D - positions in 3D space\n     * @property {number} width\n     * @property {number} height\n     * @property {*} def\n     */\n    this.props = {\n      inViewport : false,\n      dynamicSize: false,\n      anchor     : null,\n      position   : null,\n      position2D : null,\n      positions3D: null,\n      width      : null,\n      height     : null,\n      def        : null,\n    };\n\n    // create element\n    if (this.isNormal()) {\n      this.$el = document.createElement('div');\n    }\n    else if (this.isPolygon()) {\n      this.$el = document.createElementNS(SVG_NS, 'polygon');\n    }\n    else if (this.isPolyline()) {\n      this.$el = document.createElementNS(SVG_NS, 'polyline');\n    }\n    else {\n      this.$el = document.createElementNS(SVG_NS, this.type);\n    }\n\n    this.$el.id = `psv-marker-${this.id}`;\n    this.$el[MARKER_DATA] = this;\n\n    this.update(properties);\n  }\n\n  /**\n   * @summary Destroys the marker\n   */\n  destroy() {\n    delete this.$el[MARKER_DATA];\n    delete this.$el;\n    delete this.config;\n    delete this.props;\n    delete this.psv;\n  }\n\n  /**\n   * @summary Checks if it is a normal marker (image or html)\n   * @returns {boolean}\n   */\n  isNormal() {\n    return this.type === MARKER_TYPES.image\n      || this.type === MARKER_TYPES.html;\n  }\n\n  /**\n   * @summary Checks if it is a polygon/polyline marker\n   * @returns {boolean}\n   */\n  isPoly() {\n    return this.isPolygon()\n      || this.isPolyline();\n  }\n\n  /**\n   * @summary Checks if it is a polygon/polyline using pixel coordinates\n   * @returns {boolean}\n   */\n  isPolyPx() {\n    return this.type === MARKER_TYPES.polygonPx\n      || this.type === MARKER_TYPES.polylinePx;\n  }\n\n  /**\n   * @summary Checks if it is a polygon/polyline using radian coordinates\n   * @returns {boolean}\n   */\n  isPolyRad() {\n    return this.type === MARKER_TYPES.polygonRad\n      || this.type === MARKER_TYPES.polylineRad;\n  }\n\n  /**\n   * @summary Checks if it is a polygon marker\n   * @returns {boolean}\n   */\n  isPolygon() {\n    return this.type === MARKER_TYPES.polygonPx\n      || this.type === MARKER_TYPES.polygonRad;\n  }\n\n  /**\n   * @summary Checks if it is a polyline marker\n   * @returns {boolean}\n   */\n  isPolyline() {\n    return this.type === MARKER_TYPES.polylinePx\n      || this.type === MARKER_TYPES.polylineRad;\n  }\n\n  /**\n   * @summary Checks if it is an SVG marker\n   * @returns {boolean}\n   */\n  isSvg() {\n    return this.type === MARKER_TYPES.square\n      || this.type === MARKER_TYPES.rect\n      || this.type === MARKER_TYPES.circle\n      || this.type === MARKER_TYPES.ellipse\n      || this.type === MARKER_TYPES.path;\n  }\n\n  /**\n   * @summary Computes marker scale from zoom level\n   * @param {number} zoomLevel\n   * @param {PSV.Position} position\n   * @returns {number}\n   */\n  getScale(zoomLevel, position) {\n    if (!this.config.scale) {\n      return 1;\n    }\n    if (typeof this.config.scale === 'function') {\n      return this.config.scale(zoomLevel, position);\n    }\n\n    let scale = 1;\n    if (Array.isArray(this.config.scale.zoom)) {\n      const bounds = this.config.scale.zoom;\n      scale *= bounds[0] + (bounds[1] - bounds[0]) * CONSTANTS.EASINGS.inQuad(zoomLevel / 100);\n    }\n    if (Array.isArray(this.config.scale.longitude)) {\n      const bounds = this.config.scale.longitude;\n      const halfFov = THREE.Math.degToRad(this.psv.prop.hFov) / 2;\n      const arc = Math.abs(getShortestArc(this.props.position.longitude, position.longitude));\n      scale *= bounds[1] + (bounds[0] - bounds[1]) * CONSTANTS.EASINGS.outQuad(Math.max(0, (halfFov - arc) / halfFov));\n    }\n    return scale;\n  }\n\n  /**\n   * @summary Returns the markers list content for the marker, it can be either :\n   * - the `listContent`\n   * - the `tooltip.content`\n   * - the `html`\n   * - the `id`\n   * @returns {*}\n   */\n  getListContent() {\n    if (this.config.listContent) {\n      return this.config.listContent;\n    }\n    else if (this.config.tooltip?.content) {\n      return this.config.tooltip.content;\n    }\n    else if (this.config.html) {\n      return this.config.html;\n    }\n    else {\n      return this.id;\n    }\n  }\n\n  /**\n   * @summary Display the tooltip of this marker\n   * @param {{clientX: number, clientY: number}} [mousePosition]\n   */\n  showTooltip(mousePosition) {\n    if (this.visible && this.config.tooltip?.content && this.props.position2D) {\n      const config = {\n        content : this.config.tooltip.content,\n        position: this.config.tooltip.position,\n        data    : this,\n      };\n\n      if (this.isPoly()) {\n        const boundingRect = this.psv.container.getBoundingClientRect();\n\n        config.box = { // separate the tooltip from the cursor\n          width : this.psv.tooltip.size.arrow * 2,\n          height: this.psv.tooltip.size.arrow * 2,\n        };\n\n        if (mousePosition) {\n          config.top = mousePosition.clientY - boundingRect.top - this.psv.tooltip.size.arrow / 2;\n          config.left = mousePosition.clientX - boundingRect.left - this.psv.tooltip.size.arrow;\n        }\n        else {\n          config.top = this.props.position2D.y;\n          config.left = this.props.position2D.x;\n        }\n      }\n      else {\n        config.top = this.props.position2D.y;\n        config.left = this.props.position2D.x;\n        config.box = {\n          width : this.props.width,\n          height: this.props.height,\n        };\n      }\n\n      if (this.tooltip) {\n        this.tooltip.move(config);\n      }\n      else {\n        this.tooltip = this.psv.tooltip.create(config);\n      }\n    }\n  }\n\n  /**\n   * @summary Hides the tooltip of this marker\n   */\n  hideTooltip() {\n    if (this.tooltip) {\n      this.tooltip.hide();\n      this.tooltip = null;\n    }\n  }\n\n  /**\n   * @summary Updates the marker with new properties\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   */\n  update(properties) {\n    const newType = Marker.getType(properties, true);\n\n    if (newType !== undefined && newType !== this.type) {\n      throw new PSVError('cannot change marker type');\n    }\n\n    utils.deepmerge(this.config, properties);\n    this.data = this.config.data;\n\n    this.visible = properties.visible !== false;\n\n    // reset CSS class\n    if (this.isNormal()) {\n      this.$el.setAttribute('class', 'psv-marker psv-marker--normal');\n    }\n    else {\n      this.$el.setAttribute('class', 'psv-marker psv-marker--svg');\n    }\n\n    // add CSS classes\n    if (this.config.className) {\n      utils.addClasses(this.$el, this.config.className);\n    }\n    if (typeof this.config.tooltip === 'string') {\n      this.config.tooltip = { content: this.config.tooltip };\n    }\n    if (this.config.tooltip) {\n      utils.addClasses(this.$el, 'psv-marker--has-tooltip');\n    }\n    if (this.config.content) {\n      utils.addClasses(this.$el, 'psv-marler--has-content');\n    }\n\n    // apply style\n    if (this.config.style) {\n      utils.deepmerge(this.$el.style, this.config.style);\n    }\n\n    // parse anchor\n    this.props.anchor = utils.parsePosition(this.config.anchor);\n\n    // clean scale\n    if (this.config.scale) {\n      if (typeof this.config.scale === 'number') {\n        logWarn('Single value marker scale is deprecated, please use an array of two values.');\n        this.config.scale = { zoom: [0, this.config.scale] };\n      }\n      if (Array.isArray(this.config.scale)) {\n        this.config.scale = { zoom: this.config.scale };\n      }\n    }\n\n    if (this.isNormal()) {\n      this.__updateNormal();\n    }\n    else if (this.isPoly()) {\n      this.__updatePoly();\n    }\n    else {\n      this.__updateSvg();\n    }\n  }\n\n  /**\n   * @summary Updates a normal marker\n   * @private\n   */\n  __updateNormal() {\n    if (!utils.isExtendedPosition(this.config)) {\n      throw new PSVError('missing marker position, latitude/longitude or x/y');\n    }\n\n    if (this.config.image && (!this.config.width || !this.config.height)) {\n      throw new PSVError('missing marker width/height');\n    }\n\n    if (this.config.width && this.config.height) {\n      this.props.dynamicSize = false;\n      this.props.width = this.config.width;\n      this.props.height = this.config.height;\n      this.$el.style.width = this.config.width + 'px';\n      this.$el.style.height = this.config.height + 'px';\n    }\n    else {\n      this.props.dynamicSize = true;\n    }\n\n    if (this.config.image) {\n      this.props.def = this.config.image;\n      this.$el.style.backgroundImage = `url(${this.config.image})`;\n    }\n    else if (this.config.html) {\n      this.props.def = this.config.html;\n      this.$el.innerHTML = this.config.html;\n    }\n\n    // set anchor\n    this.$el.style.transformOrigin = `${this.props.anchor.x * 100}% ${this.props.anchor.y * 100}%`;\n\n    // convert texture coordinates to spherical coordinates\n    this.props.position = this.psv.dataHelper.cleanPosition(this.config);\n\n    // compute x/y/z position\n    this.props.positions3D = [this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)];\n  }\n\n  /**\n   * @summary Updates an SVG marker\n   * @private\n   */\n  __updateSvg() {\n    if (!utils.isExtendedPosition(this.config)) {\n      throw new PSVError('missing marker position, latitude/longitude or x/y');\n    }\n\n    this.props.dynamicSize = true;\n\n    // set content\n    switch (this.type) {\n      case MARKER_TYPES.square:\n        this.props.def = {\n          x     : 0,\n          y     : 0,\n          width : this.config.square,\n          height: this.config.square,\n        };\n        break;\n\n      case MARKER_TYPES.rect:\n        if (Array.isArray(this.config.rect)) {\n          this.props.def = {\n            x     : 0,\n            y     : 0,\n            width : this.config.rect[0],\n            height: this.config.rect[1],\n          };\n        }\n        else {\n          this.props.def = {\n            x     : 0,\n            y     : 0,\n            width : this.config.rect.width,\n            height: this.config.rect.height,\n          };\n        }\n        break;\n\n      case MARKER_TYPES.circle:\n        this.props.def = {\n          cx: this.config.circle,\n          cy: this.config.circle,\n          r : this.config.circle,\n        };\n        break;\n\n      case MARKER_TYPES.ellipse:\n        if (Array.isArray(this.config.ellipse)) {\n          this.props.def = {\n            cx: this.config.ellipse[0],\n            cy: this.config.ellipse[1],\n            rx: this.config.ellipse[0],\n            ry: this.config.ellipse[1],\n          };\n        }\n        else {\n          this.props.def = {\n            cx: this.config.ellipse.rx,\n            cy: this.config.ellipse.ry,\n            rx: this.config.ellipse.rx,\n            ry: this.config.ellipse.ry,\n          };\n        }\n        break;\n\n      case MARKER_TYPES.path:\n        this.props.def = {\n          d: this.config.path,\n        };\n        break;\n\n      // no default\n    }\n\n    utils.each(this.props.def, (value, prop) => {\n      this.$el.setAttributeNS(null, prop, value);\n    });\n\n    // set style\n    if (this.config.svgStyle) {\n      utils.each(this.config.svgStyle, (value, prop) => {\n        this.$el.setAttributeNS(null, utils.dasherize(prop), value);\n      });\n    }\n    else {\n      this.$el.setAttributeNS(null, 'fill', 'rgba(0,0,0,0.5)');\n    }\n\n    // convert texture coordinates to spherical coordinates\n    this.props.position = this.psv.dataHelper.cleanPosition(this.config);\n\n    // compute x/y/z position\n    this.props.positions3D = [this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)];\n  }\n\n  /**\n   * @summary Updates a polygon marker\n   * @private\n   */\n  __updatePoly() {\n    this.props.dynamicSize = true;\n\n    // set style\n    if (this.config.svgStyle) {\n      utils.each(this.config.svgStyle, (value, prop) => {\n        this.$el.setAttributeNS(null, utils.dasherize(prop), value);\n      });\n\n      if (this.isPolyline() && !this.config.svgStyle.fill) {\n        this.$el.setAttributeNS(null, 'fill', 'none');\n      }\n    }\n    else if (this.isPolygon()) {\n      this.$el.setAttributeNS(null, 'fill', 'rgba(0,0,0,0.5)');\n    }\n    else if (this.isPolyline()) {\n      this.$el.setAttributeNS(null, 'fill', 'none');\n      this.$el.setAttributeNS(null, 'stroke', 'rgb(0,0,0)');\n    }\n\n    // fold arrays: [1,2,3,4] => [[1,2],[3,4]]\n    const actualPoly = this.config.polygonPx || this.config.polygonRad || this.config.polylinePx || this.config.polylineRad;\n    if (!Array.isArray(actualPoly[0])) {\n      for (let i = 0; i < actualPoly.length; i++) {\n        actualPoly.splice(i, 2, [actualPoly[i], actualPoly[i + 1]]);\n      }\n    }\n\n    // convert texture coordinates to spherical coordinates\n    if (this.isPolyPx()) {\n      this.props.def = actualPoly.map((coord) => {\n        const sphericalCoords = this.psv.dataHelper.textureCoordsToSphericalCoords({ x: coord[0], y: coord[1] });\n        return [sphericalCoords.longitude, sphericalCoords.latitude];\n      });\n    }\n    // clean angles\n    else {\n      this.props.def = actualPoly.map((coord) => {\n        return [utils.parseAngle(coord[0]), utils.parseAngle(coord[1], true)];\n      });\n    }\n\n    const centroid = this.isPolygon()\n      ? getPolygonCenter(this.props.def)\n      : getPolylineCenter(this.props.def);\n\n    this.props.position = {\n      longitude: centroid[0],\n      latitude : centroid[1],\n    };\n\n    // compute x/y/z positions\n    this.props.positions3D = this.props.def.map((coord) => {\n      return this.psv.dataHelper.sphericalCoordsToVector3({ longitude: coord[0], latitude: coord[1] });\n    });\n  }\n\n  /**\n   * @summary Determines the type of a marker by the available properties\n   * @param {Marker.Properties} properties\n   * @param {boolean} [allowNone=false]\n   * @returns {string}\n   * @throws {PSV.PSVError} when the marker's type cannot be found\n   */\n  static getType(properties, allowNone = false) {\n    const found = [];\n\n    utils.each(MARKER_TYPES, (type) => {\n      if (properties[type]) {\n        found.push(type);\n      }\n    });\n\n    if (found.length === 0 && !allowNone) {\n      throw new PSVError(`missing marker content, either ${Object.keys(MARKER_TYPES).join(', ')}`);\n    }\n    else if (found.length > 1) {\n      throw new PSVError(`multiple marker content, either ${Object.keys(MARKER_TYPES).join(', ')}`);\n    }\n\n    return found[0];\n  }\n\n}\n","import { AbstractButton } from '../..';\nimport { EVENTS } from './constants';\nimport pin from './pin.svg';\n\n/**\n * @summary Navigation bar markers button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class MarkersButton extends AbstractButton {\n\n  static id = 'markers';\n  static icon = pin;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-markers-button', true);\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin}\n     */\n    this.plugin = this.psv.getPlugin('markers');\n\n    if (this.plugin) {\n      this.plugin.on(EVENTS.SHOW_MARKERS, this);\n      this.plugin.on(EVENTS.HIDE_MARKERS, this);\n\n      this.toggleActive(true);\n    }\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.plugin.off(EVENTS.SHOW_MARKERS, this);\n      this.plugin.off(EVENTS.HIDE_MARKERS, this);\n    }\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return this.plugin?.config.hideButton;\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case EVENTS.SHOW_MARKERS: this.toggleActive(true); break;\n      case EVENTS.HIDE_MARKERS: this.toggleActive(false); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles markers\n   */\n  onClick() {\n    if (this.plugin.prop.visible) {\n      this.plugin.hide();\n    }\n    else {\n      this.plugin.show();\n    }\n  }\n\n}\n","import { AbstractButton, CONSTANTS } from '../..';\nimport { ID_PANEL_MARKERS_LIST } from './constants';\nimport pinList from './pin-list.svg';\n\n/**\n * @summary Navigation bar markers list button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class MarkersListButton extends AbstractButton {\n\n  static id = 'markersList';\n  static icon = pinList;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-markers-list-button', true);\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin}\n     */\n    this.plugin = this.psv.getPlugin('markers');\n\n    if (this.plugin) {\n      this.psv.on(CONSTANTS.EVENTS.OPEN_PANEL, this);\n      this.psv.on(CONSTANTS.EVENTS.CLOSE_PANEL, this);\n    }\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.OPEN_PANEL, this);\n    this.psv.off(CONSTANTS.EVENTS.CLOSE_PANEL, this);\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return this.plugin?.config.listButton;\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case CONSTANTS.EVENTS.OPEN_PANEL:  this.toggleActive(e.args[0] === ID_PANEL_MARKERS_LIST); break;\n      case CONSTANTS.EVENTS.CLOSE_PANEL: this.toggleActive(false); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles markers list\n   */\n  onClick() {\n    this.plugin.toggleMarkersList();\n  }\n\n}\n","import * as THREE from 'three';\nimport { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from '../..';\nimport {\n  EVENTS,\n  ID_PANEL_MARKER,\n  ID_PANEL_MARKERS_LIST,\n  MARKER_DATA,\n  MARKERS_LIST_TEMPLATE,\n  SVG_NS\n} from './constants';\nimport { Marker } from './Marker';\nimport { MarkersButton } from './MarkersButton';\nimport { MarkersListButton } from './MarkersListButton';\nimport './style.scss';\n\n\n/**\n * @typedef {Object} PSV.plugins.MarkersPlugin.Options\n * @property {boolean} [hideButton=true] - adds a button to show/hide the markers\n * @property {boolean} [listButton=true] - adds a button to show the list of markers\n * @property {boolean} [clickEventOnMarker=false] If a `click` event is triggered on the viewer additionally to the `select-marker` event.\n * @property {PSV.plugins.MarkersPlugin.Properties[]} [markers]\n */\n\n/**\n * @typedef {Object} PSV.plugins.MarkersPlugin.SelectMarkerData\n * @summary Data of the `select-marker` event\n * @property {boolean} dblclick - if the selection originated from a double click, the simple click is always fired before the double click\n * @property {boolean} rightclick - if the selection originated from a right click\n */\n\n\n// add markers buttons\nDEFAULTS.lang[MarkersButton.id] = 'Markers';\nDEFAULTS.lang[MarkersListButton.id] = 'Markers list';\nregisterButton(MarkersButton, 'caption:left');\nregisterButton(MarkersListButton, 'caption:left');\n\n\nexport { EVENTS } from './constants';\n\n\n/**\n * @summary Displays various markers on the viewer\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport class MarkersPlugin extends AbstractPlugin {\n\n  static id = 'markers';\n\n  /**\n   * @deprecated use the EVENTS constants of the module\n   */\n  static EVENTS = EVENTS;\n\n  /**\n   * @param {PSV.Viewer} psv\n   * @param {PSV.plugins.MarkersPlugin.Options} [options]\n   */\n  constructor(psv, options) {\n    super(psv);\n\n    /**\n     * @summary All registered markers\n     * @member {Object<string, PSV.plugins.MarkersPlugin.Marker>}\n     */\n    this.markers = {};\n\n    /**\n     * @type {Object}\n     * @property {boolean} visible - Visibility of the component\n     * @property {PSV.plugins.MarkersPlugin.Marker} currentMarker - Last selected marker\n     * @property {PSV.plugins.MarkersPlugin.Marker} hoveringMarker - Marker under the cursor\n     * @private\n     */\n    this.prop = {\n      visible       : true,\n      currentMarker : null,\n      hoveringMarker: null,\n    };\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin.Options}\n     */\n    this.config = {\n      hideButton        : true,\n      listButton        : true,\n      clickEventOnMarker: false,\n      ...options,\n    };\n\n    /**\n     * @member {HTMLElement}\n     * @readonly\n     */\n    this.container = document.createElement('div');\n    this.container.className = 'psv-markers';\n    this.container.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\n\n    /**\n     * @member {SVGElement}\n     * @readonly\n     */\n    this.svgContainer = document.createElementNS(SVG_NS, 'svg');\n    this.svgContainer.setAttribute('class', 'psv-markers-svg-container');\n    this.container.appendChild(this.svgContainer);\n\n    // Markers events via delegation\n    this.container.addEventListener('mouseenter', this, true);\n    this.container.addEventListener('mouseleave', this, true);\n    this.container.addEventListener('mousemove', this, true);\n    this.container.addEventListener('contextmenu', this);\n  }\n\n  /**\n   * @package\n   */\n  init() {\n    super.init();\n\n    this.psv.container.appendChild(this.container);\n\n    // Viewer events\n    this.psv.on(CONSTANTS.EVENTS.CLICK, this);\n    this.psv.on(CONSTANTS.EVENTS.DOUBLE_CLICK, this);\n    this.psv.on(CONSTANTS.EVENTS.RENDER, this);\n    this.psv.on(CONSTANTS.EVENTS.CONFIG_CHANGED, this);\n\n    if (this.config.markers) {\n      this.psv.once(CONSTANTS.EVENTS.READY, () => {\n        this.setMarkers(this.config.markers);\n        delete this.config.markers;\n      });\n    }\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    this.clearMarkers(false);\n\n    this.container.removeEventListener('mouseenter', this);\n    this.container.removeEventListener('mouseleave', this);\n    this.container.removeEventListener('mousemove', this);\n    this.container.removeEventListener('contextmenu', this);\n\n    this.psv.off(CONSTANTS.EVENTS.CLICK, this);\n    this.psv.off(CONSTANTS.EVENTS.DOUBLE_CLICK, this);\n    this.psv.off(CONSTANTS.EVENTS.RENDER, this);\n    this.psv.off(CONSTANTS.EVENTS.CONFIG_CHANGED, this);\n\n    this.psv.container.removeChild(this.container);\n\n    delete this.svgContainer;\n    delete this.markers;\n    delete this.container;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case 'mouseenter':  this.__onMouseEnter(e);  break;\n      case 'mouseleave':  this.__onMouseLeave(e);  break;\n      case 'mousemove':   this.__onMouseMove(e);   break;\n      case 'contextmenu': this.__onContextMenu(e); break;\n      case CONSTANTS.EVENTS.CLICK:        this.__onClick(e, e.args[0], false); break;\n      case CONSTANTS.EVENTS.DOUBLE_CLICK: this.__onClick(e, e.args[0], true);  break;\n      case CONSTANTS.EVENTS.RENDER:       this.renderMarkers();                        break;\n      case CONSTANTS.EVENTS.CONFIG_CHANGED:\n        this.container.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\n        break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @fires PSV.plugins.MarkersPlugin.show-markers\n   */\n  show() {\n    this.prop.visible = true;\n\n    this.renderMarkers();\n\n    this.trigger(EVENTS.SHOW_MARKERS);\n  }\n\n  /**\n   * @override\n   * @fires PSV.plugins.MarkersPlugin.hide-markers\n   */\n  hide() {\n    this.prop.visible = false;\n\n    this.renderMarkers();\n\n    this.trigger(EVENTS.HIDE_MARKERS);\n  }\n\n  /**\n   * @summary Toggles the visibility of all tooltips\n   */\n  toggleAllTooltips() {\n    this.prop.showAllTooltips = !this.prop.showAllTooltips;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Displays all tooltips\n   */\n  showAllTooltips() {\n    this.prop.showAllTooltips = true;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Hides all tooltips\n   */\n  hideAllTooltips() {\n    this.prop.showAllTooltips = false;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Returns the total number of markers\n   * @returns {number}\n   */\n  getNbMarkers() {\n    return Object.keys(this.markers).length;\n  }\n\n  /**\n   * @summary Returns all the markers\n   * @return {PSV.plugins.MarkersPlugin.Marker[]}\n   */\n  getMarkers() {\n    return Object.values(this.markers);\n  }\n\n  /**\n   * @summary Adds a new marker to viewer\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @param {boolean} [render=true] - renders the marker immediately\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   * @throws {PSV.PSVError} when the marker's id is missing or already exists\n   */\n  addMarker(properties, render = true) {\n    if (this.markers[properties.id]) {\n      throw new PSVError(`marker \"${properties.id}\" already exists`);\n    }\n\n    const marker = new Marker(properties, this.psv);\n\n    if (marker.isNormal()) {\n      this.container.appendChild(marker.$el);\n    }\n    else {\n      this.svgContainer.appendChild(marker.$el);\n    }\n\n    this.markers[marker.id] = marker;\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n\n    return marker;\n  }\n\n  /**\n   * @summary Returns the internal marker object for a marker id\n   * @param {string} markerId\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   * @throws {PSV.PSVError} when the marker cannot be found\n   */\n  getMarker(markerId) {\n    const id = typeof markerId === 'object' ? markerId.id : markerId;\n\n    if (!this.markers[id]) {\n      throw new PSVError(`cannot find marker \"${id}\"`);\n    }\n\n    return this.markers[id];\n  }\n\n  /**\n   * @summary Returns the last marker selected by the user\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   */\n  getCurrentMarker() {\n    return this.prop.currentMarker;\n  }\n\n  /**\n   * @summary Updates the existing marker with the same id\n   * @description Every property can be changed but you can't change its type (Eg: `image` to `html`).\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @param {boolean} [render=true] - renders the marker immediately\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   */\n  updateMarker(properties, render = true) {\n    const marker = this.getMarker(properties.id);\n\n    marker.update(properties);\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n\n    return marker;\n  }\n\n  /**\n   * @summary Removes a marker from the viewer\n   * @param {string} markerId\n   * @param {boolean} [render=true] - renders the marker immediately\n   */\n  removeMarker(markerId, render = true) {\n    const marker = this.getMarker(markerId);\n\n    if (marker.isNormal()) {\n      this.container.removeChild(marker.$el);\n    }\n    else {\n      this.svgContainer.removeChild(marker.$el);\n    }\n\n    if (this.prop.hoveringMarker === marker) {\n      this.prop.hoveringMarker = null;\n    }\n\n    if (this.prop.currentMarker === marker) {\n      this.prop.currentMarker = null;\n    }\n\n    marker.hideTooltip();\n\n    marker.destroy();\n    delete this.markers[marker.id];\n\n    if (render) {\n      this.__refreshUi();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n  }\n\n  /**\n   * @summary Removes multiple markers\n   * @param {string[]} markerIds\n   * @param {boolean} [render=true] - renders the markers immediately\n   */\n  removeMarkers(markerIds, render = true) {\n    markerIds.forEach(markerId => this.removeMarker(markerId, false));\n\n    if (render) {\n      this.__refreshUi();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n  }\n\n  /**\n   * @summary Replaces all markers\n   * @param {PSV.plugins.MarkersPlugin.Properties[]} markers\n   * @param {boolean} [render=true] - renders the marker immediately\n   */\n  setMarkers(markers, render = true) {\n    this.clearMarkers(false);\n\n    utils.each(markers, marker => this.addMarker(marker, false));\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n  }\n\n  /**\n   * @summary Removes all markers\n   * @param {boolean} [render=true] - renders the markers immediately\n   */\n  clearMarkers(render = true) {\n    utils.each(this.markers, marker => this.removeMarker(marker, false));\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n\n      this.trigger(EVENTS.SET_MARKERS, this.getMarkers());\n    }\n  }\n\n  /**\n   * @summary Rotate the view to face the marker\n   * @param {string} markerId\n   * @param {string|number} [speed] - rotates smoothy, see {@link PSV.Viewer#animate}\n   * @fires PSV.plugins.MarkersPlugin.goto-marker-done\n   * @return {PSV.Animation}  A promise that will be resolved when the animation finishes\n   */\n  gotoMarker(markerId, speed) {\n    const marker = this.getMarker(markerId);\n\n    return this.psv.animate({\n      ...marker.props.position,\n      speed,\n    })\n      .then(() => {\n        this.trigger(EVENTS.GOTO_MARKER_DONE, marker);\n      });\n  }\n\n  /**\n   * @summary Hides a marker\n   * @param {string} markerId\n   */\n  hideMarker(markerId) {\n    this.getMarker(markerId).visible = false;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Shows a marker\n   * @param {string} markerId\n   */\n  showMarker(markerId) {\n    this.getMarker(markerId).visible = true;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Toggles a marker\n   * @param {string} markerId\n   */\n  toggleMarker(markerId) {\n    this.getMarker(markerId).visible ^= true;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Opens the panel with the content of the marker\n   * @param {string} markerId\n   */\n  showMarkerPanel(markerId) {\n    const marker = this.getMarker(markerId);\n\n    if (marker?.config?.content) {\n      this.psv.panel.show({\n        id     : ID_PANEL_MARKER,\n        content: marker.config.content,\n      });\n    }\n    else {\n      this.psv.panel.hide(ID_PANEL_MARKER);\n    }\n  }\n\n  /**\n   * @summary Toggles the visibility of the list of markers\n   */\n  toggleMarkersList() {\n    if (this.psv.panel.prop.contentId === ID_PANEL_MARKERS_LIST) {\n      this.hideMarkersList();\n    }\n    else {\n      this.showMarkersList();\n    }\n  }\n\n  /**\n   * @summary Opens side panel with the list of markers\n   * @fires PSV.plugins.MarkersPlugin.filter:render-markers-list\n   */\n  showMarkersList() {\n    let markers = [];\n    utils.each(this.markers, (marker) => {\n      if (marker.visible && !marker.config.hideList) {\n        markers.push(marker);\n      }\n    });\n\n    markers = this.change(EVENTS.RENDER_MARKERS_LIST, markers);\n\n    this.psv.panel.show({\n      id          : ID_PANEL_MARKERS_LIST,\n      content     : MARKERS_LIST_TEMPLATE(\n        markers,\n        this.psv.config.lang[MarkersButton.id],\n        utils.dasherize(MARKER_DATA)\n      ),\n      noMargin    : true,\n      clickHandler: (e) => {\n        const li = e.target ? utils.getClosest(e.target, 'li') : undefined;\n        const markerId = li ? li.dataset[MARKER_DATA] : undefined;\n\n        if (markerId) {\n          const marker = this.getMarker(markerId);\n\n          this.trigger(EVENTS.SELECT_MARKER_LIST, marker);\n\n          this.gotoMarker(marker, 1000);\n          this.hideMarkersList();\n        }\n      },\n    });\n  }\n\n  /**\n   * @summary Closes side panel if it contains the list of markers\n   */\n  hideMarkersList() {\n    this.psv.panel.hide(ID_PANEL_MARKERS_LIST);\n  }\n\n  /**\n   * @summary Updates the visibility and the position of all markers\n   */\n  renderMarkers() {\n    const zoomLevel = this.psv.getZoomLevel();\n    const viewerPosition = this.psv.getPosition();\n\n    utils.each(this.markers, (marker) => {\n      let isVisible = this.prop.visible && marker.visible;\n\n      if (isVisible && marker.isPoly()) {\n        const positions = this.__getPolyPositions(marker);\n        isVisible = positions.length > (marker.isPolygon() ? 2 : 1);\n\n        if (isVisible) {\n          const position = this.__getMarkerPosition(marker);\n          marker.props.position2D = position;\n\n          const points = positions.map(pos => (pos.x - position.x) + ',' + (pos.y - position.y)).join(' ');\n\n          marker.$el.setAttributeNS(null, 'points', points);\n          marker.$el.setAttributeNS(null, 'transform', `translate(${position.x} ${position.y})`);\n        }\n      }\n      else if (isVisible) {\n        if (marker.props.dynamicSize) {\n          this.__updateMarkerSize(marker);\n        }\n\n        const position = this.__getMarkerPosition(marker);\n        isVisible = this.__isMarkerVisible(marker, position);\n\n        if (isVisible) {\n          marker.props.position2D = position;\n          const scale = marker.getScale(zoomLevel, viewerPosition);\n\n          if (marker.isSvg()) {\n            // simulate transform-origin relative to SVG element\n            const x = position.x + marker.props.width * marker.props.anchor.x * (1 - scale);\n            const y = position.y + marker.props.width * marker.props.anchor.y * (1 - scale);\n            marker.$el.setAttributeNS(null, 'transform', `translate(${x}, ${y}) scale(${scale}, ${scale})`);\n          }\n          else {\n            marker.$el.style.transform = `translate3D(${position.x}px, ${position.y}px, 0px) scale(${scale}, ${scale})`;\n          }\n        }\n      }\n\n      marker.props.inViewport = isVisible;\n      utils.toggleClass(marker.$el, 'psv-marker--visible', isVisible);\n\n      if (marker.props.inViewport && (this.prop.showAllTooltips || (marker === this.prop.hoveringMarker && !marker.isPoly()))) {\n        marker.showTooltip();\n      }\n      else if (!marker.props.inViewport || marker !== this.prop.hoveringMarker) {\n        marker.hideTooltip();\n      }\n    });\n  }\n\n  /**\n   * @summary Determines if a point marker is visible<br>\n   * It tests if the point is in the general direction of the camera, then check if it's in the viewport\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @param {PSV.Point} position\n   * @returns {boolean}\n   * @private\n   */\n  __isMarkerVisible(marker, position) {\n    return marker.props.positions3D[0].dot(this.psv.prop.direction) > 0\n      && position.x + marker.props.width >= 0\n      && position.x - marker.props.width <= this.psv.prop.size.width\n      && position.y + marker.props.height >= 0\n      && position.y - marker.props.height <= this.psv.prop.size.height;\n  }\n\n  /**\n   * @summary Computes the real size of a marker\n   * @description This is done by removing all it's transformations (if any) and making it visible\n   * before querying its bounding rect\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @private\n   */\n  __updateMarkerSize(marker) {\n    utils.addClasses(marker.$el, 'psv-marker--transparent');\n\n    let transform;\n    if (marker.isSvg()) {\n      transform = marker.$el.getAttributeNS(null, 'transform');\n      marker.$el.removeAttributeNS(null, 'transform');\n    }\n    else {\n      transform = marker.$el.style.transform;\n      marker.$el.style.transform = '';\n    }\n\n    const rect = marker.$el.getBoundingClientRect();\n    marker.props.width = rect.width;\n    marker.props.height = rect.height;\n\n    utils.removeClasses(marker.$el, 'psv-marker--transparent');\n\n    if (transform) {\n      if (marker.isSvg()) {\n        marker.$el.setAttributeNS(null, 'transform', transform);\n      }\n      else {\n        marker.$el.style.transform = transform;\n      }\n    }\n\n    // the size is no longer dynamic once known\n    marker.props.dynamicSize = false;\n  }\n\n  /**\n   * @summary Computes viewer coordinates of a marker\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @returns {PSV.Point}\n   * @private\n   */\n  __getMarkerPosition(marker) {\n    if (marker.isPoly()) {\n      return this.psv.dataHelper.sphericalCoordsToViewerCoords(marker.props.position);\n    }\n    else {\n      const position = this.psv.dataHelper.vector3ToViewerCoords(marker.props.positions3D[0]);\n\n      position.x -= marker.props.width * marker.props.anchor.x;\n      position.y -= marker.props.height * marker.props.anchor.y;\n\n      return position;\n    }\n  }\n\n  /**\n   * @summary Computes viewer coordinates of each point of a polygon/polyline<br>\n   * It handles points behind the camera by creating intermediary points suitable for the projector\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @returns {PSV.Point[]}\n   * @private\n   */\n  __getPolyPositions(marker) {\n    const nbVectors = marker.props.positions3D.length;\n\n    // compute if each vector is visible\n    const positions3D = marker.props.positions3D.map((vector) => {\n      return {\n        vector : vector,\n        visible: vector.dot(this.psv.prop.direction) > 0,\n      };\n    });\n\n    // get pairs of visible/invisible vectors for each invisible vector connected to a visible vector\n    const toBeComputed = [];\n    positions3D.forEach((pos, i) => {\n      if (!pos.visible) {\n        const neighbours = [\n          i === 0 ? positions3D[nbVectors - 1] : positions3D[i - 1],\n          i === nbVectors - 1 ? positions3D[0] : positions3D[i + 1],\n        ];\n\n        neighbours.forEach((neighbour) => {\n          if (neighbour.visible) {\n            toBeComputed.push({\n              visible  : neighbour,\n              invisible: pos,\n              index    : i,\n            });\n          }\n        });\n      }\n    });\n\n    // compute intermediary vector for each pair (the loop is reversed for splice to insert at the right place)\n    toBeComputed.reverse().forEach((pair) => {\n      positions3D.splice(pair.index, 0, {\n        vector : this.__getPolyIntermediaryPoint(pair.visible.vector, pair.invisible.vector),\n        visible: true,\n      });\n    });\n\n    // translate vectors to screen pos\n    return positions3D\n      .filter(pos => pos.visible)\n      .map(pos => this.psv.dataHelper.vector3ToViewerCoords(pos.vector));\n  }\n\n  /**\n   * Given one point in the same direction of the camera and one point behind the camera,\n   * computes an intermediary point on the great circle delimiting the half sphere visible by the camera.\n   * The point is shifted by .01 rad because the projector cannot handle points exactly on this circle.\n   * TODO : does not work with fisheye view (must not use the great circle)\n   * {@link http://math.stackexchange.com/a/1730410/327208}\n   * @param P1 {external:THREE.Vector3}\n   * @param P2 {external:THREE.Vector3}\n   * @returns {external:THREE.Vector3}\n   * @private\n   */\n  __getPolyIntermediaryPoint(P1, P2) {\n    const C = this.psv.prop.direction.clone().normalize();\n    const N = new THREE.Vector3().crossVectors(P1, P2).normalize();\n    const V = new THREE.Vector3().crossVectors(N, P1).normalize();\n    const X = P1.clone().multiplyScalar(-C.dot(V));\n    const Y = V.clone().multiplyScalar(C.dot(P1));\n    const H = new THREE.Vector3().addVectors(X, Y).normalize();\n    const a = new THREE.Vector3().crossVectors(H, C);\n    return H.applyAxisAngle(a, 0.01).multiplyScalar(CONSTANTS.SPHERE_RADIUS);\n  }\n\n  /**\n   * @summary Returns the marker associated to an event target\n   * @param {EventTarget} target\n   * @param {boolean} [closest=false]\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   * @private\n   */\n  __getTargetMarker(target, closest = false) {\n    const target2 = closest ? utils.getClosest(target, '.psv-marker') : target;\n    return target2 ? target2[MARKER_DATA] : undefined;\n  }\n\n  /**\n   * @summary Checks if an event target is in the tooltip\n   * @param {EventTarget} target\n   * @param {PSV.components.Tooltip} tooltip\n   * @returns {boolean}\n   * @private\n   */\n  __targetOnTooltip(target, tooltip) {\n    return target && tooltip ? utils.hasParent(target, tooltip.container) : false;\n  }\n\n  /**\n   * @summary Handles mouse enter events, show the tooltip for non polygon markers\n   * @param {MouseEvent} e\n   * @fires PSV.plugins.MarkersPlugin.over-marker\n   * @private\n   */\n  __onMouseEnter(e) {\n    const marker = this.__getTargetMarker(e.target);\n\n    if (marker && !marker.isPoly()) {\n      this.prop.hoveringMarker = marker;\n\n      this.trigger(EVENTS.OVER_MARKER, marker);\n\n      if (!this.prop.showAllTooltips) {\n        marker.showTooltip(e);\n      }\n    }\n  }\n\n  /**\n   * @summary Handles mouse leave events, hide the tooltip\n   * @param {MouseEvent} e\n   * @fires PSV.plugins.MarkersPlugin.leave-marker\n   * @private\n   */\n  __onMouseLeave(e) {\n    const marker = this.__getTargetMarker(e.target);\n\n    // do not hide if we enter the tooltip itself while hovering a polygon\n    if (marker && !(marker.isPoly() && this.__targetOnTooltip(e.relatedTarget, marker.tooltip))) {\n      this.trigger(EVENTS.LEAVE_MARKER, marker);\n\n      this.prop.hoveringMarker = null;\n\n      if (!this.prop.showAllTooltips) {\n        marker.hideTooltip();\n      }\n    }\n  }\n\n  /**\n   * @summary Handles mouse move events, refreshUi the tooltip for polygon markers\n   * @param {MouseEvent} e\n   * @fires PSV.plugins.MarkersPlugin.leave-marker\n   * @fires PSV.plugins.MarkersPlugin.over-marker\n   * @private\n   */\n  __onMouseMove(e) {\n    let marker;\n    const targetMarker = this.__getTargetMarker(e.target);\n\n    if (targetMarker?.isPoly()) {\n      marker = targetMarker;\n    }\n    // do not hide if we enter the tooltip itself while hovering a polygon\n    else if (this.prop.hoveringMarker && this.__targetOnTooltip(e.target, this.prop.hoveringMarker.tooltip)) {\n      marker = this.prop.hoveringMarker;\n    }\n\n    if (marker) {\n      if (!this.prop.hoveringMarker) {\n        this.trigger(EVENTS.OVER_MARKER, marker);\n\n        this.prop.hoveringMarker = marker;\n      }\n\n      if (!this.prop.showAllTooltips) {\n        marker.showTooltip(e);\n      }\n    }\n    else if (this.prop.hoveringMarker?.isPoly()) {\n      this.trigger(EVENTS.LEAVE_MARKER, this.prop.hoveringMarker);\n\n      if (!this.prop.showAllTooltips) {\n        this.prop.hoveringMarker.hideTooltip();\n      }\n\n      this.prop.hoveringMarker = null;\n    }\n  }\n\n  /**\n   * @summary Handles context menu events\n   * @param {MouseWheelEvent} evt\n   * @private\n   */\n  __onContextMenu(evt) {\n    if (!utils.getClosest(evt.target, '.psv-marker')) {\n      return true;\n    }\n\n    evt.preventDefault();\n    return false;\n  }\n\n  /**\n   * @summary Handles mouse click events, select the marker and open the panel if necessary\n   * @param {Event} e\n   * @param {Object} data\n   * @param {boolean} dblclick\n   * @fires PSV.plugins.MarkersPlugin.select-marker\n   * @fires PSV.plugins.MarkersPlugin.unselect-marker\n   * @private\n   */\n  __onClick(e, data, dblclick) {\n    const marker = this.__getTargetMarker(data.target, true);\n\n    if (marker) {\n      this.prop.currentMarker = marker;\n\n      this.trigger(EVENTS.SELECT_MARKER, marker, {\n        dblclick  : dblclick,\n        rightclick: data.rightclick,\n      });\n\n      if (this.config.clickEventOnMarker) {\n        // add the marker to event data\n        data.marker = marker;\n      }\n      else {\n        e.stopPropagation();\n      }\n\n      // the marker could have been deleted in an event handler\n      if (this.markers[marker.id]) {\n        this.showMarkerPanel(marker.id);\n      }\n    }\n    else if (this.prop.currentMarker) {\n      this.trigger(EVENTS.UNSELECT_MARKER, this.prop.currentMarker);\n\n      this.psv.panel.hide(ID_PANEL_MARKER);\n\n      this.prop.currentMarker = null;\n    }\n  }\n\n  /**\n   * @summary Updates the visiblity of the panel and the buttons\n   * @private\n   */\n  __refreshUi() {\n    const nbMarkers = Object.values(this.markers).filter(m => !m.config.hideList).length;\n    const markersButton = this.psv.navbar.getButton(MarkersButton.id, false);\n    const markersListButton = this.psv.navbar.getButton(MarkersListButton.id, false);\n\n    if (nbMarkers === 0) {\n      markersButton?.hide();\n      markersListButton?.hide();\n\n      if (this.psv.panel.isVisible(ID_PANEL_MARKERS_LIST)) {\n        this.psv.panel.hide();\n      }\n      else if (this.psv.panel.isVisible(ID_PANEL_MARKER)) {\n        this.psv.panel.hide();\n      }\n    }\n    else {\n      if (this.config.hideButton) {\n        markersButton?.show();\n      }\n      if (this.config.listButton) {\n        markersListButton?.show();\n      }\n\n      if (this.psv.panel.isVisible(ID_PANEL_MARKERS_LIST)) {\n        this.showMarkersList();\n      }\n      else if (this.psv.panel.isVisible(ID_PANEL_MARKER)) {\n        this.prop.currentMarker ? this.showMarkerPanel(this.prop.currentMarker) : this.psv.panel.hide();\n      }\n    }\n  }\n\n}\n"],"names":["EVENTS","GOTO_MARKER_DONE","LEAVE_MARKER","OVER_MARKER","RENDER_MARKERS_LIST","SELECT_MARKER","SELECT_MARKER_LIST","UNSELECT_MARKER","HIDE_MARKERS","SET_MARKERS","SHOW_MARKERS","SVG_NS","MARKER_DATA","ID_PANEL_MARKER","ID_PANEL_MARKERS_LIST","MARKERS_LIST_TEMPLATE","markers","title","dataKey","icon","map","marker","config","id","type","image","getListContent","join","getShortestArc","from","to","tCandidates","Math","PI","reduce","value","candidate","newCandidate","abs","Infinity","PSVError","message","Error","captureStackTrace","stack","prototype","Object","create","name","constructor","logWarn","console","warn","greatArcIntermediaryPoint","p1","p2","f","λ1","φ1","λ2","φ2","r","utils","greatArcDistance","a","sin","b","x","cos","y","z","atan2","sqrt","getPolygonCenter","polygon","workPoints","k","i","length","d","push","sum","intermediary","point","parseAngle","getPolylineCenter","polyline","lengths","l","CONSTANTS","SPHERE_RADIUS","consumed","j","round","MARKER_TYPES","html","polygonPx","polygonRad","polylinePx","polylineRad","square","rect","circle","ellipse","path","Marker","properties","psv","getType","visible","$el","data","undefined","tooltip","props","inViewport","dynamicSize","anchor","position","position2D","positions3D","width","height","def","isNormal","document","createElement","isPolygon","createElementNS","isPolyline","update","destroy","isPoly","isPolyPx","isPolyRad","isSvg","getScale","zoomLevel","scale","Array","isArray","zoom","bounds","EASINGS","inQuad","longitude","halfFov","THREE","degToRad","prop","hFov","arc","outQuad","max","listContent","content","showTooltip","mousePosition","boundingRect","container","getBoundingClientRect","box","size","arrow","top","clientY","left","clientX","move","hideTooltip","hide","newType","deepmerge","setAttribute","className","addClasses","style","parsePosition","__updateNormal","__updatePoly","__updateSvg","isExtendedPosition","backgroundImage","innerHTML","transformOrigin","dataHelper","cleanPosition","sphericalCoordsToVector3","cx","cy","rx","ry","each","setAttributeNS","svgStyle","dasherize","fill","actualPoly","splice","coord","sphericalCoords","textureCoordsToSphericalCoords","latitude","centroid","allowNone","found","keys","MarkersButton","navbar","plugin","getPlugin","on","toggleActive","off","isSupported","hideButton","handleEvent","e","onClick","show","AbstractButton","pin","MarkersListButton","OPEN_PANEL","CLOSE_PANEL","listButton","args","toggleMarkersList","pinList","DEFAULTS","lang","registerButton","MarkersPlugin","options","currentMarker","hoveringMarker","clickEventOnMarker","cursor","mousemove","svgContainer","appendChild","addEventListener","init","CLICK","DOUBLE_CLICK","RENDER","CONFIG_CHANGED","once","READY","setMarkers","clearMarkers","removeEventListener","removeChild","__onMouseEnter","__onMouseLeave","__onMouseMove","__onContextMenu","__onClick","renderMarkers","trigger","toggleAllTooltips","showAllTooltips","hideAllTooltips","getNbMarkers","getMarkers","values","addMarker","render","__refreshUi","getMarker","markerId","getCurrentMarker","updateMarker","removeMarker","removeMarkers","markerIds","forEach","gotoMarker","speed","animate","then","hideMarker","showMarker","toggleMarker","showMarkerPanel","panel","contentId","hideMarkersList","showMarkersList","hideList","change","noMargin","clickHandler","li","target","getClosest","dataset","getZoomLevel","viewerPosition","getPosition","isVisible","positions","__getPolyPositions","__getMarkerPosition","points","pos","__updateMarkerSize","__isMarkerVisible","transform","toggleClass","dot","direction","getAttributeNS","removeAttributeNS","removeClasses","sphericalCoordsToViewerCoords","vector3ToViewerCoords","nbVectors","vector","toBeComputed","neighbours","neighbour","invisible","index","reverse","pair","__getPolyIntermediaryPoint","filter","P1","P2","C","clone","normalize","N","Vector3","crossVectors","V","X","multiplyScalar","Y","H","addVectors","applyAxisAngle","__getTargetMarker","closest","target2","__targetOnTooltip","hasParent","relatedTarget","targetMarker","evt","preventDefault","dblclick","rightclick","stopPropagation","nbMarkers","m","markersButton","getButton","markersListButton","AbstractPlugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEA;EACA;EACA;EACA;EACA;EACA;;MACaA,MAAM,GAAG;EACpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,gBAAgB,EAAK,kBAPD;;EAQpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,YAAY,EAAS,cAdD;;EAepB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,WAAW,EAAU,aArBD;;EAsBpB;EACF;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,mBAAmB,EAAE,qBA7BD;;EA8BpB;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACEC,EAAAA,aAAa,EAAQ,eAtCD;;EAuCpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,kBAAkB,EAAG,oBA7CD;;EA8CpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,eAAe,EAAM,iBApDD;;EAqDpB;EACF;EACA;EACA;EACA;EACEC,EAAAA,YAAY,EAAS,cA1DD;;EA2DpB;EACF;EACA;EACA;EACA;EACA;EACEC,EAAAA,WAAW,EAAU,aAjED;;EAkEpB;EACF;EACA;EACA;EACA;EACEC,EAAAA,YAAY,EAAS;EAvED;EA0EtB;EACA;EACA;EACA;EACA;EACA;;EACO,IAAMC,MAAM,GAAG,4BAAf;EAEP;EACA;EACA;EACA;EACA;EACA;;EACO,IAAMC,WAAW,GAAG,WAApB;EAEP;EACA;EACA;EACA;EACA;EACA;;EACO,IAAMC,eAAe,GAAG,QAAxB;EAEP;EACA;EACA;EACA;EACA;EACA;;EACO,IAAMC,qBAAqB,GAAG,aAA9B;EAEP;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EACO,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACC,OAAD,EAAUC,KAAV,EAAiBC,OAAjB;EAAA,8GAEAC,OAFA,SAEQF,KAFR,yDAI/BD,OAAO,CAACI,GAAR,CAAY,UAAAC,MAAM;EAAA,+BACTH,OADS,WACGG,MAAM,CAACC,MAAP,CAAcC,EADjB,iEAEh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"}