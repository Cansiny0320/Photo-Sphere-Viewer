{"version":3,"file":"visible-range.js","sources":["../../src/plugins/visible-range/index.js"],"sourcesContent":["import * as THREE from 'three';\nimport { AbstractPlugin, Animation, CONSTANTS, utils } from '../..';\n\n/**\n * @typedef {Object} PSV.plugins.VisibleRangePlugin.Options\n * @property {double[]|string[]} [latitudeRange] - latitude range as two angles\n * @property {double[]|string[]} [longitudeRange] - longitude range as two angles\n * @property {boolean} [usePanoData] - use panoData as visible range, you can also manually call `setRangesFromPanoData`\n */\n\n/**\n * @summary Locks visible longitude and/or latitude\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport class VisibleRangePlugin extends AbstractPlugin {\n\n  static id = 'visible-range';\n\n  /**\n   * @param {PSV.Viewer} psv\n   * @param {PSV.plugins.VisibleRangePlugin.Options} options\n   */\n  constructor(psv, options) {\n    super(psv);\n\n    /**\n     * @member {PSV.plugins.VisibleRangePlugin.Options}\n     * @private\n     */\n    this.config = {\n      latitudeRange : null,\n      longitudeRange: null,\n      usePanoData   : false,\n    };\n\n    if (options) {\n      this.config.usePanoData = !!options.usePanoData;\n      this.setLatitudeRange(options.latitudeRange);\n      this.setLongitudeRange(options.longitudeRange);\n    }\n\n    this.psv.on(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n    this.psv.on(CONSTANTS.EVENTS.ZOOM_UPDATED, this);\n    this.psv.on(CONSTANTS.CHANGE_EVENTS.GET_ANIMATE_POSITION, this);\n    this.psv.on(CONSTANTS.CHANGE_EVENTS.GET_ROTATE_POSITION, this);\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n    this.psv.off(CONSTANTS.EVENTS.ZOOM_UPDATED, this);\n    this.psv.off(CONSTANTS.CHANGE_EVENTS.GET_ANIMATE_POSITION, this);\n    this.psv.off(CONSTANTS.CHANGE_EVENTS.GET_ROTATE_POSITION, this);\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  // eslint-disable-next-line consistent-return\n  handleEvent(e) {\n    if (e.type === CONSTANTS.CHANGE_EVENTS.GET_ANIMATE_POSITION) {\n      const { rangedPosition } = this.applyRanges(e.value);\n      return rangedPosition;\n    }\n    else if (e.type === CONSTANTS.CHANGE_EVENTS.GET_ROTATE_POSITION) {\n      const { rangedPosition, sidesReached } = this.applyRanges(e.value);\n\n      if (utils.intersect(['left', 'right'], sidesReached).length > 0 && this.psv.isAutorotateEnabled()) {\n        this.__reverseAutorotate();\n        return e.value;\n      }\n\n      return rangedPosition;\n    }\n    else if (e.type === CONSTANTS.EVENTS.PANORAMA_LOADED) {\n      if (this.config.usePanoData) {\n        this.setRangesFromPanoData();\n      }\n    }\n    else if (e.type === CONSTANTS.EVENTS.ZOOM_UPDATED) {\n      const currentPosition = this.psv.getPosition();\n      const { rangedPosition } = this.applyRanges(currentPosition);\n      if (currentPosition.longitude !== rangedPosition.longitude || currentPosition.latitude !== rangedPosition.latitude) {\n        this.psv.rotate(rangedPosition);\n      }\n    }\n  }\n\n  /**\n   * @summary Changes the latitude range\n   * @param {double[]|string[]} range - latitude range as two angles\n   */\n  setLatitudeRange(range) {\n    // latitude range must have two values\n    if (range && range.length !== 2) {\n      utils.logWarn('latitude range must have exactly two elements');\n      range = null;\n    }\n    // latitude range must be ordered\n    else if (range && range[0] > range[1]) {\n      utils.logWarn('latitude range values must be ordered');\n      range = [range[1], range[0]];\n    }\n    // latitude range is between -PI/2 and PI/2\n    if (range) {\n      this.config.latitudeRange = range.map(angle => utils.parseAngle(angle, true));\n    }\n    else {\n      this.config.latitudeRange = null;\n    }\n\n    if (this.psv.prop.ready) {\n      this.psv.rotate(this.psv.getPosition());\n    }\n  }\n\n  /**\n   * @summary Changes the longitude range\n   * @param {double[]|string[]} range - longitude range as two angles\n   */\n  setLongitudeRange(range) {\n    // longitude range must have two values\n    if (range && range.length !== 2) {\n      utils.logWarn('longitude range must have exactly two elements');\n      range = null;\n    }\n    // longitude range is between 0 and 2*PI\n    if (range) {\n      this.config.longitudeRange = range.map(angle => utils.parseAngle(angle));\n    }\n    else {\n      this.config.longitudeRange = null;\n    }\n\n    if (this.psv.prop.ready) {\n      this.psv.rotate(this.psv.getPosition());\n    }\n  }\n\n  /**\n   * @summary Changes the latitude and longitude ranges according the current panorama cropping data\n   */\n  setRangesFromPanoData() {\n    this.setLatitudeRange(this.getPanoLatitudeRange());\n    this.setLongitudeRange(this.getPanoLongitudeRange());\n  }\n\n  /**\n   * @summary Gets the latitude range defined by the viewer's panoData\n   * @returns {double[]|null}\n   * @private\n   */\n  getPanoLatitudeRange() {\n    const p = this.psv.prop.panoData;\n    if (p.croppedHeight === p.fullHeight && p.croppedY === 0) {\n      return null;\n    }\n    else {\n      const latitude = y => Math.PI * (1 - y / p.fullHeight) - (Math.PI / 2);\n      return [latitude(p.croppedY), latitude(p.croppedY + p.croppedHeight)];\n    }\n  }\n\n  /**\n   * @summary Gets the longitude range defined by the viewer's panoData\n   * @returns {double[]|null}\n   * @private\n   */\n  getPanoLongitudeRange() {\n    const p = this.psv.prop.panoData;\n    if (p.croppedWidth === p.fullWidth && p.croppedX === 0) {\n      return null;\n    }\n    else {\n      const longitude = x => 2 * Math.PI * (x / p.fullWidth) - Math.PI;\n      return [longitude(p.croppedX), longitude(p.croppedX + p.croppedWidth)];\n    }\n  }\n\n  /**\n   * @summary Apply \"longitudeRange\" and \"latitudeRange\"\n   * @param {PSV.Position} position\n   * @returns {{rangedPosition: PSV.Position, sidesReached: string[]}}\n   * @private\n   */\n  applyRanges(position) {\n    const rangedPosition = {\n      longitude: position.longitude,\n      latitude : position.latitude,\n    };\n    const sidesReached = [];\n\n    let range;\n    let offset;\n\n    if (this.config.longitudeRange) {\n      range = utils.clone(this.config.longitudeRange);\n      offset = THREE.Math.degToRad(this.psv.prop.hFov) / 2;\n\n      range[0] = utils.parseAngle(range[0] + offset);\n      range[1] = utils.parseAngle(range[1] - offset);\n\n      if (range[0] > range[1]) { // when the range cross longitude 0\n        if (position.longitude > range[1] && position.longitude < range[0]) {\n          if (position.longitude > (range[0] / 2 + range[1] / 2)) { // detect which side we are closer too\n            rangedPosition.longitude = range[0];\n            sidesReached.push('left');\n          }\n          else {\n            rangedPosition.longitude = range[1];\n            sidesReached.push('right');\n          }\n        }\n      }\n      else if (position.longitude < range[0]) {\n        rangedPosition.longitude = range[0];\n        sidesReached.push('left');\n      }\n      else if (position.longitude > range[1]) {\n        rangedPosition.longitude = range[1];\n        sidesReached.push('right');\n      }\n    }\n\n    if (this.config.latitudeRange) {\n      range = utils.clone(this.config.latitudeRange);\n      offset = THREE.Math.degToRad(this.psv.prop.vFov) / 2;\n\n      range[0] = utils.parseAngle(Math.min(range[0] + offset, range[1]), true);\n      range[1] = utils.parseAngle(Math.max(range[1] - offset, range[0]), true);\n\n      if (position.latitude < range[0]) {\n        rangedPosition.latitude = range[0];\n        sidesReached.push('bottom');\n      }\n      else if (position.latitude > range[1]) {\n        rangedPosition.latitude = range[1];\n        sidesReached.push('top');\n      }\n    }\n\n    return { rangedPosition, sidesReached };\n  }\n\n  /**\n   * @summary Reverses autorotate direction with smooth transition\n   * @private\n   */\n  __reverseAutorotate() {\n    const newSpeed = -this.psv.config.autorotateSpeed;\n    const range = this.config.longitudeRange;\n    this.config.longitudeRange = null;\n\n    new Animation({\n      properties: {\n        speed: { start: this.psv.config.autorotateSpeed, end: 0 },\n      },\n      duration  : 300,\n      easing    : 'inSine',\n      onTick    : (properties) => {\n        this.psv.config.autorotateSpeed = properties.speed;\n      },\n    })\n      .then(() => new Animation({\n        properties: {\n          speed: { start: 0, end: newSpeed },\n        },\n        duration  : 300,\n        easing    : 'outSine',\n        onTick    : (properties) => {\n          this.psv.config.autorotateSpeed = properties.speed;\n        },\n      }))\n      .then(() => {\n        this.config.longitudeRange = range;\n      });\n  }\n\n}\n"],"names":["VisibleRangePlugin","psv","options","config","latitudeRange","longitudeRange","usePanoData","setLatitudeRange","setLongitudeRange","on","CONSTANTS","EVENTS","PANORAMA_LOADED","ZOOM_UPDATED","CHANGE_EVENTS","GET_ANIMATE_POSITION","GET_ROTATE_POSITION","destroy","off","handleEvent","e","type","applyRanges","value","rangedPosition","sidesReached","utils","intersect","length","isAutorotateEnabled","__reverseAutorotate","setRangesFromPanoData","currentPosition","getPosition","longitude","latitude","rotate","range","logWarn","map","angle","parseAngle","prop","ready","getPanoLatitudeRange","getPanoLongitudeRange","p","panoData","croppedHeight","fullHeight","croppedY","y","Math","PI","croppedWidth","fullWidth","croppedX","x","position","offset","clone","THREE","degToRad","hFov","push","vFov","min","max","newSpeed","autorotateSpeed","Animation","properties","speed","start","end","duration","easing","onTick","then","AbstractPlugin","id"],"mappings":"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"}