{"version":3,"file":"settings.js","sources":["../../src/plugins/settings/constants.js","../../src/plugins/settings/SettingsButton.js","../../src/plugins/settings/index.js"],"sourcesContent":["import check from './check.svg';\nimport chevron from './chevron.svg';\nimport icon from './settings.svg';\nimport switchOff from './switch-off.svg';\nimport switchOn from './switch-on.svg';\n\n/**\n * @summary Panel identifier for settings content\n * @type {string}\n * @constant\n * @private\n */\nexport const ID_PANEL = 'settings';\n\n/**\n * @summary Property name added to settings items\n * @type {string}\n * @constant\n * @private\n */\nexport const SETTING_DATA = 'settingId';\n\n/**\n * @summary Setting item template, by type\n * @constant\n * @private\n */\nexport const SETTINGS_TEMPLATE_ = {\n  options: (setting, optionsCurrent) => `\n      <span class=\"psv-settings-item-label\">${setting.label}</span>\n      <span class=\"psv-settings-item-value\">${optionsCurrent(setting)}</span>\n      <span class=\"psv-settings-item-icon\">${chevron}</span>\n    `,\n  toggle : setting => `\n      <span class=\"psv-settings-item-label\">${setting.label}</span>\n      <span class=\"psv-settings-item-value\">${setting.active() ? switchOn : switchOff}</span>\n    `,\n};\n\n/**\n * @summary Settings list template\n * @param {PSV.plugins.SettingsPlugin.Setting[]} settings\n * @param {string} title\n * @param {string} dataKey\n * @param {function} optionsCurrent\n * @returns {string}\n * @constant\n * @private\n */\nexport const SETTINGS_TEMPLATE = (settings, title, dataKey, optionsCurrent) => `\n<div class=\"psv-panel-menu\">\n  <h1 class=\"psv-panel-menu-title\">${icon} ${title}</h1>\n  <ul class=\"psv-panel-menu-list\">\n    ${settings.map(s => `\n      <li class=\"psv-panel-menu-item\" data-${dataKey}=\"${s.id}\">\n        ${SETTINGS_TEMPLATE_[s.type](s, optionsCurrent)}\n      </li>\n    `).join('')}\n  </ul>\n</div>\n`;\n\n/**\n * @summary Settings options template\n * @param {PSV.plugins.SettingsPlugin.OptionsSetting} setting\n * @param {string} title\n * @param {string} dataKey\n * @param {function} optionActive\n * @returns {string}\n * @constant\n * @private\n */\nexport const SETTING_OPTIONS_TEMPLATE = (setting, title, dataKey, optionActive) => `\n<div class=\"psv-panel-menu\">\n  <h1 class=\"psv-panel-menu-title\">${icon} ${title}</h1>\n  <ul class=\"psv-panel-menu-list\">\n    <li class=\"psv-panel-menu-item psv-settings-item--header\" data-${dataKey}=\"__back\">\n      <span class=\"psv-settings-item-icon\">${chevron}</span>\n      <span class=\"psv-settings-item-label\">${setting.label}</span>\n    </li>\n    ${setting.options().map(s => `\n      <li class=\"psv-panel-menu-item\" data-${dataKey}=\"${s.id}\">\n        <span class=\"psv-settings-item-icon\">${optionActive(s) ? check : ''}</span>\n        <span class=\"psv-settings-item-value\">${s.label}</span>\n      </li>\n    `).join('')}\n  </ul>\n</div>\n`;\n","import { AbstractButton, CONSTANTS } from '../..';\nimport { ID_PANEL } from './constants';\nimport icon from './settings.svg';\n\n/**\n * @summary Navigation bar settings button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class SettingsButton extends AbstractButton {\n\n  static id = 'settings';\n  static icon = icon;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-settings-button', true);\n\n    /**\n     * @type {PSV.plugins.SettingsPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = this.psv.getPlugin('settings');\n\n    if (this.plugin) {\n      this.psv.on(CONSTANTS.EVENTS.OPEN_PANEL, this);\n      this.psv.on(CONSTANTS.EVENTS.CLOSE_PANEL, this);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.OPEN_PANEL, this);\n    this.psv.off(CONSTANTS.EVENTS.CLOSE_PANEL, this);\n\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !!this.plugin;\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case CONSTANTS.EVENTS.OPEN_PANEL:  this.toggleActive(e.args[0] === ID_PANEL); break;\n      case CONSTANTS.EVENTS.CLOSE_PANEL: this.toggleActive(false); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles settings\n   */\n  onClick() {\n    this.plugin.toggleSettings();\n  }\n\n}\n","import { AbstractPlugin, DEFAULTS, PSVError, registerButton, utils } from '../..';\nimport { ID_PANEL, SETTING_DATA, SETTING_OPTIONS_TEMPLATE, SETTINGS_TEMPLATE, SETTINGS_TEMPLATE_ } from './constants';\nimport { SettingsButton } from './SettingsButton';\nimport './style.scss';\n\n\n/**\n * @typedef {Object} PSV.plugins.SettingsPlugin.Setting\n * @summary Description of a setting\n * @property {string} id - identifier of the setting\n * @property {string} label - label of the setting\n * @property {'options' | 'toggle'} type - type of the setting\n */\n\n/**\n * @typedef {PSV.plugins.SettingsPlugin.Setting} PSV.plugins.SettingsPlugin.OptionsSetting\n * @summary Description of a 'options' setting\n * @property {'options'} type - type of the setting\n * @property {function} current - function which returns the current option id\n * @property {function} options - function which the possible options as an array of {@link PSV.plugins.SettingsPlugin.Option}\n * @property {function} apply - function called with the id of the selected option\n */\n\n/**\n * @typedef {PSV.plugins.SettingsPlugin.Setting} PSV.plugins.SettingsPlugin.ToggleSetting\n * @summary Description of a 'toggle' setting\n * @property {'toggle'} type - type of the setting\n * @property {function} active - function which return whereas the setting is active or not\n * @property {function} toggle - function called when the setting is toggled\n */\n\n/**\n * @typedef {Object} PSV.plugins.SettingsPlugin.Option\n * @summary Option of an 'option' setting\n * @property {string} id - identifier of the option\n * @property {string} label - label of the option\n */\n\n\n// add settings button\nDEFAULTS.navbar.splice(DEFAULTS.navbar.indexOf('fullscreen'), 0, SettingsButton.id);\nDEFAULTS.lang[SettingsButton.id] = 'Settings';\nregisterButton(SettingsButton);\n\n\n/**\n * @summary Adds a button to access various settings.\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport class SettingsPlugin extends AbstractPlugin {\n\n  static id = 'settings';\n\n  /**\n   * @param {PSV.Viewer} psv\n   */\n  constructor(psv) {\n    super(psv);\n\n    /**\n     * @type {PSV.plugins.SettingsPlugin.Setting[]}\n     * @private\n     */\n    this.settings = [];\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    super.destroy();\n  }\n\n  /**\n   * @summary Registers a new setting\n   * @param {PSV.plugins.SettingsPlugin.Setting} setting\n   */\n  addSetting(setting) {\n    if (!setting.id) {\n      throw new PSVError('Missing setting id');\n    }\n    if (!setting.type) {\n      throw new PSVError('Missing setting type');\n    }\n    if (!SETTINGS_TEMPLATE_[setting.type]) {\n      throw new PSVError('Unsupported setting type');\n    }\n\n    this.settings.push(setting);\n\n    if (this.psv.panel.prop.contentId === ID_PANEL) {\n      this.showSettings();\n    }\n  }\n\n  /**\n   * @summary Removes a setting\n   * @param {string} id\n   */\n  removeSetting(id) {\n    let idx = -1;\n    // FIXME use findIndex, one day, when IE11 is totally dead\n    this.settings.some((setting, i) => {\n      if (setting.id === id) {\n        idx = i;\n        return true;\n      }\n      return false;\n    });\n    if (idx !== -1) {\n      this.settings.splice(idx, 1);\n\n      if (this.psv.panel.prop.contentId === ID_PANEL) {\n        this.showSettings();\n      }\n    }\n  }\n\n  /**\n   * @summary Toggles the settings panel\n   */\n  toggleSettings() {\n    if (this.psv.panel.prop.contentId === ID_PANEL) {\n      this.hideSettings();\n    }\n    else {\n      this.showSettings();\n    }\n  }\n\n  /**\n   * @summary Hides the settings panel\n   */\n  hideSettings() {\n    this.psv.panel.hide(ID_PANEL);\n  }\n\n  /**\n   * @summary Shows the settings panel\n   */\n  showSettings() {\n    this.psv.panel.show({\n      id          : ID_PANEL,\n      content     : SETTINGS_TEMPLATE(\n        this.settings,\n        this.psv.config.lang[SettingsButton.id],\n        utils.dasherize(SETTING_DATA),\n        (setting) => { // retrocompatibility with \"current\" returning a label\n          const current = setting.current();\n          const option = setting.options().find(opt => opt.id === current);\n          return option?.label || current;\n        }\n      ),\n      noMargin    : true,\n      clickHandler: (e) => {\n        const li = e.target ? utils.getClosest(e.target, 'li') : undefined;\n        const settingId = li ? li.dataset[SETTING_DATA] : undefined;\n        const setting = this.settings.find(s => s.id === settingId);\n\n        if (setting) {\n          switch (setting.type) {\n            case 'toggle':\n              setting.toggle();\n              this.showSettings();\n              break;\n\n            case 'options':\n              this.__showOptions(setting);\n              break;\n\n            default:\n            // noop\n          }\n        }\n      },\n    });\n  }\n\n  /**\n   * @summary Shows setting options panel\n   * @param {PSV.plugins.SettingsPlugin.OptionsSetting} setting\n   * @private\n   */\n  __showOptions(setting) {\n    const current = setting.current();\n\n    this.psv.panel.show({\n      id          : ID_PANEL,\n      content     : SETTING_OPTIONS_TEMPLATE(\n        setting,\n        this.psv.config.lang[SettingsButton.id],\n        utils.dasherize(SETTING_DATA),\n        (option) => { // retrocompatibility with options having an \"active\" flag\n          return 'active' in option ? option.active : option.id === current;\n        }\n      ),\n      noMargin    : true,\n      clickHandler: (e) => {\n        const li = e.target ? utils.getClosest(e.target, 'li') : undefined;\n        const optionId = li ? li.dataset[SETTING_DATA] : undefined;\n\n        if (optionId === '__back') {\n          this.showSettings();\n        }\n        else {\n          setting.apply(optionId);\n          this.hideSettings();\n        }\n      },\n    });\n  }\n\n}\n"],"names":["ID_PANEL","SETTING_DATA","SETTINGS_TEMPLATE_","options","setting","optionsCurrent","label","chevron","toggle","active","switchOn","switchOff","SETTINGS_TEMPLATE","settings","title","dataKey","icon","map","s","id","type","join","SETTING_OPTIONS_TEMPLATE","optionActive","check","SettingsButton","navbar","plugin","psv","getPlugin","on","CONSTANTS","EVENTS","OPEN_PANEL","CLOSE_PANEL","destroy","off","isSupported","handleEvent","e","toggleActive","args","onClick","toggleSettings","AbstractButton","DEFAULTS","splice","indexOf","lang","registerButton","SettingsPlugin","addSetting","PSVError","push","panel","prop","contentId","showSettings","removeSetting","idx","some","i","hideSettings","hide","show","content","config","utils","dasherize","current","option","find","opt","noMargin","clickHandler","li","target","getClosest","undefined","settingId","dataset","__showOptions","optionId","apply","AbstractPlugin"],"mappings":"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"}